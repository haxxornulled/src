var Dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Pt={};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Bt;function Lr(){if(Bt)return Pt;Bt=1;var t;return function(e){(function(r){var n=typeof globalThis=="object"?globalThis:typeof Dt=="object"?Dt:typeof self=="object"?self:typeof this=="object"?this:d(),i=s(e);typeof n.Reflect<"u"&&(i=s(n.Reflect,i)),r(i,n),typeof n.Reflect>"u"&&(n.Reflect=e);function s(v,y){return function(I,O){Object.defineProperty(v,I,{configurable:!0,writable:!0,value:O}),y&&y(I,O)}}function o(){try{return Function("return this;")()}catch{}}function u(){try{return(0,eval)("(function() { return this; })()")}catch{}}function d(){return o()||u()}})(function(r,n){var i=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",o=s&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",u=s&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",d=typeof Object.create=="function",v={__proto__:[]}instanceof Array,y=!d&&!v,I={create:d?function(){return Le(Object.create(null))}:v?function(){return Le({__proto__:null})}:function(){return Le({})},has:y?function(a,c){return i.call(a,c)}:function(a,c){return c in a},get:y?function(a,c){return i.call(a,c)?a[c]:void 0}:function(a,c){return a[c]}},O=Object.getPrototypeOf(Function),_=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Cr(),ue=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:jr(),je=typeof WeakMap=="function"?WeakMap:Vr(),te=s?Symbol.for("@reflect-metadata:registry"):void 0,Oe=Pr(),gt=Br(Oe);function gr(a,c,l,h){if(w(l)){if(!At(a))throw new TypeError;if(!Ot(c))throw new TypeError;return Or(a,c)}else{if(!At(a))throw new TypeError;if(!P(c))throw new TypeError;if(!P(h)&&!w(h)&&!re(h))throw new TypeError;return re(h)&&(h=void 0),l=L(l),Er(a,c,l,h)}}r("decorate",gr);function mr(a,c){function l(h,b){if(!P(h))throw new TypeError;if(!w(b)&&!Tr(b))throw new TypeError;wt(a,c,h,b)}return l}r("metadata",mr);function yr(a,c,l,h){if(!P(l))throw new TypeError;return w(h)||(h=L(h)),wt(a,c,l,h)}r("defineMetadata",yr);function br(a,c,l){if(!P(c))throw new TypeError;return w(l)||(l=L(l)),mt(a,c,l)}r("hasMetadata",br);function wr(a,c,l){if(!P(c))throw new TypeError;return w(l)||(l=L(l)),Ve(a,c,l)}r("hasOwnMetadata",wr);function Sr(a,c,l){if(!P(c))throw new TypeError;return w(l)||(l=L(l)),yt(a,c,l)}r("getMetadata",Sr);function Ir(a,c,l){if(!P(c))throw new TypeError;return w(l)||(l=L(l)),bt(a,c,l)}r("getOwnMetadata",Ir);function Mr(a,c){if(!P(a))throw new TypeError;return w(c)||(c=L(c)),St(a,c)}r("getMetadataKeys",Mr);function Rr(a,c){if(!P(a))throw new TypeError;return w(c)||(c=L(c)),It(a,c)}r("getOwnMetadataKeys",Rr);function Ar(a,c,l){if(!P(c))throw new TypeError;if(w(l)||(l=L(l)),!P(c))throw new TypeError;w(l)||(l=L(l));var h=de(c,l,!1);return w(h)?!1:h.OrdinaryDeleteMetadata(a,c,l)}r("deleteMetadata",Ar);function Or(a,c){for(var l=a.length-1;l>=0;--l){var h=a[l],b=h(c);if(!w(b)&&!re(b)){if(!Ot(b))throw new TypeError;c=b}}return c}function Er(a,c,l,h){for(var b=a.length-1;b>=0;--b){var $=a[b],B=$(c,l,h);if(!w(B)&&!re(B)){if(!P(B))throw new TypeError;h=B}}return h}function mt(a,c,l){var h=Ve(a,c,l);if(h)return!0;var b=qe(c);return re(b)?!1:mt(a,b,l)}function Ve(a,c,l){var h=de(c,l,!1);return w(h)?!1:Rt(h.OrdinaryHasOwnMetadata(a,c,l))}function yt(a,c,l){var h=Ve(a,c,l);if(h)return bt(a,c,l);var b=qe(c);if(!re(b))return yt(a,b,l)}function bt(a,c,l){var h=de(c,l,!1);if(!w(h))return h.OrdinaryGetOwnMetadata(a,c,l)}function wt(a,c,l,h){var b=de(l,h,!0);b.OrdinaryDefineOwnMetadata(a,c,l,h)}function St(a,c){var l=It(a,c),h=qe(a);if(h===null)return l;var b=St(h,c);if(b.length<=0)return l;if(l.length<=0)return b;for(var $=new ue,B=[],S=0,f=l;S<f.length;S++){var p=f[S],g=$.has(p);g||($.add(p),B.push(p))}for(var m=0,M=b;m<M.length;m++){var p=M[m],g=$.has(p);g||($.add(p),B.push(p))}return B}function It(a,c){var l=de(a,c,!1);return l?l.OrdinaryOwnMetadataKeys(a,c):[]}function Mt(a){if(a===null)return 1;switch(typeof a){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return a===null?1:6;default:return 6}}function w(a){return a===void 0}function re(a){return a===null}function Fr(a){return typeof a=="symbol"}function P(a){return typeof a=="object"?a!==null:typeof a=="function"}function _r(a,c){switch(Mt(a)){case 0:return a;case 1:return a;case 2:return a;case 3:return a;case 4:return a;case 5:return a}var l="string",h=Et(a,o);if(h!==void 0){var b=h.call(a,l);if(P(b))throw new TypeError;return b}return $r(a)}function $r(a,c){var l,h,b;{var $=a.toString;if(Ee($)){var h=$.call(a);if(!P(h))return h}var l=a.valueOf;if(Ee(l)){var h=l.call(a);if(!P(h))return h}}throw new TypeError}function Rt(a){return!!a}function kr(a){return""+a}function L(a){var c=_r(a);return Fr(c)?c:kr(c)}function At(a){return Array.isArray?Array.isArray(a):a instanceof Object?a instanceof Array:Object.prototype.toString.call(a)==="[object Array]"}function Ee(a){return typeof a=="function"}function Ot(a){return typeof a=="function"}function Tr(a){switch(Mt(a)){case 3:return!0;case 4:return!0;default:return!1}}function He(a,c){return a===c||a!==a&&c!==c}function Et(a,c){var l=a[c];if(l!=null){if(!Ee(l))throw new TypeError;return l}}function Ft(a){var c=Et(a,u);if(!Ee(c))throw new TypeError;var l=c.call(a);if(!P(l))throw new TypeError;return l}function _t(a){return a.value}function $t(a){var c=a.next();return c.done?!1:c}function kt(a){var c=a.return;c&&c.call(a)}function qe(a){var c=Object.getPrototypeOf(a);if(typeof a!="function"||a===O||c!==O)return c;var l=a.prototype,h=l&&Object.getPrototypeOf(l);if(h==null||h===Object.prototype)return c;var b=h.constructor;return typeof b!="function"||b===a?c:b}function Dr(){var a;!w(te)&&typeof n.Reflect<"u"&&!(te in n.Reflect)&&typeof n.Reflect.defineMetadata=="function"&&(a=xr(n.Reflect));var c,l,h,b=new je,$={registerProvider:B,getProvider:f,setProvider:g};return $;function B(m){if(!Object.isExtensible($))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case a===m:break;case w(c):c=m;break;case c===m:break;case w(l):l=m;break;case l===m:break;default:h===void 0&&(h=new ue),h.add(m);break}}function S(m,M){if(!w(c)){if(c.isProviderFor(m,M))return c;if(!w(l)){if(l.isProviderFor(m,M))return c;if(!w(h))for(var A=Ft(h);;){var k=$t(A);if(!k)return;var H=_t(k);if(H.isProviderFor(m,M))return kt(A),H}}}if(!w(a)&&a.isProviderFor(m,M))return a}function f(m,M){var A=b.get(m),k;return w(A)||(k=A.get(M)),w(k)&&(k=S(m,M),w(k)||(w(A)&&(A=new _,b.set(m,A)),A.set(M,k))),k}function p(m){if(w(m))throw new TypeError;return c===m||l===m||!w(h)&&h.has(m)}function g(m,M,A){if(!p(A))throw new Error("Metadata provider not registered.");var k=f(m,M);if(k!==A){if(!w(k))return!1;var H=b.get(m);w(H)&&(H=new _,b.set(m,H)),H.set(M,A)}return!0}}function Pr(){var a;return!w(te)&&P(n.Reflect)&&Object.isExtensible(n.Reflect)&&(a=n.Reflect[te]),w(a)&&(a=Dr()),!w(te)&&P(n.Reflect)&&Object.isExtensible(n.Reflect)&&Object.defineProperty(n.Reflect,te,{enumerable:!1,configurable:!1,writable:!1,value:a}),a}function Br(a){var c=new je,l={isProviderFor:function(p,g){var m=c.get(p);return w(m)?!1:m.has(g)},OrdinaryDefineOwnMetadata:B,OrdinaryHasOwnMetadata:b,OrdinaryGetOwnMetadata:$,OrdinaryOwnMetadataKeys:S,OrdinaryDeleteMetadata:f};return Oe.registerProvider(l),l;function h(p,g,m){var M=c.get(p),A=!1;if(w(M)){if(!m)return;M=new _,c.set(p,M),A=!0}var k=M.get(g);if(w(k)){if(!m)return;if(k=new _,M.set(g,k),!a.setProvider(p,g,l))throw M.delete(g),A&&c.delete(p),new Error("Wrong provider for target.")}return k}function b(p,g,m){var M=h(g,m,!1);return w(M)?!1:Rt(M.has(p))}function $(p,g,m){var M=h(g,m,!1);if(!w(M))return M.get(p)}function B(p,g,m,M){var A=h(m,M,!0);A.set(p,g)}function S(p,g){var m=[],M=h(p,g,!1);if(w(M))return m;for(var A=M.keys(),k=Ft(A),H=0;;){var Tt=$t(k);if(!Tt)return m.length=H,m;var Hr=_t(Tt);try{m[H]=Hr}catch(qr){try{kt(k)}finally{throw qr}}H++}}function f(p,g,m){var M=h(g,m,!1);if(w(M)||!M.delete(p))return!1;if(M.size===0){var A=c.get(g);w(A)||(A.delete(m),A.size===0&&c.delete(A))}return!0}}function xr(a){var c=a.defineMetadata,l=a.hasOwnMetadata,h=a.getOwnMetadata,b=a.getOwnMetadataKeys,$=a.deleteMetadata,B=new je,S={isProviderFor:function(f,p){var g=B.get(f);return!w(g)&&g.has(p)?!0:b(f,p).length?(w(g)&&(g=new ue,B.set(f,g)),g.add(p),!0):!1},OrdinaryDefineOwnMetadata:c,OrdinaryHasOwnMetadata:l,OrdinaryGetOwnMetadata:h,OrdinaryOwnMetadataKeys:b,OrdinaryDeleteMetadata:$};return S}function de(a,c,l){var h=Oe.getProvider(a,c);if(!w(h))return h;if(l){if(Oe.setProvider(a,c,gt))return gt;throw new Error("Illegal state.")}}function Cr(){var a={},c=[],l=function(){function S(f,p,g){this._index=0,this._keys=f,this._values=p,this._selector=g}return S.prototype["@@iterator"]=function(){return this},S.prototype[u]=function(){return this},S.prototype.next=function(){var f=this._index;if(f>=0&&f<this._keys.length){var p=this._selector(this._keys[f],this._values[f]);return f+1>=this._keys.length?(this._index=-1,this._keys=c,this._values=c):this._index++,{value:p,done:!1}}return{value:void 0,done:!0}},S.prototype.throw=function(f){throw this._index>=0&&(this._index=-1,this._keys=c,this._values=c),f},S.prototype.return=function(f){return this._index>=0&&(this._index=-1,this._keys=c,this._values=c),{value:f,done:!0}},S}(),h=function(){function S(){this._keys=[],this._values=[],this._cacheKey=a,this._cacheIndex=-2}return Object.defineProperty(S.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),S.prototype.has=function(f){return this._find(f,!1)>=0},S.prototype.get=function(f){var p=this._find(f,!1);return p>=0?this._values[p]:void 0},S.prototype.set=function(f,p){var g=this._find(f,!0);return this._values[g]=p,this},S.prototype.delete=function(f){var p=this._find(f,!1);if(p>=0){for(var g=this._keys.length,m=p+1;m<g;m++)this._keys[m-1]=this._keys[m],this._values[m-1]=this._values[m];return this._keys.length--,this._values.length--,He(f,this._cacheKey)&&(this._cacheKey=a,this._cacheIndex=-2),!0}return!1},S.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=a,this._cacheIndex=-2},S.prototype.keys=function(){return new l(this._keys,this._values,b)},S.prototype.values=function(){return new l(this._keys,this._values,$)},S.prototype.entries=function(){return new l(this._keys,this._values,B)},S.prototype["@@iterator"]=function(){return this.entries()},S.prototype[u]=function(){return this.entries()},S.prototype._find=function(f,p){if(!He(this._cacheKey,f)){this._cacheIndex=-1;for(var g=0;g<this._keys.length;g++)if(He(this._keys[g],f)){this._cacheIndex=g;break}}return this._cacheIndex<0&&p&&(this._cacheIndex=this._keys.length,this._keys.push(f),this._values.push(void 0)),this._cacheIndex},S}();return h;function b(S,f){return S}function $(S,f){return f}function B(S,f){return[S,f]}}function jr(){var a=function(){function c(){this._map=new _}return Object.defineProperty(c.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),c.prototype.has=function(l){return this._map.has(l)},c.prototype.add=function(l){return this._map.set(l,l),this},c.prototype.delete=function(l){return this._map.delete(l)},c.prototype.clear=function(){this._map.clear()},c.prototype.keys=function(){return this._map.keys()},c.prototype.values=function(){return this._map.keys()},c.prototype.entries=function(){return this._map.entries()},c.prototype["@@iterator"]=function(){return this.keys()},c.prototype[u]=function(){return this.keys()},c}();return a}function Vr(){var a=16,c=I.create(),l=h();return function(){function f(){this._key=h()}return f.prototype.has=function(p){var g=b(p,!1);return g!==void 0?I.has(g,this._key):!1},f.prototype.get=function(p){var g=b(p,!1);return g!==void 0?I.get(g,this._key):void 0},f.prototype.set=function(p,g){var m=b(p,!0);return m[this._key]=g,this},f.prototype.delete=function(p){var g=b(p,!1);return g!==void 0?delete g[this._key]:!1},f.prototype.clear=function(){this._key=h()},f}();function h(){var f;do f="@@WeakMap@@"+S();while(I.has(c,f));return c[f]=!0,f}function b(f,p){if(!i.call(f,l)){if(!p)return;Object.defineProperty(f,l,{value:I.create()})}return f[l]}function $(f,p){for(var g=0;g<p;++g)f[g]=Math.random()*255|0;return f}function B(f){if(typeof Uint8Array=="function"){var p=new Uint8Array(f);return typeof crypto<"u"?crypto.getRandomValues(p):typeof msCrypto<"u"?msCrypto.getRandomValues(p):$(p,f),p}return $(new Array(f),f)}function S(){var f=B(a);f[6]=f[6]&79|64,f[8]=f[8]&191|128;for(var p="",g=0;g<a;++g){var m=f[g];(g===4||g===6||g===8)&&(p+="-"),m<16&&(p+="0"),p+=m.toString(16).toLowerCase()}return p}}function Le(a){return a.__=void 0,delete a.__,a}})}(t||(t={})),Pt}Lr();function x(t){return(typeof t=="object"&&t!==null||typeof t=="function")&&typeof t.then=="function"}function V(t){switch(typeof t){case"string":case"symbol":return t.toString();case"function":return t.name;default:throw new Error(`Unexpected ${typeof t} service id type`)}}const Ne=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");class dt{[Ne];#e;constructor(e){this.#e=e,this[Ne]=!0}static is(e){return typeof e=="object"&&e!==null&&e[Ne]===!0}unwrap(){return this.#e()}}function oe(t,e){return Reflect.getOwnMetadata(e,t)}function nr(t,e,r){Reflect.defineMetadata(e,r,t)}function ie(t,e,r,n){const i=n(oe(t,e)??r());Reflect.defineMetadata(e,i,t)}const q={Request:"Request",Singleton:"Singleton",Transient:"Transient"},T={ConstantValue:"ConstantValue",DynamicValue:"DynamicValue",Factory:"Factory",Instance:"Instance",Provider:"Provider",ResolvedValue:"ResolvedValue",ServiceRedirection:"ServiceRedirection"};function*ir(...t){for(const e of t)yield*e}class Ae{#e;#t;#r;constructor(e){this.#e=new Map,this.#t={};for(const r of Reflect.ownKeys(e))this.#t[r]=new Map;this.#r=e}add(e,r){this.#n(e).push(r);for(const n of Reflect.ownKeys(r))this.#a(n,r[n]).push(e)}clone(){const e=Reflect.ownKeys(this.#r),r=new Ae(this.#r);this.#o(this.#e,r.#e);for(const n of e)this.#o(this.#t[n],r.#t[n]);return r}get(e,r){return this.#t[e].get(r)}getAllKeys(e){return this.#t[e].keys()}removeByRelation(e,r){const n=this.get(e,r);if(n===void 0)return;const i=new Set(n);for(const s of i){const o=this.#e.get(s);if(o===void 0)throw new Error("Expecting model relation, none found");for(const u of o)u[e]===r&&this.#i(s,u);this.#e.delete(s)}}#n(e){let r=this.#e.get(e);return r===void 0&&(r=[],this.#e.set(e,r)),r}#a(e,r){let n=this.#t[e].get(r);return n===void 0&&(n=[],this.#t[e].set(r,n)),n}#o(e,r){for(const[n,i]of e)r.set(n,[...i])}#i(e,r){for(const n of Reflect.ownKeys(r))this.#s(e,n,r[n])}#s(e,r,n){const i=this.#t[r].get(n);if(i!==void 0){const s=i.indexOf(e);s!==-1&&i.splice(s,1),i.length===0&&this.#t[r].delete(n)}}}var ge,N,me;(function(t){t.moduleId="moduleId",t.serviceId="serviceId"})(ge||(ge={}));class Ie{#e;#t;constructor(e,r){this.#e=r??new Ae({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#t=e}static build(e){return new Ie(e)}add(e,r){this.#e.add(e,r)}clone(){return new Ie(this.#t,this.#e.clone())}get(e){const r=[],n=this.#e.get(ge.serviceId,e);n!==void 0&&r.push(n);const i=this.#t?.get(e);if(i!==void 0&&r.push(i),r.length!==0)return ir(...r)}removeAllByModuleId(e){this.#e.removeByRelation(ge.moduleId,e)}removeAllByServiceId(e){this.#e.removeByRelation(ge.serviceId,e)}}(function(t){t.moduleId="moduleId",t.serviceId="serviceId"})(N||(N={}));class Me{#e;#t;constructor(e,r){this.#e=r??new Ae({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#t=e}static build(e){return new Me(e)}clone(){return new Me(this.#t,this.#e.clone())}get(e){return this.getNonParentBindings(e)??this.#t?.get(e)}getNonParentBindings(e){return this.#e.get(N.serviceId,e)}getNonParentBoundServices(){return this.#e.getAllKeys(N.serviceId)}getByModuleId(e){return this.#e.get(N.moduleId,e)??this.#t?.getByModuleId(e)}removeAllByModuleId(e){this.#e.removeByRelation(N.moduleId,e)}removeAllByServiceId(e){this.#e.removeByRelation(N.serviceId,e)}set(e){const r={[N.serviceId]:e.serviceIdentifier};e.moduleId!==void 0&&(r[N.moduleId]=e.moduleId),this.#e.add(e,r)}}(function(t){t.moduleId="moduleId",t.serviceId="serviceId"})(me||(me={}));class Re{#e;#t;constructor(e,r){this.#e=r??new Ae({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#t=e}static build(e){return new Re(e)}add(e,r){this.#e.add(e,r)}clone(){return new Re(this.#t,this.#e.clone())}get(e){const r=[],n=this.#e.get(me.serviceId,e);n!==void 0&&r.push(n);const i=this.#t?.get(e);if(i!==void 0&&r.push(i),r.length!==0)return ir(...r)}removeAllByModuleId(e){this.#e.removeByRelation(me.moduleId,e)}removeAllByServiceId(e){this.#e.removeByRelation(me.serviceId,e)}}const ye="@inversifyjs/core/classMetadataReflectKey";function be(){return{constructorArguments:[],lifecycle:{postConstructMethodName:void 0,preDestroyMethodName:void 0},properties:new Map,scope:void 0}}const sr="@inversifyjs/core/pendingClassMetadataCountReflectKey",We=Symbol.for("@inversifyjs/core/InversifyCoreError");class E extends Error{[We];kind;constructor(e,r,n){super(r,n),this[We]=!0,this.kind=e}static is(e){return typeof e=="object"&&e!==null&&e[We]===!0}static isErrorOfKind(e,r){return E.is(e)&&e.kind===r}}var F,ae,K;function Je(t){const e=oe(t,ye)??be();if(!function(r){const n=oe(r,sr);return n!==void 0&&n!==0}(t))return function(r,n){const i=[];if(n.length<r.length)throw new E(F.missingInjectionDecorator,`Found unexpected missing metadata on type "${r.name}". "${r.name}" constructor requires at least ${r.length.toString()} arguments, found ${n.length.toString()} instead.
Are you using @inject, @multiInject or @unmanaged decorators in every non optional constructor argument?

If you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`);for(let s=0;s<n.length;++s)n[s]===void 0&&i.push(s);if(i.length>0)throw new E(F.missingInjectionDecorator,`Found unexpected missing metadata on type "${r.name}" at constructor indexes "${i.join('", "')}".

Are you using @inject, @multiInject or @unmanaged decorators at those indexes?

If you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}(t,e.constructorArguments),e;(function(r,n){const i=[];for(let s=0;s<n.constructorArguments.length;++s){const o=n.constructorArguments[s];o!==void 0&&o.kind!==ae.unknown||i.push(`  - Missing or incomplete metadata for type "${r.name}" at constructor argument with index ${s.toString()}.
Every constructor parameter must be decorated either with @inject, @multiInject or @unmanaged decorator.`)}for(const[s,o]of n.properties)o.kind===ae.unknown&&i.push(`  - Missing or incomplete metadata for type "${r.name}" at property "${s.toString()}".
This property must be decorated either with @inject or @multiInject decorator.`);throw i.length===0?new E(F.unknown,`Unexpected class metadata for type "${r.name}" with uncompletion traces.
This might be caused by one of the following reasons:

1. A third party library is targeting inversify reflection metadata.
2. A bug is causing the issue. Consider submiting an issue to fix it.`):new E(F.missingInjectionDecorator,`Invalid class metadata at type ${r.name}:

${i.join(`

`)}`)})(t,e)}function Nr(){return 0}function Wr(t){return e=>{e!==void 0&&e.kind===ae.unknown&&ie(t,sr,Nr,r=>r-1)}}function Ur(t,e){return(...r)=>n=>{if(n===void 0)return t(...r);if(n.kind===K.unmanaged)throw new E(F.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found");return e(n,...r)}}function Kr(t){if(t.kind!==ae.unknown&&t.isFromTypescriptParamType!==!0)throw new E(F.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found")}(function(t){t[t.injectionDecoratorConflict=0]="injectionDecoratorConflict",t[t.missingInjectionDecorator=1]="missingInjectionDecorator",t[t.planning=2]="planning",t[t.resolution=3]="resolution",t[t.unknown=4]="unknown"})(F||(F={})),function(t){t[t.unknown=32]="unknown"}(ae||(ae={})),function(t){t[t.multipleInjection=0]="multipleInjection",t[t.singleInjection=1]="singleInjection",t[t.unmanaged=2]="unmanaged"}(K||(K={}));const Gr=Ur(function(t,e){return{kind:t,name:void 0,optional:!1,tags:new Map,value:e}},function(t,e,r){return Kr(t),{...t,kind:e,value:r}});function xt(t,e){return r=>{const n=r.properties.get(e);return r.properties.set(e,t(n)),r}}var U;function zr(t,e,r,n){if(E.isErrorOfKind(n,F.injectionDecoratorConflict)){const i=function(s,o,u){if(u===void 0){if(o===void 0)throw new E(F.unknown,"Unexpected undefined property and index values");return{kind:U.property,property:o,targetClass:s.constructor}}return typeof u=="number"?{index:u,kind:U.parameter,targetClass:s}:{kind:U.method,method:o,targetClass:s}}(t,e,r);throw new E(F.injectionDecoratorConflict,`Unexpected injection error.

Cause:

${n.message}

Details

${function(s){switch(s.kind){case U.method:return`[class: "${s.targetClass.name}", method: "${s.method.toString()}"]`;case U.parameter:return`[class: "${s.targetClass.name}", index: "${s.index.toString()}"]`;case U.property:return`[class: "${s.targetClass.name}", property: "${s.property.toString()}"]`}}(i)}`,{cause:n})}throw n}function Jr(t,e){return(r,n,i)=>{try{i===void 0?function(s,o){const u=Ue(s,o);return(d,v)=>{ie(d.constructor,ye,be,xt(u(d),v))}}(t,e)(r,n):typeof i=="number"?function(s,o){const u=Ue(s,o);return(d,v,y)=>{if(!function(I,O){return typeof I=="function"&&O===void 0}(d,v))throw new E(F.injectionDecoratorConflict,`Found an @inject decorator in a non constructor parameter.
Found @inject decorator at method "${v?.toString()??""}" at class "${d.constructor.name}"`);ie(d,ye,be,function(I,O){return _=>{const ue=_.constructorArguments[O];return _.constructorArguments[O]=I(ue),_}}(u(d),y))}}(t,e)(r,n,i):function(s,o){const u=Ue(s,o);return(d,v,y)=>{if(!function(I){return I.set!==void 0}(y))throw new E(F.injectionDecoratorConflict,`Found an @inject decorator in a non setter property method.
Found @inject decorator at method "${v.toString()}" at class "${d.constructor.name}"`);ie(d.constructor,ye,be,xt(u(d),v))}}(t,e)(r,n,i)}catch(s){zr(r,n,i,s)}}}function Ue(t,e){return r=>{const n=e(r);return i=>(n(i),t(i))}}function G(t){return Jr(Gr(K.singleInjection,t),Wr)}(function(t){t[t.method=0]="method",t[t.parameter=1]="parameter",t[t.property=2]="property"})(U||(U={}));const Ct="@inversifyjs/core/classIsInjectableFlagReflectKey",Zr=[Array,BigInt,Boolean,Function,Number,Object,String];function Qr(t){const e=oe(t,"design:paramtypes");e!==void 0&&ie(t,ye,be,function(r){return n=>(r.forEach((i,s)=>{var o;n.constructorArguments[s]!==void 0||(o=i,Zr.includes(o))||(n.constructorArguments[s]=function(u){return{isFromTypescriptParamType:!0,kind:K.singleInjection,name:void 0,optional:!1,tags:new Map,value:u}}(i))}),n)}(e))}function j(t){return e=>{(function(r){if(oe(r,Ct)!==void 0)throw new E(F.injectionDecoratorConflict,`Cannot apply @injectable decorator multiple times at class "${r.name}"`);nr(r,Ct,!0)})(e),Qr(e)}}var se;(function(t){t[t.multipleInjection=0]="multipleInjection",t[t.singleInjection=1]="singleInjection"})(se||(se={}));class le{#e;constructor(e){this.#e=e}get name(){return this.#e.elem.name}get serviceIdentifier(){return this.#e.elem.serviceIdentifier}get tags(){return this.#e.elem.tags}getAncestor(){if(this.#e.previous!==void 0)return new le(this.#e.previous)}}class ht{last;constructor(e){this.last=e}concat(e){return new ht({elem:e,previous:this.last})}[Symbol.iterator](){let e=this.last;return{next:()=>{if(e===void 0)return{done:!0,value:void 0};const r=e.elem;return e=e.previous,{done:!1,value:r}}}}}function Xr(t,e){t.servicesBranch.has(e)&&function(r,n){const i=(s=[...r.servicesBranch,n],[...s].map(V).join(" -> "));var s;throw new E(F.planning,`Circular dependency found: ${i}`)}(t,e),t.servicesBranch.add(e)}function Be(t,e,r){const n=r?.customServiceIdentifier??e.serviceIdentifier,i=[...t.getBindings(n)??[]].filter(s=>s.isSatisfiedBy(e));if(i.length===0&&t.autobindOptions!==void 0&&typeof n=="function"){const s=function(o,u){return{cache:{isRight:!1,value:void 0},id:0,implementationType:u,isSatisfiedBy:()=>!0,moduleId:void 0,onActivation:void 0,onDeactivation:void 0,scope:o.scope,serviceIdentifier:u,type:T.Instance}}(t.autobindOptions,n);t.setBinding(s),i.push(s)}return i}function Y(t){return t.redirections!==void 0}function or(t,e,r,n){let i,s;Y(r)?(i=r.binding.targetServiceIdentifier,s=r.binding.serviceIdentifier):(i=r.serviceIdentifier,s=r.parent?.binding.serviceIdentifier),Array.isArray(t)?function(o,u,d,v,y){if(o.length!==0){const I=`Ambiguous bindings found for service: "${V(d)}".

Registered bindings:

${o.map(O=>function(_){switch(_.type){case T.Instance:return`[ type: "${_.type}", serviceIdentifier: "${V(_.serviceIdentifier)}", scope: "${_.scope}", implementationType: "${_.implementationType.name}" ]`;case T.ServiceRedirection:return`[ type: "${_.type}", serviceIdentifier: "${V(_.serviceIdentifier)}", redirection: "${V(_.targetServiceIdentifier)}" ]`;default:return`[ type: "${_.type}", serviceIdentifier: "${V(_.serviceIdentifier)}", scope: "${_.scope}" ]`}}(O.binding)).join(`
`)}

Trying to resolve bindings for "${ar(d,v)}".

${cr(y)}`;throw new E(F.planning,I)}u||jt(d,v,y)}(t,e,i,s,n):function(o,u,d,v,y){o!==void 0||u||jt(d,v,y)}(t,e,i,s,n)}function jt(t,e,r){const n=`No bindings found for service: "${V(t)}".

Trying to resolve bindings for "${ar(t,e)}".

${cr(r)}`;throw new E(F.planning,n)}function ar(t,e){return e===void 0?`${V(t)} (Root service)`:V(e)}function cr(t){const e=t.tags.size===0?"":`
- tags:
  - ${[...t.tags.keys()].map(r=>r.toString()).join(`
  - `)}`;return`Binding constraints:
- service identifier: ${V(t.serviceIdentifier)}
- name: ${t.name?.toString()??"-"}${e}`}function lr(t,e,r){if(t.redirections.length!==1)or(t.redirections,e,t,r);else{const[n]=t.redirections;Y(n)&&lr(n,e,r)}}function ft(t,e,r){if(Array.isArray(t.bindings)&&t.bindings.length===1){const[n]=t.bindings;Y(n)&&lr(n,e,r)}else or(t.bindings,e,t,r)}function Yr(t){const e=new Map;t.rootConstraints.tag!==void 0&&e.set(t.rootConstraints.tag.key,t.rootConstraints.tag.value);const r=new ht({elem:{name:t.rootConstraints.name,serviceIdentifier:t.rootConstraints.serviceIdentifier,tags:e},previous:void 0}),n=new le(r.last),i=Be(t,n),s=[],o={bindings:s,parent:void 0,serviceIdentifier:t.rootConstraints.serviceIdentifier};if(s.push(...xe(t,r,i,o)),!t.rootConstraints.isMultiple){ft(o,t.rootConstraints.isOptional??!1,n);const[u]=s;o.bindings=u}return{tree:{root:o}}}function en(t,e,r,n){const i={binding:e,classMetadata:t.getClassMetadata(e.implementationType),constructorParams:[],parent:n,propertyParams:new Map};return ur({autobindOptions:t.autobindOptions,getBindings:t.getBindings,getClassMetadata:t.getClassMetadata,node:i,servicesBranch:t.servicesBranch,setBinding:t.setBinding},r)}function Vt(t,e,r){if(r.kind===K.unmanaged)return;const n=dt.is(r.value)?r.value.unwrap():r.value,i=e.concat({name:r.name,serviceIdentifier:n,tags:r.tags}),s=new le(i.last),o=Be(t,s),u=[],d={bindings:u,parent:t.node,serviceIdentifier:n};if(u.push(...xe(t,i,o,d)),r.kind===K.singleInjection){ft(d,r.optional,s);const[v]=u;d.bindings=v}return d}function tn(t,e,r){const n=dt.is(r.value)?r.value.unwrap():r.value,i=e.concat({name:r.name,serviceIdentifier:n,tags:r.tags}),s=new le(i.last),o=Be(t,s),u=[],d={bindings:u,parent:t.node,serviceIdentifier:n};if(u.push(...xe(t,i,o,d)),r.kind===se.singleInjection){ft(d,r.optional,s);const[v]=u;d.bindings=v}return d}function rn(t,e,r,n){const i={binding:e,params:[],parent:n};return ur({autobindOptions:t.autobindOptions,getBindings:t.getBindings,getClassMetadata:t.getClassMetadata,node:i,servicesBranch:t.servicesBranch,setBinding:t.setBinding},r)}function xe(t,e,r,n){const i=Y(n)?n.binding.targetServiceIdentifier:n.serviceIdentifier;Xr(t,i);const s=[];for(const o of r)switch(o.type){case T.Instance:s.push(en(t,o,e,n));break;case T.ResolvedValue:s.push(rn(t,o,e,n));break;case T.ServiceRedirection:{const u=nn(t,e,o,n);s.push(u);break}default:s.push({binding:o,parent:n})}return t.servicesBranch.delete(i),s}function nn(t,e,r,n){const i={binding:r,parent:n,redirections:[]},s=Be(t,new le(e.last),{customServiceIdentifier:r.targetServiceIdentifier});return i.redirections.push(...xe(t,e,s,i)),i}function ur(t,e){return t.node.binding.type===T.Instance?function(r,n,i){const s=n.classMetadata;for(const[o,u]of s.constructorArguments.entries())n.constructorParams[o]=Vt(r,i,u);for(const[o,u]of s.properties){const d=Vt(r,i,u);d!==void 0&&n.propertyParams.set(o,d)}return r.node}(t,t.node,e):function(r,n,i){const s=n.binding.metadata;for(const[o,u]of s.arguments.entries())n.params[o]=tn(r,i,u);return r.node}(t,t.node,e)}var Z;(function(t){t[t.singleMandatory=0]="singleMandatory",t[t.singleOptional=1]="singleOptional",t[t.multipleMandatory=2]="multipleMandatory",t[t.multipleOptional=3]="multipleOptional",t[t.length=4]="length"})(Z||(Z={}));class sn{#e;#t;#r;#n;#a;constructor(){this.#e=this.#o(),this.#t=this.#o(),this.#n=this.#o(),this.#r=this.#o(),this.#a=[]}clearCache(){for(const e of this.#c())e.clear();for(const e of this.#a)e.clearCache()}get(e){return e.name===void 0?e.tag===void 0?this.#s(this.#e,e).get(e.serviceIdentifier):this.#s(this.#r,e).get(e.serviceIdentifier)?.get(e.tag.key)?.get(e.tag.value):e.tag===void 0?this.#s(this.#t,e).get(e.serviceIdentifier)?.get(e.name):this.#s(this.#n,e).get(e.serviceIdentifier)?.get(e.name)?.get(e.tag.key)?.get(e.tag.value)}set(e,r){e.name===void 0?e.tag===void 0?this.#s(this.#e,e).set(e.serviceIdentifier,r):this.#i(this.#i(this.#s(this.#r,e),e.serviceIdentifier),e.tag.key).set(e.tag.value,r):e.tag===void 0?this.#i(this.#s(this.#t,e),e.serviceIdentifier).set(e.name,r):this.#i(this.#i(this.#i(this.#s(this.#n,e),e.serviceIdentifier),e.name),e.tag.key).set(e.tag.value,r)}subscribe(e){this.#a.push(e)}#o(){const e=new Array(Z.length);for(let r=0;r<e.length;++r)e[r]=new Map;return e}#i(e,r){let n=e.get(r);return n===void 0&&(n=new Map,e.set(r,n)),n}#s(e,r){return e[this.#l(r)]}#c(){return[...this.#e,...this.#t,...this.#n,...this.#r]}#l(e){return e.isMultiple?e.optional===!0?Z.multipleOptional:Z.multipleMandatory:e.optional===!0?Z.singleOptional:Z.singleMandatory}}function dr(t,e){return x(e)?e.then(r=>Ht(t,r)):Ht(t,e)}function Ht(t,e){return t.cache={isRight:!0,value:e},e}function on(t,e,r){const n=t.getActivations(e);return n===void 0?r:x(r)?qt(t,r,n[Symbol.iterator]()):function(i,s,o){let u=s,d=o.next();for(;d.done!==!0;){const v=d.value(i.context,u);if(x(v))return qt(i,v,o);u=v,d=o.next()}return u}(t,r,n[Symbol.iterator]())}async function qt(t,e,r){let n=await e,i=r.next();for(;i.done!==!0;)n=await i.value(t.context,n),i=r.next();return n}function De(t,e,r){let n=r;if(e.onActivation!==void 0){const i=e.onActivation;n=x(n)?n.then(s=>i(t.context,s)):i(t.context,n)}return on(t,e.serviceIdentifier,n)}function pt(t){return(e,r)=>r.cache.isRight?r.cache.value:dr(r,De(e,r,t(e,r)))}const an=pt(function(t,e){return e.value});function cn(t){return t}function vt(t,e){return(r,n)=>{const i=t(n);switch(i.scope){case q.Singleton:return i.cache.isRight?i.cache.value:dr(i,De(r,i,e(r,n)));case q.Request:{if(r.requestScopeCache.has(i.id))return r.requestScopeCache.get(i.id);const s=De(r,i,e(r,n));return r.requestScopeCache.set(i.id,s),s}case q.Transient:return De(r,i,e(r,n))}}}const ln=(t=>vt(cn,t))(function(t,e){return e.value(t.context)}),un=pt(function(t,e){return e.factory(t.context)});function Lt(t,e,r){const n=function(i,s,o){if(o!==void 0){if(!(o in i))throw new E(F.resolution,`Expecting a "${o.toString()}" property when resolving "${s.implementationType.name}" class @postConstruct decorated method, none found.`);if(typeof i[o]!="function")throw new E(F.resolution,`Expecting a "${o.toString()}" method when resolving "${s.implementationType.name}" class @postConstruct decorated method, a non function property was found instead.`);{let u;try{u=i[o]()}catch(d){throw new E(F.resolution,`Unexpected error found when calling "${o.toString()}" @postConstruct decorated method on class "${s.implementationType.name}"`,{cause:d})}if(x(u))return async function(d,v,y){try{await y}catch(I){throw new E(F.resolution,`Unexpected error found when calling "${v.toString()}" @postConstruct decorated method on class "${d.implementationType.name}"`,{cause:I})}}(s,o,u)}}}(t,e,r);return x(n)?n.then(()=>t):t}function Nt(t){return(e,r,n)=>{const i=new n.binding.implementationType(...e),s=t(r,i,n);return x(s)?s.then(()=>Lt(i,n.binding,n.classMetadata.lifecycle.postConstructMethodName)):Lt(i,n.binding,n.classMetadata.lifecycle.postConstructMethodName)}}const dn=pt(function(t,e){return e.provider(t.context)});function hn(t){return t.binding}function fn(t){return t.binding}const Wt=function(t){return(e,r,n)=>{const i=[];for(const[s,o]of n.propertyParams){const u=n.classMetadata.properties.get(s);if(u===void 0)throw new E(F.resolution,`Expecting metadata at property "${s.toString()}", none found`);u.kind!==K.unmanaged&&o.bindings!==void 0&&(r[s]=t(e,o),x(r[s])&&i.push((async()=>{r[s]=await r[s]})()))}if(i.length>0)return Promise.all(i).then(()=>{})}}(Ce),Ut=function(t){return function e(r,n){const i=[];for(const s of n.redirections)Y(s)?i.push(...e(r,s)):i.push(t(r,s));return i}}(Ze),pn=function(t,e,r){return(n,i)=>{const s=t(n,i);return x(s)?e(s,n,i):r(s,n,i)}}(function(t){return(e,r)=>{const n=[];for(const i of r.constructorParams)i===void 0?n.push(void 0):n.push(t(e,i));return n.some(x)?Promise.all(n):n}}(Ce),function(t){return async(e,r,n)=>{const i=await e;return t(i,r,n)}}(Nt(Wt)),Nt(Wt)),vn=function(t){return(e,r)=>{const n=t(e,r);return x(n)?n.then(i=>r.binding.factory(...i)):r.binding.factory(...n)}}(function(t){return(e,r)=>{const n=[];for(const i of r.params)n.push(t(e,i));return n.some(x)?Promise.all(n):n}}(Ce)),gn=(t=>vt(hn,t))(pn),mn=(t=>vt(fn,t))(vn);function yn(t){return Ce(t,t.planResult.tree.root)}function Ze(t,e){switch(e.binding.type){case T.ConstantValue:return an(t,e.binding);case T.DynamicValue:return ln(t,e.binding);case T.Factory:return un(t,e.binding);case T.Instance:return gn(t,e);case T.Provider:return dn(t,e.binding);case T.ResolvedValue:return mn(t,e)}}function Ce(t,e){if(e.bindings!==void 0)return Array.isArray(e.bindings)?function(r,n){const i=[];for(const s of n)Y(s)?i.push(...Ut(r,s)):i.push(Ze(r,s));return i.some(x)?Promise.all(i):i}(t,e.bindings):function(r,n){if(Y(n)){const i=Ut(r,n);if(i.length===1)return i[0];throw new E(F.resolution,"Unexpected multiple resolved values on single injection")}return Ze(r,n)}(t,e.bindings)}function bn(t){return t.scope!==void 0}function Kt(t,e){if(t.lifecycle.preDestroyMethodName!==void 0&&typeof e[t.lifecycle.preDestroyMethodName]=="function")return e[t.lifecycle.preDestroyMethodName]()}function Gt(t,e,r){const n=t.getDeactivations(e);if(n!==void 0)return x(r)?zt(r,n[Symbol.iterator]()):function(i,s){let o=s.next();for(;o.done!==!0;){const u=o.value(i);if(x(u))return zt(i,s);o=s.next()}}(r,n[Symbol.iterator]())}async function zt(t,e){const r=await t;let n=e.next();for(;n.done!==!0;)await n.value(r),n=e.next()}function wn(t,e){const r=function(n,i){if(i.type===T.Instance){const s=n.getClassMetadata(i.implementationType),o=i.cache.value;return x(o)?o.then(u=>Kt(s,u)):Kt(s,o)}}(t,e);return r===void 0?Jt(t,e):r.then(()=>Jt(t,e))}function Jt(t,e){const r=e.cache;return x(r.value)?r.value.then(n=>Zt(t,e,n)):Zt(t,e,r.value)}function Zt(t,e,r){let n;return e.onDeactivation!==void 0&&(n=(0,e.onDeactivation)(r)),n===void 0?Gt(t,e.serviceIdentifier,r):n.then(()=>Gt(t,e.serviceIdentifier,r))}function hr(t,e){if(e===void 0)return;const r=function(i){const s=[];for(const o of i)bn(o)&&o.scope===q.Singleton&&o.cache.isRight&&s.push(o);return s}(e),n=[];for(const i of r){const s=wn(t,i);s!==void 0&&n.push(s)}return n.length>0?Promise.all(n).then(()=>{}):void 0}function Sn(t,e){const r=t.getBindingsFromModule(e);return hr(t,r)}function Qt(t,e){const r=t.getBindings(e);return hr(t,r)}class z{static always=e=>!0}const Ke="@inversifyjs/container/bindingId";function J(){const t=oe(Object,Ke)??0;return t===Number.MAX_SAFE_INTEGER?nr(Object,Ke,Number.MIN_SAFE_INTEGER):ie(Object,Ke,()=>t,e=>e+1),t}function pe(t){return e=>{for(let r=e.getAncestor();r!==void 0;r=r.getAncestor())if(t(r))return!0;return!1}}function he(t){return e=>e.name===t}function Fe(t){return e=>e.serviceIdentifier===t}function fe(t,e){return r=>r.tags.has(t)&&r.tags.get(t)===e}function In(t){return t.name===void 0&&t.tags.size===0}function _e(t){const e=pe(t);return r=>!e(r)}function $e(t){return e=>{const r=e.getAncestor();return r===void 0||!t(r)}}function ke(t){return e=>{const r=e.getAncestor();return r!==void 0&&t(r)}}class Mn{#e;constructor(e){this.#e=e}inRequestScope(){return this.#e.scope=q.Request,new X(this.#e)}inSingletonScope(){return this.#e.scope=q.Singleton,new X(this.#e)}inTransientScope(){return this.#e.scope=q.Transient,new X(this.#e)}}class Xt{#e;#t;#r;#n;constructor(e,r,n,i){this.#e=e,this.#t=r,this.#r=n,this.#n=i}to(e){const r=Je(e),n={cache:{isRight:!1,value:void 0},id:J(),implementationType:e,isSatisfiedBy:z.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:r.scope??this.#r,serviceIdentifier:this.#n,type:T.Instance};return this.#e(n),new Ge(n)}toSelf(){if(typeof this.#n!="function")throw new Error('"toSelf" function can only be applied when a newable function is used as service identifier');return this.to(this.#n)}toConstantValue(e){const r={cache:{isRight:!1,value:void 0},id:J(),isSatisfiedBy:z.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:q.Singleton,serviceIdentifier:this.#n,type:T.ConstantValue,value:e};return this.#e(r),new X(r)}toDynamicValue(e){const r={cache:{isRight:!1,value:void 0},id:J(),isSatisfiedBy:z.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:this.#r,serviceIdentifier:this.#n,type:T.DynamicValue,value:e};return this.#e(r),new Ge(r)}toResolvedValue(e,r){const n={cache:{isRight:!1,value:void 0},factory:e,id:J(),isSatisfiedBy:z.always,metadata:this.#a(r),moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:this.#r,serviceIdentifier:this.#n,type:T.ResolvedValue};return this.#e(n),new Ge(n)}toFactory(e){const r={cache:{isRight:!1,value:void 0},factory:e,id:J(),isSatisfiedBy:z.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:q.Singleton,serviceIdentifier:this.#n,type:T.Factory};return this.#e(r),new X(r)}toProvider(e){const r={cache:{isRight:!1,value:void 0},id:J(),isSatisfiedBy:z.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,provider:e,scope:q.Singleton,serviceIdentifier:this.#n,type:T.Provider};return this.#e(r),new X(r)}toService(e){const r={id:J(),isSatisfiedBy:z.always,moduleId:this.#t,serviceIdentifier:this.#n,targetServiceIdentifier:e,type:T.ServiceRedirection};this.#e(r)}#a(e){return{arguments:(e??[]).map(r=>function(n){return typeof n=="object"&&!dt.is(n)}(r)?{kind:r.isMultiple===!0?se.multipleInjection:se.singleInjection,name:r.name,optional:r.optional??!1,tags:new Map((r.tags??[]).map(n=>[n.key,n.value])),value:r.serviceIdentifier}:{kind:se.singleInjection,name:void 0,optional:!1,tags:new Map,value:r})}}}class fr{#e;constructor(e){this.#e=e}onActivation(e){return this.#e.onActivation=e,new Qe(this.#e)}onDeactivation(e){return this.#e.onDeactivation=e,new Qe(this.#e)}}class Qe{#e;constructor(e){this.#e=e}when(e){return this.#e.isSatisfiedBy=e,new fr(this.#e)}whenAnyAncestor(e){return this.when(pe(e))}whenAnyAncestorIs(e){return this.when(pe(Fe(e)))}whenAnyAncestorNamed(e){return this.when(function(r){return pe(he(r))}(e))}whenAnyAncestorTagged(e,r){return this.when(function(n,i){return pe(fe(n,i))}(e,r))}whenDefault(){return this.when(In)}whenNamed(e){return this.when(he(e))}whenNoParent(e){return this.when($e(e))}whenNoParentIs(e){return this.when($e(Fe(e)))}whenNoParentNamed(e){return this.when(function(r){return $e(he(r))}(e))}whenNoParentTagged(e,r){return this.when(function(n,i){return $e(fe(n,i))}(e,r))}whenParent(e){return this.when(ke(e))}whenParentIs(e){return this.when(ke(Fe(e)))}whenParentNamed(e){return this.when(function(r){return ke(he(r))}(e))}whenParentTagged(e,r){return this.when(function(n,i){return ke(fe(n,i))}(e,r))}whenTagged(e,r){return this.when(fe(e,r))}whenNoAncestor(e){return this.when(_e(e))}whenNoAncestorIs(e){return this.when(_e(Fe(e)))}whenNoAncestorNamed(e){return this.when(function(r){return _e(he(r))}(e))}whenNoAncestorTagged(e,r){return this.when(function(n,i){return _e(fe(n,i))}(e,r))}}class X extends Qe{#e;constructor(e){super(e),this.#e=new fr(e)}onActivation(e){return this.#e.onActivation(e)}onDeactivation(e){return this.#e.onDeactivation(e)}}class Ge extends X{#e;constructor(e){super(e),this.#e=new Mn(e)}inRequestScope(){return this.#e.inRequestScope()}inSingletonScope(){return this.#e.inSingletonScope()}inTransientScope(){return this.#e.inTransientScope()}}const ze=Symbol.for("@inversifyjs/container/InversifyContainerError");class we extends Error{[ze];kind;constructor(e,r,n){super(r,n),this[ze]=!0,this.kind=e}static is(e){return typeof e=="object"&&e!==null&&e[ze]===!0}static isErrorOfKind(e,r){return we.is(e)&&e.kind===r}}var Se;(function(t){t[t.invalidOperation=0]="invalidOperation"})(Se||(Se={}));const Rn=q.Transient;class An{#e;#t;#r;#n;#a;#o;#i;#s;#c;#l;constructor(e){this.#n=r=>this.#e.get(r),this.#i=new sn,this.#s=this.#p(),e?.parent===void 0?(this.#e=Ie.build(void 0),this.#t=Me.build(void 0),this.#r=Re.build(void 0)):(this.#e=Ie.build(e.parent.#e),this.#t=Me.build(e.parent.#t),this.#r=Re.build(e.parent.#r),e.parent.#i.subscribe(this.#i)),this.#a=this.#t.get.bind(this.#t),this.#c=this.#h.bind(this),this.#o={autobind:e?.autobind??!1,defaultScope:e?.defaultScope??Rn},this.#l=[]}bind(e){return new Xt(r=>{this.#h(r)},void 0,this.#o.defaultScope,e)}get(e,r){const n=this.#u(!1,e,r),i=this.#d(n);if(x(i))throw new we(Se.invalidOperation,`Unexpected asyncronous service when resolving service "${V(e)}"`);return i}getAll(e,r){const n=this.#u(!0,e,r),i=this.#d(n);if(x(i))throw new we(Se.invalidOperation,`Unexpected asyncronous service when resolving service "${V(e)}"`);return i}async getAllAsync(e,r){const n=this.#u(!0,e,r);return this.#d(n)}async getAsync(e,r){const n=this.#u(!1,e,r);return this.#d(n)}isBound(e,r){const n=this.#t.get(e);return this.#v(e,n,r)}isCurrentBound(e,r){const n=this.#t.getNonParentBindings(e);return this.#v(e,n,r)}async load(...e){await Promise.all(e.map(async r=>r.load(this.#g(r.id))))}onActivation(e,r){this.#e.add(r,{serviceId:e})}onDeactivation(e,r){this.#r.add(r,{serviceId:e})}restore(){const e=this.#l.pop();if(e===void 0)throw new we(Se.invalidOperation,"No snapshot available to restore");this.#e=e.activationService,this.#t=e.bindingService,this.#r=e.deactivationService,this.#w()}snapshot(){this.#l.push({activationService:this.#e.clone(),bindingService:this.#t.clone(),deactivationService:this.#r.clone()})}async unbind(e){await Qt(this.#f(),e),this.#e.removeAllByServiceId(e),this.#t.removeAllByServiceId(e),this.#r.removeAllByServiceId(e),this.#i.clearCache()}async unbindAll(){const e=this.#f(),r=[...this.#t.getNonParentBoundServices()];await Promise.all(r.map(async n=>Qt(e,n)));for(const n of r)this.#e.removeAllByServiceId(n),this.#t.removeAllByServiceId(n),this.#r.removeAllByServiceId(n);this.#i.clearCache()}async unload(...e){const r=this.#f();await Promise.all(e.map(n=>Sn(r,n.id)));for(const n of e)this.#e.removeAllByModuleId(n.id),this.#t.removeAllByModuleId(n.id),this.#r.removeAllByModuleId(n.id);this.#i.clearCache()}#g(e){return{bind:r=>new Xt(n=>{this.#h(n)},e,this.#o.defaultScope,r),isBound:this.isBound.bind(this),onActivation:(r,n)=>{this.#e.add(n,{moduleId:e,serviceId:r})},onDeactivation:(r,n)=>{this.#r.add(n,{moduleId:e,serviceId:r})},unbind:this.unbind.bind(this)}}#f(){return{getBindings:e=>this.#t.get(e),getBindingsFromModule:e=>this.#t.getByModuleId(e),getClassMetadata:Je,getDeactivations:e=>this.#r.get(e)}}#m(e,r,n){return{isMultiple:e,name:n?.name,optional:n?.optional,serviceIdentifier:r,tag:n?.tag}}#y(e,r,n){const i={autobindOptions:n?.autobind??this.#o.autobind?{scope:this.#o.defaultScope}:void 0,getBindings:this.#a,getClassMetadata:Je,rootConstraints:{isMultiple:e,serviceIdentifier:r},servicesBranch:new Set,setBinding:this.#c};return this.#b(i,n),i}#u(e,r,n){const i=this.#m(e,r,n),s=this.#i.get(i);if(s!==void 0)return s;const o=Yr(this.#y(e,r,n));return this.#i.set(i,o),o}#p(){return{get:this.get.bind(this),getAll:this.getAll.bind(this),getAllAsync:this.getAllAsync.bind(this),getAsync:this.getAsync.bind(this)}}#d(e){return yn({context:this.#s,getActivations:this.#n,planResult:e,requestScopeCache:new Map})}#b(e,r){r!==void 0&&(r.name!==void 0&&(e.rootConstraints.name=r.name),r.optional===!0&&(e.rootConstraints.isOptional=!0),r.tag!==void 0&&(e.rootConstraints.tag={key:r.tag.key,value:r.tag.value}))}#v(e,r,n){if(r===void 0)return!1;const i={getAncestor:()=>{},name:n?.name,serviceIdentifier:e,tags:new Map};n?.tag!==void 0&&i.tags.set(n.tag.key,n.tag.value);for(const s of r)if(s.isSatisfiedBy(i))return!0;return!1}#w(){this.#i.clearCache(),this.#n=e=>this.#e.get(e),this.#a=this.#t.get.bind(this.#t),this.#s=this.#p(),this.#c=this.#h.bind(this)}#h(e){this.#t.set(e),this.#i.clearCache()}}class On{constructor(e,r,n){this.handler=e,this.filter=r,this.owner=n}}var En=Object.getOwnPropertyDescriptor,Fn=(t,e,r,n)=>{for(var i=n>1?void 0:n?En(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i};let Xe=class{constructor(){this.subscribers=new Set,this.handlerTimeoutMs=8e3,this.middlewares=[],this.lastMessages=new Map,this.metrics={published:0,delivered:0,errors:0,lastError:null,lastPublishTime:0}}getSubscribersByType(t){return Array.from(this.subscribers).filter(e=>{if(typeof e.filter=="function")try{return e.filter({type:t})}catch{return!1}return!0})}getSubscribersByTopic(t){return Array.from(this.subscribers).filter(e=>{if(typeof e.filter=="function")try{return e.filter({topic:t})}catch{return!1}return!0})}get connectionId(){return this.provider&&"connectionId"in this.provider?this.provider.connectionId:void 0}setProvider(t){this.provider=t}async start(){if(!this.provider){console.warn("[BROKER] No transport provider set. Broker will only dispatch locally.");return}await this.provider.connect?.(),this.provider.onMessage?.(this.handleTransportMessage.bind(this)),console.log(`[BROKER] Started with transport '${this.provider.name}' at '${this.provider.endpoint}'`)}async stop(){this.unsubscribeAll(),this.provider?.disconnect&&await this.provider.disconnect(),console.log("[BROKER] Shutdown complete.")}async request(t,e=8e3){if(!this.provider||typeof this.provider.sendRequest!="function")throw new Error("Transport provider does not support request/reply");return await this.provider.sendRequest(t,e)}setErrorHandler(t){this.errorHandler=t}getSubscribers(){return Array.from(this.subscribers)}subscribe(t,e,r){for(const i of this.subscribers)if(i.handler===t&&i.filter===e&&i.owner===r)return console.warn("[BROKER] Duplicate subscription prevented.",{handler:t,filter:e,owner:r}),i;if(!t||typeof t!="function")throw console.warn("[BROKER] Tried to subscribe with missing handler"),new Error("Handler is required for subscription");const n=new On(t,e,r);return this.subscribers.add(n),console.log("[BROKER] Subscribed:",{handler:t,filter:e,owner:r}),n}unsubscribe(t){this.subscribers.delete(t)&&console.log("[BROKER] Unsubscribed:",t)}unsubscribeByOwner(t){for(const e of Array.from(this.subscribers))e.owner===t&&(this.subscribers.delete(e),console.log("[BROKER] Unsubscribed by owner:",t))}unsubscribeAll(){this.subscribers.clear(),console.log("[BROKER] All subscribers cleared")}use(t){this.middlewares.push(t)}subscribeOnce(t,e,r){let n;const i=s=>{t(s),this.unsubscribe(n)};return n=this.subscribe(i,e,r),n}replayLast(t,e){const r=this.lastMessages.get(t);r?e(r):console.log(`[BROKER] No message found for topic '${t}' to replay.`)}timeoutPromise(t,e,r){return Promise.race([t,new Promise((n,i)=>setTimeout(()=>i(new Error(r)),e))])}async publish(t){if(!t)throw new Error("Cannot publish undefined/null message!");this.metrics.published++,this.metrics.lastPublishTime=Date.now(),t.type&&this.lastMessages.set(t.type,t);let e=0;const r=n=>{if(e<this.middlewares.length){const i=this.middlewares[e++];try{i(n,r)}catch(s){console.error("[BROKER] Middleware error:",s),r(n)}}else this._publishCore(n)};r(t)}async _publishCore(t){t.from||(t.from=this.connectionId||this.clientId);let e=0;const r=[];for(const n of this.subscribers){let i=!0;if(typeof n.filter=="function")try{i=await this.timeoutPromise(Promise.resolve(n.filter(t)),this.handlerTimeoutMs,"Filter timed out")}catch(s){i=!1,this.metrics.errors++,this.metrics.lastError=s,console.error("[BROKER] Filter error for subscriber:",n,s)}if(i)try{const s=this.timeoutPromise(Promise.resolve(n.handler(t)),this.handlerTimeoutMs,"Handler timed out").catch(o=>{this.metrics.errors++,this.metrics.lastError=o,console.error("[BROKER] Handler error:",o,n);try{this.errorHandler&&this.errorHandler(o,t,n)}catch(u){console.error("[BROKER] Error handler threw:",u)}});r.push(s),e++}catch(s){this.metrics.errors++,this.metrics.lastError=s,console.error("[BROKER] Handler threw:",s,n);try{this.errorHandler&&this.errorHandler(s,t,n)}catch(o){console.error("[BROKER] Error handler threw:",o)}}}if(this.metrics.delivered+=e,this.provider)try{if(typeof this.provider.readyState=="number"&&this.provider.readyState!==1){console.warn("[BROKER] Transport not open, not sending:",this.provider.name);return}typeof this.provider.sendBroadcast=="function"?await this.provider.sendBroadcast(t):typeof this.provider.send=="function"?await this.provider.send(t.type,t):console.warn("[BROKER] Transport provider missing send method")}catch(n){this.metrics.errors++,this.metrics.lastError=n,console.error("[BROKER] Transport send error:",n);try{this.errorHandler&&this.errorHandler(n,t,void 0)}catch(i){console.error("[BROKER] Error handler threw:",i)}}await Promise.all(r),console.log(`[BROKER] Delivered to ${e} local subscriber(s)`)}handleTransportMessage(t){let e;try{if(typeof t=="string"?e=JSON.parse(t):e=t,e.from&&(e.from===this.connectionId||e.from===this.clientId))return;this.fireToSubscribers(e)}catch(r){console.error("[BROKER] Failed to handle transport message:",t,r)}}fireToSubscribers(t){for(const e of this.subscribers){let r=!0;if(typeof e.filter=="function")try{r=e.filter(t)}catch(n){r=!1,console.error("[BROKER] Filter error for subscriber:",e,n)}if(r)try{Promise.resolve(e.handler(t)).catch(n=>{if(this.errorHandler)try{this.errorHandler(n,t,e)}catch(i){console.error("[BROKER] Error handler threw:",i)}else console.error("[BROKER] Handler error:",n,e)})}catch(n){if(this.errorHandler)try{this.errorHandler(n,t,e)}catch(i){console.error("[BROKER] Error handler threw:",i)}else console.error("[BROKER] Handler threw:",n,e)}}}get endpoint(){return this.provider?.endpoint}get transportName(){return this.provider?.name}};Xe=Fn([j()],Xe);const R={MessageBroker:Symbol.for("MessageBroker"),MessageFilterRegistry:Symbol.for("MessageFilterRegistry"),TransportProviderRegistry:Symbol.for("TransportProviderRegistry"),RuleParser:Symbol.for("RuleParser"),ValidatorRegistry:Symbol.for("ValidatorRegistry"),HttpClientFactory:Symbol.for("HttpClientFactory"),WebSocketTransportProvider:Symbol.for("WebSocketTransportProvider"),FormEventBinder:Symbol.for("FormEventBinder"),ValidatorDispatcher:Symbol.for("ValidatorDispatcher"),FormValidationMiddleware:Symbol.for("FormValidationMiddleware")};var _n=Object.getOwnPropertyDescriptor,$n=(t,e,r,n)=>{for(var i=n>1?void 0:n?_n(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i};let Ye=class{constructor(){this.providers=new Map}register(t,e){if(!t||typeof t!="string"||!t.trim())throw new Error("Provider name must be a non-empty string");if(!e)throw new Error("Provider instance is required");this.providers.set(t,e)}get(t){return this.providers.get(t)}unregister(t){this.providers.delete(t)}has(t){return this.providers.has(t)}list(){return Array.from(this.providers.keys())}clear(){this.providers.clear()}};Ye=$n([j()],Ye);var kn=Object.getOwnPropertyDescriptor,Tn=(t,e,r,n)=>{for(var i=n>1?void 0:n?kn(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i};let et=class{constructor(){this.filters=new Map}register(t,e){if(!t||typeof t!="string"||!t.trim())throw new Error("Filter name must be a non-empty string");if(typeof e!="function")throw new Error("Filter must be a function");this.filters.set(t,e)}get(t){return this.filters.get(t)}unregister(t){this.filters.delete(t)}has(t){return this.filters.has(t)}list(){return Array.from(this.filters.keys())}clear(){this.filters.clear()}};et=Tn([j()],et);var Dn=Object.getOwnPropertyDescriptor,Pn=(t,e,r,n)=>{for(var i=n>1?void 0:n?Dn(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i},Bn=(t,e)=>(r,n)=>e(r,n,t);let tt=class{constructor(t){this.formEventBinder=t,this.label="FormValidation"}attachToForms(){const t=Array.from(document.querySelectorAll('form[validate="true"]'));if(console.log(`[${this.label}] Attaching to ${t.length} forms for validation.`),t.length===0){console.warn(`[${this.label}] No forms found with 'validate="true"'.`);return}t.forEach(e=>this.formEventBinder.bind(e))}middleware(){return(t,e)=>{["FormSubmit","FieldChanged","FieldBlurred","FieldRemoteValidate","FormSubmitted","FieldValidationResult"].includes(t.type)&&console.log(`[${this.label} Middleware] Intercepted:`,t),e(t)}}};tt=Pn([j(),Bn(0,G("IFormEventBinder"))],tt);var xn=Object.getOwnPropertyDescriptor,Cn=(t,e,r,n)=>{for(var i=n>1?void 0:n?xn(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i};let rt=class{parseForm(t){const e=[],r=Array.from(t.elements),n=new Set,i={};r.forEach(s=>{s.name&&(i[s.name]||(i[s.name]=[]),i[s.name].push(s))});for(const[s,o]of Object.entries(i)){if(n.has(s))continue;const u=o[0];let d=[];if(u instanceof HTMLInputElement&&(u.type==="checkbox"||u.type==="radio")){o.forEach(y=>{d=d.concat(this.parseField(y))});const v=new Set;d=d.filter(y=>v.has(y.type)?!1:(v.add(y.type),!0))}else d=this.parseField(u);console.log(`[RuleParser] Field: ${s}, Rules:`,d),d.length>0&&e.push({field:s,rules:d}),n.add(s)}return e}parseField(t){const e=[],r=t;"required"in r&&r.required&&e.push({type:"required"}),"minLength"in r&&r.minLength>0&&e.push({type:"minLength",value:r.minLength}),"maxLength"in r&&r.maxLength>0&&e.push({type:"maxLength",value:r.maxLength}),"pattern"in r&&r.pattern&&e.push({type:"pattern",value:r.pattern}),"type"in r&&r.type==="email"&&e.push({type:"email"}),Array.from(t.attributes).forEach(o=>{if(!o.name.startsWith("data-rule-"))return;const u=o.name.slice(10).toLowerCase();if(!["remote","remote-provider","remote-endpoint"].includes(u))if(u==="minchecked")e.push({type:"minChecked",value:+o.value});else if(u==="minselected")e.push({type:"minSelected",value:+o.value});else if(u==="match"){const d=t.getAttribute("data-match-field");e.push({type:"match",value:o.value,...d?{matchField:d}:{}})}else e.push({type:u,value:o.value})});const n=t.getAttribute("data-rule-remote"),i=t.getAttribute("data-rule-remote-provider"),s=t.getAttribute("data-rule-remote-endpoint");return n&&(i||s)&&e.push({type:"remote",remoteType:n,provider:i||void 0,endpoint:s||void 0}),e}};rt=Cn([j()],rt);var jn=Object.getOwnPropertyDescriptor,Vn=(t,e,r,n)=>{for(var i=n>1?void 0:n?jn(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i};let nt=class{constructor(t){this.delayMs=t,this.timer=null}run(t){this.timer&&clearTimeout(this.timer),this.timer=window.setTimeout(t,this.delayMs)}clear(){this.timer&&clearTimeout(this.timer),this.timer=null}};nt=Vn([j()],nt);var Hn=Object.getOwnPropertyDescriptor,qn=(t,e,r,n)=>{for(var i=n>1?void 0:n?Hn(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i},Yt=(t,e)=>(r,n)=>e(r,n,t);let it=class{constructor(t,e){this.broker=t,this.dispatcher=e,this.fieldDebouncers=new Map,this.fieldHandlerRefs=new WeakMap,this.mutationObservers=new WeakMap,this.boundForms=new Set,this.onFormSubmit=async r=>{r.preventDefault(),console.log("FormEventBinder: onFormSubmit called");const n=r.target,i=n.id||"",s=this.extractFormValues(n);this.broker.publish({type:"FormSubmit",topic:"form",from:"FormEventBinder",payload:{formId:i,values:s},_remote:!1});const o=await this.dispatcher.validateAllFields(i,s,n);let u=!0;for(const{name:d,result:v}of o)this.broker.publish({type:"FieldValidationResult",topic:"form",from:"FormEventBinder",payload:{formId:i,name:d,result:v},_remote:!1}),v.valid||(u=!1);if(u)this.broker.publish({type:"FormSubmitted",topic:"form",from:"FormEventBinder",payload:{formId:i,values:s},_remote:!1});else{const d=o.find(v=>!v.result.valid);if(d){const v=n.querySelector(`[name="${d.name}"]`);v&&v.focus()}}}}bind(t){this.bindFields(t),this.observeForm(t),t.addEventListener("submit",this.onFormSubmit),this.boundForms.add(t),this.broker.publish({type:"KeepAliveRequest",topic:"transport",payload:{formId:t.id},_remote:!1})}unbind(t){const e=this.mutationObservers.get(t);e&&e.disconnect(),this.mutationObservers.delete(t),Array.from(t.elements).filter(this.isBindableField).forEach(r=>{const n=this.fieldHandlerRefs.get(r)||[];["change","blur"].forEach((i,s)=>{n[s]&&r.removeEventListener(i,n[s])}),this.fieldHandlerRefs.delete(r)}),t.removeEventListener("submit",this.onFormSubmit),this.fieldDebouncers.forEach(r=>r.clear()),this.fieldDebouncers.clear(),this.boundForms.delete(t)}unbindAll(){for(const t of this.boundForms){const e=this.mutationObservers.get(t);e&&e.disconnect(),this.unbind(t)}this.boundForms.clear(),this.mutationObservers=new WeakMap,this.fieldDebouncers.clear(),this.fieldHandlerRefs=new WeakMap}observeForm(t){const e=new MutationObserver(()=>this.bindFields(t));e.observe(t,{childList:!0,subtree:!0}),this.mutationObservers.set(t,e)}bindFields(t){Array.from(t.elements).filter(this.isBindableField).forEach(r=>{if(this.fieldHandlerRefs.has(r))return;r.name;const n=this.hasRemoteRule(r),i=s=>{this.handleEvent(s,n)};r.addEventListener("change",i),r.addEventListener("blur",i),this.fieldHandlerRefs.set(r,[i,i])})}handleEvent(t,e){const r=t.target;if(!(!r||!r.name))if(e){let n=this.fieldDebouncers.get(r.name);n||(n=new nt(350),this.fieldDebouncers.set(r.name,n)),n.run(()=>this.onRemoteEvent(t,r))}else this.onLocalEvent(t,r)}onRemoteEvent(t,e){const r=e.form,n=r?.id||void 0,i=this.extractFormValues(r),s={type:"FieldRemoteValidate",topic:"form",payload:{formId:n,name:e.name,value:this.getFieldValue(e),fieldType:e.type,remoteType:e.getAttribute("data-rule-remote"),provider:e.getAttribute("data-rule-remote-provider"),endpoint:e.getAttribute("data-rule-remote-endpoint"),allValues:i},_remote:!1};this.broker.publish(s)}onLocalEvent(t,e){const r=e.form,n=r?.id||void 0,i=this.extractFormValues(r),s={type:t.type==="blur"?"FieldBlurred":"FieldChanged",topic:"form",payload:{formId:n,name:e.name,value:this.getFieldValue(e),fieldType:e.type,allValues:i},_remote:!1};this.broker.publish(s)}extractFormValues(t){if(!t)return{};const e={};return Array.from(t.elements).filter(this.isBindableField).forEach(r=>{r.name&&(e[r.name]=this.getFieldValue(r))}),e}getFieldValue(t){if(t instanceof HTMLInputElement)switch(t.type){case"checkbox":if(t.form){const e=t.form.querySelectorAll(`input[type="checkbox"][name="${t.name}"]`);if(e.length>1)return Array.from(e).filter(r=>r.checked).map(r=>r.value)}return t.checked;case"radio":if(t.form){const e=t.form.querySelector(`input[type="radio"][name="${t.name}"]:checked`);return e?e.value:null}return t.checked?t.value:null;case"file":return t.files?Array.from(t.files):null;default:return t.value}else{if(t instanceof HTMLSelectElement)return t.multiple?Array.from(t.selectedOptions).map(e=>e.value):t.value;if(t instanceof HTMLTextAreaElement)return t.value}}hasRemoteRule(t){return!!(t instanceof HTMLElement&&t.hasAttribute("data-rule-remote")&&t.getAttribute("data-rule-remote-provider"))}isBindableField(t){return!(!(t instanceof HTMLInputElement||t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement)||!t.name||t.type==="hidden"||t.name.startsWith("__")||t.hasAttribute("data-ignore-validation")||t.disabled)}};it=qn([j(),Yt(0,G(R.MessageBroker)),Yt(1,G(R.ValidatorDispatcher))],it);var Ln=Object.getOwnPropertyDescriptor,Nn=(t,e,r,n)=>{for(var i=n>1?void 0:n?Ln(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i},er=(t,e)=>(r,n)=>e(r,n,t);let st=class{constructor(t,e){this.broker=t,this.validatorRegistry=e,this.parsedSchema=null,this.handleMessage=async r=>{const{name:n,value:i,fieldType:s,remoteType:o,provider:u,endpoint:d,formId:v,allValues:y}=r.payload||{};let I=null;try{if(r.type==="FieldRemoteValidate")I=this.runRemoteValidation?await this.runRemoteValidation(o,i,{type:o,provider:u,endpoint:d,fieldType:s,formId:v,value:i,allValues:y}):null;else if(r.type==="FieldChanged"||r.type==="FieldBlurred"){const O=v?document.getElementById(v):void 0;I=await this.runLocalValidation(n,i,s,v,y,O)}else return;I&&this.broker.publish({_remote:!1,type:"FieldValidationResult",topic:"form",from:"ValidatorDispatcher",payload:{formId:v,name:n,result:I},timestamp:new Date().toISOString()})}catch(O){this.broker.publish({_remote:!1,type:"FieldValidationResult",topic:"form",from:"ValidatorDispatcher",payload:{formId:v,name:n,result:{valid:!1,message:O?.message||"Validation error"}},timestamp:new Date().toISOString()})}},this.runLocalValidation=async(r,n,i,s,o,u)=>{let d=null;if(this.parsedSchema?.fields){const y=this.parsedSchema.fields.find(I=>I.field===r);y&&y.rules&&(d=y.rules)}if(!d&&u){const y=u.querySelector(`[name="${r}"]`);y&&(d=this.parseRulesFromDOM(y))}if(!d)return{valid:!0};const v=[];for(const y of d){const I=this.validatorRegistry.getValidator(y.type);if(I)try{const O=await Promise.resolve(I.validate(n,y,o));if(O&&typeof O=="object"&&O.valid===!1){if(y.stopOnFail!==!1)return O;v.push(O.message||"Validation failed")}}catch(O){v.push(O?.message||`Error in ${y.type} validator`)}}return v.length?{valid:!1,message:v.join("; ")}:{valid:!0}},this.runRemoteValidation=async(r,n,i)=>{let s=this.validatorRegistry.getValidator("remote")||this.validatorRegistry.getValidator("Remote");if(!s)return{valid:!1,message:"Remote validation not available"};const o={endpoint:i.endpoint,provider:i.provider,remoteType:r,...i};try{const u=await s.validate(n,o);return typeof u=="boolean"?{valid:u}:u}catch(u){return{valid:!1,message:u?.message||"Remote validation error"}}},this.broker.subscribe(this.handleMessage,r=>r.topic==="form"&&(r.type==="FieldChanged"||r.type==="FieldBlurred"||r.type==="FieldRemoteValidate"))}setSchema(t){this.parsedSchema=t,this.broker&&t&&t.formName&&this.broker.publish({type:"ValidationReady",topic:"form",from:"ValidatorDispatcher",payload:{formId:t.formName},_remote:!1})}parseRulesFromDOM(t){const e=[];for(const r of Array.from(t.attributes))if(r.name.startsWith("data-rule-")){const n=r.name.replace("data-rule-","");let i=r.value;if(i==="true"&&(i=!0),i==="false"&&(i=!1),!isNaN(Number(i))&&i!==""&&(i=Number(i)),n==="remote"){const s=t.getAttribute("data-rule-remote-provider"),o=t.getAttribute("data-rule-remote-endpoint"),u=t.getAttribute("data-rule-remote-type");e.push({type:n,param:i,provider:s,endpoint:o,remoteType:u,message:t.getAttribute("data-rule-message")||void 0})}else e.push({type:n,param:i,message:t.getAttribute("data-rule-message")||void 0})}if(t.hasAttribute("required")&&e.push({type:"required",param:!0,message:t.getAttribute("data-rule-message")||"This field is required."}),t.hasAttribute("minlength")){const r=t.getAttribute("minlength");r&&e.push({type:"minlength",param:parseInt(r),message:t.getAttribute("data-rule-message")||`Minimum length is ${r} characters.`})}if(t.hasAttribute("maxlength")){const r=t.getAttribute("maxlength");r&&e.push({type:"maxlength",param:parseInt(r),message:t.getAttribute("data-rule-message")||`Maximum length is ${r} characters.`})}if(t.hasAttribute("pattern")){const r=t.getAttribute("pattern");r&&e.push({type:"pattern",param:r,message:t.getAttribute("data-rule-message")||"Value does not match required pattern."})}return t instanceof HTMLInputElement&&t.type==="email"&&e.push({type:"email",param:!0,message:t.getAttribute("data-rule-message")||"Please enter a valid email address."}),console.log(`[ValidatorDispatcher] Parsed rules for field ${t.getAttribute("name")}:`,e),e}async validateAllFields(t,e,r){const n=[];if(this.parsedSchema?.fields)for(const i of this.parsedSchema.fields){const s=i.field;let o={valid:!0};for(const u of i.rules){const d=this.validatorRegistry.getValidator(u.type);if(d){let v;if("validate"in d){const y=await Promise.resolve(d.validate(e[s],u,e));v=typeof y=="boolean"?{valid:y}:y}else continue;if(v&&typeof v=="object"&&v.valid===!1){o=v;break}}}n.push({name:s,result:o})}else if(r){console.log(`[ValidatorDispatcher] No schema found, parsing rules from DOM for form: ${t}`);const i=Array.from(r.elements).filter(s=>s instanceof HTMLInputElement||s instanceof HTMLSelectElement||s instanceof HTMLTextAreaElement);for(const s of i){if(!s.name)continue;const o=this.parseRulesFromDOM(s);if(o.length===0)continue;let u={valid:!0};for(const d of o){const v=this.validatorRegistry.getValidator(d.type);if(v)try{const y=await Promise.resolve(v.validate(e[s.name],d,e)),I=typeof y=="boolean"?{valid:y}:y;if(I&&typeof I=="object"&&I.valid===!1){u=I;break}}catch(y){console.error(`[ValidatorDispatcher] Error validating field ${s.name}:`,y),u={valid:!1,message:y?.message||`Error in ${d.type} validator`};break}else console.warn(`[ValidatorDispatcher] Validator not found for type: ${d.type}`)}n.push({name:s.name,result:u})}}else console.warn("[ValidatorDispatcher] No schema or form element provided for validation");return console.log(`[ValidatorDispatcher] Validation results for form ${t}:`,n),n}};st=Nn([j(),er(0,G(R.MessageBroker)),er(1,G(R.ValidatorRegistry))],st);var Wn=Object.getOwnPropertyDescriptor,Un=(t,e,r,n)=>{for(var i=n>1?void 0:n?Wn(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i};let ot=class{constructor(){this.validators=new Map}register(t,e){this.validators.set(t,e)}getValidator(t){const e=this.validators.get(t);return console.log(`[ValidatorRegistry] getValidator('${t}') =>`,e?"FOUND":"NOT FOUND"),e}unregister(t){this.validators.delete(t)}listValidators(){return Array.from(this.validators.keys())}clear(){this.validators.clear()}};ot=Un([j()],ot);var Kn=Object.getOwnPropertyDescriptor,Gn=(t,e,r,n)=>{for(var i=n>1?void 0:n?Kn(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i};let Pe=class{constructor(t={}){this.config=t}async applyInterceptors(t,e={}){let r=[t,e];if(this.config.interceptors)for(const n of this.config.interceptors)r=await n(r[0],r[1]);return r}async handleResponse(t){let e=t;if(this.config.responseInterceptors)for(const r of this.config.responseInterceptors)e=await r(e);return e}async request(t,e,r,n){let i=e,s={...this.config.defaultHeaders,...n?.headers||{}},o={method:t,...n,headers:s};this.config.baseUrl&&!/^https?:\/\//.test(e)&&(i=this.config.baseUrl.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,"")),r!==void 0&&t!=="GET"&&t!=="HEAD"&&(o.body=typeof r=="string"?r:JSON.stringify(r),s["Content-Type"]||(s["Content-Type"]="application/json"));const[u,d]=await this.applyInterceptors(i,o);let v;typeof u=="string"?v=await fetch(u,d):v=await fetch(u);const y=await this.handleResponse(v);if(!y.ok)throw new Error(`[HttpClient] Request failed: ${y.status} ${y.statusText}`);const I=y.headers.get("content-type");return I&&I.includes("application/json")?y.json():y.text()}get(t,e){return this.request("GET",t,void 0,e)}post(t,e,r){return this.request("POST",t,e,r)}put(t,e,r){return this.request("PUT",t,e,r)}delete(t,e){return this.request("DELETE",t,void 0,e)}async send(t,e){return this.post(t,e)}};Pe=Gn([j()],Pe);var zn=Object.getOwnPropertyDescriptor,Jn=(t,e,r,n)=>{for(var i=n>1?void 0:n?zn(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i};let at=class{create(t,e){return e||(e=new Pe(t||{})),new Pe({baseUrl:t?.baseUrl,defaultHeaders:t?.defaultHeaders,interceptors:t?.interceptors,responseInterceptors:t?.responseInterceptors})}};at=Jn([j()],at);let Te;const Zn=new Uint8Array(16);function Qn(){if(!Te&&(Te=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Te))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Te(Zn)}const C=[];for(let t=0;t<256;++t)C.push((t+256).toString(16).slice(1));function Xn(t,e=0){return C[t[e+0]]+C[t[e+1]]+C[t[e+2]]+C[t[e+3]]+"-"+C[t[e+4]]+C[t[e+5]]+"-"+C[t[e+6]]+C[t[e+7]]+"-"+C[t[e+8]]+C[t[e+9]]+"-"+C[t[e+10]]+C[t[e+11]]+C[t[e+12]]+C[t[e+13]]+C[t[e+14]]+C[t[e+15]]}const Yn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),tr={randomUUID:Yn};function ve(t,e,r){if(tr.randomUUID&&!t)return tr.randomUUID();t=t||{};const n=t.random||(t.rng||Qn)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,Xn(n)}var ei=Object.getOwnPropertyDescriptor,ti=(t,e,r,n)=>{for(var i=n>1?void 0:n?ei(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i};let ct=class{constructor(){this.name="WebSocketTransport",this.endpoint="",this.id=ve(),this.isOpen=!1,this.clientId=ve(),this.ws=null,this._connectionId=null,this.isConnecting=!1,this.handlers=new Set,this.topicHandlers=new Map,this.pending=new Map,this.autoReconnect=!0,this.reconnectDelay=1e3,this.maxReconnectDelay=3e4,this.reconnectAttempts=0,this.reconnectTimer=null,this.logger=null,this.resetOpenPromise(),typeof window<"u"&&window.addEventListener("beforeunload",()=>this.disconnect())}get readyState(){return this.ws?.readyState??WebSocket.CLOSED}setEndpoint(t){this.endpoint!==t&&(this.endpoint=t,this.connect())}async connect(){if(!this.endpoint)throw new Error("WebSocket endpoint not set. Use setEndpoint() first.");this.isOpen||this.isConnecting||(this.isConnecting=!0,this.ws&&(this.log("[WS] Closing old socket before reconnect"),this.ws.close()),this.ws=new WebSocket(this.endpoint),this.ws.onopen=()=>{this.isConnecting=!1,this.openResolve(),this.onOpen?.(this),this.resetOpenPromise(),this.log("[WS] Connected"),this.reconnectAttempts=0,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)},this.ws.onclose=t=>{this._connectionId=null,this.onClose?.(t,this),this.log("[WS] Disconnected"),this.rejectAllPending("WebSocket closed"),this.autoReconnect&&this.endpoint&&this.scheduleReconnect()},this.ws.onerror=t=>{const e=new Error("WebSocket error");e.event=t,this.onError?.(e,this,t),this.log(`[WS] Error: ${e}`),this.rejectAllPending("WebSocket error"),this.autoReconnect&&this.endpoint&&this.scheduleReconnect()},this.ws.onmessage=t=>{this.onRawMessage?.(t.data,this),this.handleIncomingMessage(t.data)})}async disconnect(){this.ws&&(this.ws.close(),this.ws=null,this.rejectAllPending("WebSocket disconnected"))}async sendBroadcast(t){await this.send(t.type,t)}async send(t,e){if(await this.openPromise,!this.ws||this.ws.readyState!==WebSocket.OPEN)throw new Error("WebSocket not open");const r=typeof e=="object"?{...e}:{type:String(e)};r.id??=ve(),r.from??=this.connectionId??this.clientId,r.timestamp??=new Date().toISOString(),this.connectionId&&(r.connectionId=this.connectionId),this.ws.send(JSON.stringify(r)),this.log(`[WS] Sent: ${r.type} ${r.topic??""} ${r.id}`)}async sendRequest(t,e=8e3){return this.request(t,e)}onMessage(t){this.onAny(t)}subscribe(t,e){this.topicHandlers.has(t)||this.topicHandlers.set(t,new Set),this.topicHandlers.get(t).add(e)}unsubscribe(t,e){this.topicHandlers.has(t)&&(this.topicHandlers.get(t).delete(e),this.topicHandlers.get(t).size===0&&this.topicHandlers.delete(t))}onAny(t){this.handlers.add(t)}async ping(){const t=Date.now();return await this.request({type:"Ping",_remote:!1}),Date.now()-t}async sendUserMessage(t){await this.send("UserMessage",{type:"UserMessage",payload:t,_remote:!1}).catch(e=>{this.log("Failed to send user message: "+e)})}async sendMsgInternal(t){if(await this.openPromise,!this.ws||this.ws.readyState!==WebSocket.OPEN)throw new Error("WebSocket not open");this.ws.send(JSON.stringify(t)),this.log(`[WS] Sent: ${t.type} ${t.topic??""} ${t.id}`)}async request(t,e=8e3){if(await this.openPromise,t.id??=ve(),t.from??=this.connectionId??this.clientId,t.timestamp??=new Date().toISOString(),this.connectionId&&(t.connectionId=this.connectionId),!this.ws||this.ws.readyState!==WebSocket.OPEN)throw new Error("WebSocket not open");return this.ws.send(JSON.stringify(t)),this.log(`[WS] Sent: ${t.type} ${t.topic??""} ${t.id}`),new Promise((r,n)=>{const i=setTimeout(()=>{this.pending.delete(t.id),this.log(`[WS][TIMEOUT] Request timed out for msg.id=${t.id} type=${t.type} 
          from=${t.from} connId=${this.connectionId??this.clientId} endpoint=${this.endpoint}`),n(new Error(`Request timed out (id=${t.id}, type=${t.type}, from=${t.from}, connId=${this.connectionId??this.clientId}, endpoint=${this.endpoint})`))},e);this.pending.set(t.id,s=>{clearTimeout(i),this.pending.delete(t.id),r(s)})})}handleIncomingMessage(t){let e;try{e=JSON.parse(t)}catch{this.log("Malformed message: "+t);return}e.type==="ConnectionId"&&e.id&&(this._connectionId=e.id,this.onConnectionIdAssigned?.(e.id),this.log(`[WS] Assigned connectionId: ${this._connectionId}`)),e.id&&this.pending.has(e.id)&&this.pending.get(e.id)(e),e.topic&&this.topicHandlers.has(e.topic)&&this.topicHandlers.get(e.topic).forEach(r=>r(e)),this.handlers.forEach(r=>r(e)),this.log(`[WS] Received: ${e.type} ${e.topic??""} ${e.id??""}`)}rejectAllPending(t){for(const[e,r]of this.pending.entries())r({type:"Error",error:t,id:e});this.pending.clear()}resetOpenPromise(){this.openPromise=new Promise(t=>this.openResolve=t)}log(t){this.logger?this.logger(t):typeof window<"u"&&window.console?console.log(`%c${t}`):console.log(t)}scheduleReconnect(){this.reconnectAttempts++;const t=Math.min(this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),this.maxReconnectDelay);this.log(`[WS] Reconnecting in ${t}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},t)}get connectionId(){return this._connectionId}};ct=ti([j()],ct);const D=new An;D.bind(R.MessageBroker).to(Xe).inSingletonScope();D.bind(R.TransportProviderRegistry).to(Ye).inSingletonScope();D.bind(R.MessageFilterRegistry).to(et).inSingletonScope();D.bind(R.WebSocketTransportProvider).to(ct).inSingletonScope();D.bind(R.RuleParser).to(rt).inSingletonScope();D.bind(R.ValidatorDispatcher).to(st).inSingletonScope();D.bind(R.ValidatorRegistry).to(ot).inSingletonScope();D.bind(R.HttpClientFactory).to(at).inSingletonScope();const ri=new it(D.get(R.MessageBroker),D.get(R.ValidatorDispatcher));D.bind(R.FormEventBinder).toConstantValue(ri);D.bind(R.FormValidationMiddleware).toConstantValue(new tt(D.get(R.FormEventBinder)));function ni(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}class W{constructor(){this.name="InMemoryTransport",this.endpoint="local",this.readyState=1}static{this.globalListeners=new Set}static{this.pendingReplies=new Map}onMessage(e){this.onMessageHandler=e,W.globalListeners.add(e)}async disconnect(){this.onMessageHandler&&(W.globalListeners.delete(this.onMessageHandler),this.onMessageHandler=void 0)}async connect(){}async sendBroadcast(e){W.globalListeners.forEach(r=>{try{r(e)}catch{}})}async send(e,r){await this.sendBroadcast(r)}async sendRequest(e,r=8e3){return e.id||(e.id=ni()),e._isRequest=!0,new Promise((n,i)=>{const s=setTimeout(()=>{W.pendingReplies.delete(e.id),i(new Error("Request timed out: "+e.id))},r);W.pendingReplies.set(e.id,o=>{clearTimeout(s),W.pendingReplies.delete(e.id),n(o)}),this.sendBroadcast(e)})}static replyToRequest(e,r){const n={...r,id:e.id,_isReply:!0},i=W.pendingReplies.get(e.id);i&&i(n)}}function ii(t,e=""){return(r,n)=>{const i=t.getSubscribers();console.log(`[LiveSubscribers] ${e} Subscribers: ${i.length}`);let s=1;for(const o of i){let u=o.handler.name||"(anonymous)";console.log(`  ${s++}. Handler: ${u}`,o)}n(r)}}var si=Object.getOwnPropertyDescriptor,oi=(t,e,r,n)=>{for(var i=n>1?void 0:n?si(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i},ai=(t,e)=>(r,n)=>e(r,n,t);let lt=class{constructor(t){this.broker=t,t.subscribe(e=>this.handleMessage(e),e=>e.type==="FieldValidationResult"||e.type==="StatusMessage"||e.type==="ErrorMessage")}handleMessage(t){if(!t?.payload)return;const e=t.payload.name??t.payload.field,{formId:r,formName:n}=t.payload;if(!e)return;const i=this.findMsgEl(r,n,e);if(i){if(t.type==="FieldValidationResult"&&t.payload.result){const s=t.payload.result;typeof s.valid=="boolean"&&(s.valid?this.clearField(i):this.showFieldMessage(i,s.message||"Invalid value","error"))}else if((t.type==="StatusMessage"||t.type==="ErrorMessage")&&t.payload.message){const s=t.type==="ErrorMessage"?"error":t.payload.level||"info";this.showFieldMessage(i,t.payload.message,s)}}}findMsgEl(t,e,r){const n=r.replace(/\[\]$/,"");if(t){const i=document.getElementById(t);if(i)return i.querySelector(`[data-valmsg-for="${n}"]`)}if(e){const i=document.querySelector(`form[name="${e}"]`);if(i)return i.querySelector(`[data-valmsg-for="${n}"]`)}return document.querySelector(`[data-valmsg-for="${n}"]`)}showFieldMessage(t,e,r){t.innerHTML=`<span class="toast toast-${r}" aria-live="polite">${e}</span>`,t.setAttribute("role","alert"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.setAttribute("data-valmsg-active",r),r!=="error"&&(t.offsetWidth,t.classList.add("fade-out-toast"),t.addEventListener("animationend",()=>this.clearField(t),{once:!0}))}clearField(t){t.innerHTML="",t.removeAttribute("role"),t.removeAttribute("aria-live"),t.removeAttribute("aria-atomic"),t.removeAttribute("data-valmsg-active"),t.classList.remove("fade-out-toast")}};lt=oi([j(),ai(0,G(R.MessageBroker))],lt);class ci{constructor(){this.name="required"}validate(e,r){let n;return Array.isArray(e)?n=e.length>0:typeof e=="boolean"?n=e:e==null?n=!1:n=e!=="",{valid:n,message:n?void 0:r.message||"This field is required."}}}class li{constructor(){this.name="email",this.emailRegex=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/}validate(e,r){const n=typeof e=="string"&&this.emailRegex.test(e);return{valid:n,message:n?void 0:r.message||"Invalid email address."}}}class ui{constructor(){this.name="minlength"}validate(e,r){const n=r.value||0,i=typeof e=="string"&&e.length>=n;return{valid:i,message:i?void 0:r.message||`Minimum length is ${n}.`}}}class di{constructor(){this.name="maxlength"}validate(e,r){const n=r.value||0,i=typeof e=="string"&&e.length<=n;return{valid:i,message:i?void 0:r.message||`Maximum length is ${n}.`}}}class hi{constructor(){this.name="match"}validate(e,r,n){const i=r.matchField||r.value;if(console.log("MatchValidator allValues:",n,"otherField:",i,"allValues[otherField]:",n?n[i]:void 0),!i)return{valid:!1,message:r.message||"No field to match specified."};if(!n||!(i in n))return{valid:!1,message:r.message||`Field to match (${i}) not found.`};const s=e===n[i];return{valid:s,message:s?void 0:r.message||"Values do not match."}}}var fi=Object.getOwnPropertyDescriptor,pi=(t,e,r,n)=>{for(var i=n>1?void 0:n?fi(e,r):e,s=t.length-1,o;s>=0;s--)(o=t[s])&&(i=o(i)||i);return i},rr=(t,e)=>(r,n)=>e(r,n,t);let ut=class{constructor(t,e){this.httpClientFactory=t,this.webSocketTransportProvider=e,this.name="remote"}async validate(t,e,r){if(e.provider==="WebSocket"){const i=this.webSocketTransportProvider;if(!i)return{valid:!1,isValid:!1,errorMessage:"WebSocket provider missing."};if(!e.endpoint)return{valid:!1,isValid:!1,errorMessage:"No endpoint specified."};if(i.readyState!==WebSocket.OPEN)return{valid:!1,isValid:!1,errorMessage:"WebSocket not connected."};const s={type:"RemoteValidationRequest",id:ve(),payload:{endpoint:e.endpoint,data:{value:t,allValues:r}},_remote:!1};try{const o=await i.sendRequest(s);return typeof o.valid!="boolean"?{valid:!1,isValid:!1,errorMessage:"Invalid response from remote validator."}:{valid:!!o.valid,isValid:!!o.valid,errorMessage:o.message??(o.valid?"":"Remote validation failed.")}}catch(o){return{valid:!1,isValid:!1,errorMessage:o?.message??(typeof o=="string"?o:"Error during WebSocket validation.")}}}const n=this.httpClientFactory.create();if(!e.endpoint)return{valid:!1,isValid:!1,errorMessage:"No endpoint specified."};try{const i=await n.post(e.endpoint,{value:t,allValues:r});return{valid:!!i.valid,isValid:!!i.valid,errorMessage:i.message??(i.valid?"":"Remote validation failed.")}}catch(i){return{valid:!1,isValid:!1,errorMessage:i?.message??(typeof i=="string"?i:"HTTP error during validation.")}}}};ut=pi([j(),rr(0,G(R.HttpClientFactory)),rr(1,G(R.WebSocketTransportProvider))],ut);class ne{constructor(){}static getInstance(){return ne.instance||(ne.instance=new ne),ne.instance}debugFormDetection(){console.log(" [FormDebugger] Starting form detection debug...");const e=Array.from(document.querySelectorAll('form[validate="true"]'));console.log(` [FormDebugger] Found ${e.length} forms with validate="true":`,e.map(i=>({id:i.id,name:i.name})));const r=Array.from(document.querySelectorAll("form")),n=r.filter(i=>Array.from(i.elements).filter(o=>o instanceof HTMLElement&&Array.from(o.attributes).some(u=>u.name.startsWith("data-rule-"))).length>0);console.log(` [FormDebugger] Found ${n.length} forms with validation rules:`,n.map(i=>({id:i.id,name:i.name}))),r.forEach((i,s)=>{console.log(`
 [FormDebugger] Form ${s+1}:`,{id:i.id,name:i.name,action:i.action,method:i.method,hasValidateAttr:i.hasAttribute("validate"),validateValue:i.getAttribute("validate"),fields:this.getFormFieldsInfo(i)})})}debugFormFields(e){(e?[document.getElementById(e)].filter(Boolean):Array.from(document.querySelectorAll("form"))).forEach(n=>{console.log(`
 [FormDebugger] Debugging form: ${n.id||"unnamed"}`),Array.from(n.elements).filter(s=>s instanceof HTMLInputElement||s instanceof HTMLSelectElement||s instanceof HTMLTextAreaElement).forEach(s=>{const o=this.extractFieldRules(s);console.log(`   Field: ${s.name} (${s.type})`,{value:s.value,rules:o,hasRules:o.length>0,required:s.hasAttribute("required"),disabled:s.disabled,hidden:s.type==="hidden"})})})}debugValidationRegistry(e){if(console.log(" [FormDebugger] Validation Registry Debug:"),e&&typeof e.listValidators=="function"){const r=e.listValidators();console.log(`   Registered validators: ${r.join(", ")}`),r.forEach(n=>{const i=e.getValidator(n);console.log(`   ${n}:`,{name:i?.name,hasValidate:typeof i?.validate=="function",type:typeof i})})}else console.log("   Registry not available or invalid")}debugMessageBroker(e){if(console.log(" [FormDebugger] Message Broker Debug:"),e&&typeof e.publish=="function"){console.log("   Message broker is available");try{e.publish({type:"DebugTest",topic:"debug",payload:{test:!0},_remote:!1}),console.log("   Message publishing works")}catch(r){console.log("   Message publishing failed:",r)}}else console.log("   Message broker not available or invalid")}testFormSubmission(e){const r=document.getElementById(e);if(!r){console.log(` [FormDebugger] Form with id "${e}" not found`);return}console.log(` [FormDebugger] Testing form submission for: ${e}`);const n=new Event("submit",{bubbles:!0,cancelable:!0}),i=r.addEventListener;r.addEventListener=function(s,o,u){return s==="submit"&&console.log("   [FormDebugger] Submit event listener added"),i.call(this,s,o,u)},console.log("   [FormDebugger] Dispatching submit event..."),r.dispatchEvent(n),r.addEventListener=i}getFormInfo(e){const r=document.getElementById(e);return r?{id:r.id,name:r.name,action:r.action,method:r.method,hasValidateAttr:r.hasAttribute("validate"),validateValue:r.getAttribute("validate"),fields:this.getFormFieldsInfo(r),eventListeners:this.getEventListenersInfo(r)}:null}getFormFieldsInfo(e){return Array.from(e.elements).filter(n=>n instanceof HTMLInputElement||n instanceof HTMLSelectElement||n instanceof HTMLTextAreaElement).map(n=>({name:n.name,type:n.type,value:n.value,rules:this.extractFieldRules(n),required:n.hasAttribute("required"),disabled:n.disabled,hidden:n.type==="hidden"}))}extractFieldRules(e){const r=[];for(const n of Array.from(e.attributes))if(n.name.startsWith("data-rule-")){const i=n.name.replace("data-rule-","");r.push({type:i,value:n.value,attribute:n.name})}return e.hasAttribute("required")&&r.push({type:"required",value:!0,attribute:"required"}),e.hasAttribute("minlength")&&r.push({type:"minlength",value:e.getAttribute("minlength"),attribute:"minlength"}),e.hasAttribute("maxlength")&&r.push({type:"maxlength",value:e.getAttribute("maxlength"),attribute:"maxlength"}),e.hasAttribute("pattern")&&r.push({type:"pattern",value:e.getAttribute("pattern"),attribute:"pattern"}),r}getEventListenersInfo(e){return{hasSubmitListener:"Cannot determine without browser dev tools",note:"Check browser dev tools > Elements > Event Listeners tab"}}}const Q=ne.getInstance(),vi={debugForm:t=>{console.log(" [DebugHelper] Quick form debug:",t);const e=Q.getFormInfo(t);console.log(e)},testSubmit:t=>{Q.testFormSubmission(t)},debugAll:()=>{Q.debugFormDetection(),Q.debugFormFields()}};typeof window<"u"&&(window.formValidationDebug=vi,console.log(" [FormDebugger] Debug helpers available at window.formValidationDebug"),console.log('  Usage: formValidationDebug.debugForm("formId")'),console.log('  Usage: formValidationDebug.testSubmit("formId")'),console.log("  Usage: formValidationDebug.debugAll()"));const ce=D.get(R.MessageBroker),pr=D.get(R.TransportProviderRegistry),vr=D.get(R.FormValidationMiddleware),gi=D.get(R.MessageFilterRegistry),ee=D.get(R.ValidatorRegistry);pr.register("memory",new W);ce.setProvider(pr.get("memory"));gi.register("NotificationComponent",t=>t.type==="notification");ee.register("required",new ci);ee.register("email",new li);ee.register("minlength",new ui);ee.register("maxlength",new di);ee.register("match",new hi);ee.register("remote",new ut(D.get(R.HttpClientFactory),D.get(R.WebSocketTransportProvider)));ce.use(ii(ce,"Form Events"));ce.use(vr.middleware());vr.attachToForms();new lt(ce);console.log(" [FormValidation] System initialized successfully");Q.debugFormDetection();Q.debugValidationRegistry(ee);Q.debugMessageBroker(ce);
//# sourceMappingURL=form-validation.js.map
