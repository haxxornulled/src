var FormValidation=function(Ie){"use strict";var wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},St={};/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */var Mt;function Rr(){if(Mt)return St;Mt=1;var t;return function(e){(function(r){var n=typeof globalThis=="object"?globalThis:typeof wt=="object"?wt:typeof self=="object"?self:typeof this=="object"?this:d(),i=o(e);typeof n.Reflect<"u"&&(i=o(n.Reflect,i)),r(i,n),typeof n.Reflect>"u"&&(n.Reflect=e);function o(h,m){return function(A,O){Object.defineProperty(h,A,{configurable:!0,writable:!0,value:O}),m&&m(A,O)}}function s(){try{return Function("return this;")()}catch{}}function l(){try{return(0,eval)("(function() { return this; })()")}catch{}}function d(){return s()||l()}})(function(r,n){var i=Object.prototype.hasOwnProperty,o=typeof Symbol=="function",s=o&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",l=o&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",d=typeof Object.create=="function",h={__proto__:[]}instanceof Array,m=!d&&!h,A={create:d?function(){return bt(Object.create(null))}:h?function(){return bt({__proto__:null})}:function(){return bt({})},has:m?function(a,c){return i.call(a,c)}:function(a,c){return c in a},get:m?function(a,c){return i.call(a,c)?a[c]:void 0}:function(a,c){return a[c]}},O=Object.getPrototypeOf(Function),_=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Vi(),Se=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:_i(),gt=typeof WeakMap=="function"?WeakMap:Ci(),oe=o?Symbol.for("@reflect-metadata:registry"):void 0,ke=Ei(),ar=Ti(ke);function li(a,c,u,f){if(S(u)){if(!mr(a))throw new TypeError;if(!vr(c))throw new TypeError;return bi(a,c)}else{if(!mr(a))throw new TypeError;if(!D(c))throw new TypeError;if(!D(f)&&!S(f)&&!se(f))throw new TypeError;return se(f)&&(f=void 0),u=N(u),wi(a,c,u,f)}}r("decorate",li);function ui(a,c){function u(f,w){if(!D(f))throw new TypeError;if(!S(w)&&!Ai(w))throw new TypeError;dr(a,c,f,w)}return u}r("metadata",ui);function di(a,c,u,f){if(!D(u))throw new TypeError;return S(f)||(f=N(f)),dr(a,c,u,f)}r("defineMetadata",di);function fi(a,c,u){if(!D(c))throw new TypeError;return S(u)||(u=N(u)),cr(a,c,u)}r("hasMetadata",fi);function hi(a,c,u){if(!D(c))throw new TypeError;return S(u)||(u=N(u)),mt(a,c,u)}r("hasOwnMetadata",hi);function pi(a,c,u){if(!D(c))throw new TypeError;return S(u)||(u=N(u)),lr(a,c,u)}r("getMetadata",pi);function gi(a,c,u){if(!D(c))throw new TypeError;return S(u)||(u=N(u)),ur(a,c,u)}r("getOwnMetadata",gi);function mi(a,c){if(!D(a))throw new TypeError;return S(c)||(c=N(c)),fr(a,c)}r("getMetadataKeys",mi);function vi(a,c){if(!D(a))throw new TypeError;return S(c)||(c=N(c)),hr(a,c)}r("getOwnMetadataKeys",vi);function yi(a,c,u){if(!D(c))throw new TypeError;if(S(u)||(u=N(u)),!D(c))throw new TypeError;S(u)||(u=N(u));var f=Me(c,u,!1);return S(f)?!1:f.OrdinaryDeleteMetadata(a,c,u)}r("deleteMetadata",yi);function bi(a,c){for(var u=a.length-1;u>=0;--u){var f=a[u],w=f(c);if(!S(w)&&!se(w)){if(!vr(w))throw new TypeError;c=w}}return c}function wi(a,c,u,f){for(var w=a.length-1;w>=0;--w){var C=a[w],B=C(c,u,f);if(!S(B)&&!se(B)){if(!D(B))throw new TypeError;f=B}}return f}function cr(a,c,u){var f=mt(a,c,u);if(f)return!0;var w=yt(c);return se(w)?!1:cr(a,w,u)}function mt(a,c,u){var f=Me(c,u,!1);return S(f)?!1:gr(f.OrdinaryHasOwnMetadata(a,c,u))}function lr(a,c,u){var f=mt(a,c,u);if(f)return ur(a,c,u);var w=yt(c);if(!se(w))return lr(a,w,u)}function ur(a,c,u){var f=Me(c,u,!1);if(!S(f))return f.OrdinaryGetOwnMetadata(a,c,u)}function dr(a,c,u,f){var w=Me(u,f,!0);w.OrdinaryDefineOwnMetadata(a,c,u,f)}function fr(a,c){var u=hr(a,c),f=yt(a);if(f===null)return u;var w=fr(f,c);if(w.length<=0)return u;if(u.length<=0)return w;for(var C=new Se,B=[],I=0,p=u;I<p.length;I++){var g=p[I],v=C.has(g);v||(C.add(g),B.push(g))}for(var y=0,R=w;y<R.length;y++){var g=R[y],v=C.has(g);v||(C.add(g),B.push(g))}return B}function hr(a,c){var u=Me(a,c,!1);return u?u.OrdinaryOwnMetadataKeys(a,c):[]}function pr(a){if(a===null)return 1;switch(typeof a){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return a===null?1:6;default:return 6}}function S(a){return a===void 0}function se(a){return a===null}function Si(a){return typeof a=="symbol"}function D(a){return typeof a=="object"?a!==null:typeof a=="function"}function Mi(a,c){switch(pr(a)){case 0:return a;case 1:return a;case 2:return a;case 3:return a;case 4:return a;case 5:return a}var u="string",f=yr(a,s);if(f!==void 0){var w=f.call(a,u);if(D(w))throw new TypeError;return w}return Ii(a)}function Ii(a,c){var u,f,w;{var C=a.toString;if(je(C)){var f=C.call(a);if(!D(f))return f}var u=a.valueOf;if(je(u)){var f=u.call(a);if(!D(f))return f}}throw new TypeError}function gr(a){return!!a}function Ri(a){return""+a}function N(a){var c=Mi(a);return Si(c)?c:Ri(c)}function mr(a){return Array.isArray?Array.isArray(a):a instanceof Object?a instanceof Array:Object.prototype.toString.call(a)==="[object Array]"}function je(a){return typeof a=="function"}function vr(a){return typeof a=="function"}function Ai(a){switch(pr(a)){case 3:return!0;case 4:return!0;default:return!1}}function vt(a,c){return a===c||a!==a&&c!==c}function yr(a,c){var u=a[c];if(u!=null){if(!je(u))throw new TypeError;return u}}function br(a){var c=yr(a,l);if(!je(c))throw new TypeError;var u=c.call(a);if(!D(u))throw new TypeError;return u}function wr(a){return a.value}function Sr(a){var c=a.next();return c.done?!1:c}function Mr(a){var c=a.return;c&&c.call(a)}function yt(a){var c=Object.getPrototypeOf(a);if(typeof a!="function"||a===O||c!==O)return c;var u=a.prototype,f=u&&Object.getPrototypeOf(u);if(f==null||f===Object.prototype)return c;var w=f.constructor;return typeof w!="function"||w===a?c:w}function Oi(){var a;!S(oe)&&typeof n.Reflect<"u"&&!(oe in n.Reflect)&&typeof n.Reflect.defineMetadata=="function"&&(a=Fi(n.Reflect));var c,u,f,w=new gt,C={registerProvider:B,getProvider:p,setProvider:v};return C;function B(y){if(!Object.isExtensible(C))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case a===y:break;case S(c):c=y;break;case c===y:break;case S(u):u=y;break;case u===y:break;default:f===void 0&&(f=new Se),f.add(y);break}}function I(y,R){if(!S(c)){if(c.isProviderFor(y,R))return c;if(!S(u)){if(u.isProviderFor(y,R))return c;if(!S(f))for(var E=br(f);;){var P=Sr(E);if(!P)return;var q=wr(P);if(q.isProviderFor(y,R))return Mr(E),q}}}if(!S(a)&&a.isProviderFor(y,R))return a}function p(y,R){var E=w.get(y),P;return S(E)||(P=E.get(R)),S(P)&&(P=I(y,R),S(P)||(S(E)&&(E=new _,w.set(y,E)),E.set(R,P))),P}function g(y){if(S(y))throw new TypeError;return c===y||u===y||!S(f)&&f.has(y)}function v(y,R,E){if(!g(E))throw new Error("Metadata provider not registered.");var P=p(y,R);if(P!==E){if(!S(P))return!1;var q=w.get(y);S(q)&&(q=new _,w.set(y,q)),q.set(R,E)}return!0}}function Ei(){var a;return!S(oe)&&D(n.Reflect)&&Object.isExtensible(n.Reflect)&&(a=n.Reflect[oe]),S(a)&&(a=Oi()),!S(oe)&&D(n.Reflect)&&Object.isExtensible(n.Reflect)&&Object.defineProperty(n.Reflect,oe,{enumerable:!1,configurable:!1,writable:!1,value:a}),a}function Ti(a){var c=new gt,u={isProviderFor:function(g,v){var y=c.get(g);return S(y)?!1:y.has(v)},OrdinaryDefineOwnMetadata:B,OrdinaryHasOwnMetadata:w,OrdinaryGetOwnMetadata:C,OrdinaryOwnMetadataKeys:I,OrdinaryDeleteMetadata:p};return ke.registerProvider(u),u;function f(g,v,y){var R=c.get(g),E=!1;if(S(R)){if(!y)return;R=new _,c.set(g,R),E=!0}var P=R.get(v);if(S(P)){if(!y)return;if(P=new _,R.set(v,P),!a.setProvider(g,v,u))throw R.delete(v),E&&c.delete(g),new Error("Wrong provider for target.")}return P}function w(g,v,y){var R=f(v,y,!1);return S(R)?!1:gr(R.has(g))}function C(g,v,y){var R=f(v,y,!1);if(!S(R))return R.get(g)}function B(g,v,y,R){var E=f(y,R,!0);E.set(g,v)}function I(g,v){var y=[],R=f(g,v,!1);if(S(R))return y;for(var E=R.keys(),P=br(E),q=0;;){var Ir=Sr(P);if(!Ir)return y.length=q,y;var Pi=wr(Ir);try{y[q]=Pi}catch($i){try{Mr(P)}finally{throw $i}}q++}}function p(g,v,y){var R=f(v,y,!1);if(S(R)||!R.delete(g))return!1;if(R.size===0){var E=c.get(v);S(E)||(E.delete(y),E.size===0&&c.delete(E))}return!0}}function Fi(a){var c=a.defineMetadata,u=a.hasOwnMetadata,f=a.getOwnMetadata,w=a.getOwnMetadataKeys,C=a.deleteMetadata,B=new gt,I={isProviderFor:function(p,g){var v=B.get(p);return!S(v)&&v.has(g)?!0:w(p,g).length?(S(v)&&(v=new Se,B.set(p,v)),v.add(g),!0):!1},OrdinaryDefineOwnMetadata:c,OrdinaryHasOwnMetadata:u,OrdinaryGetOwnMetadata:f,OrdinaryOwnMetadataKeys:w,OrdinaryDeleteMetadata:C};return I}function Me(a,c,u){var f=ke.getProvider(a,c);if(!S(f))return f;if(u){if(ke.setProvider(a,c,ar))return ar;throw new Error("Illegal state.")}}function Vi(){var a={},c=[],u=function(){function I(p,g,v){this._index=0,this._keys=p,this._values=g,this._selector=v}return I.prototype["@@iterator"]=function(){return this},I.prototype[l]=function(){return this},I.prototype.next=function(){var p=this._index;if(p>=0&&p<this._keys.length){var g=this._selector(this._keys[p],this._values[p]);return p+1>=this._keys.length?(this._index=-1,this._keys=c,this._values=c):this._index++,{value:g,done:!1}}return{value:void 0,done:!0}},I.prototype.throw=function(p){throw this._index>=0&&(this._index=-1,this._keys=c,this._values=c),p},I.prototype.return=function(p){return this._index>=0&&(this._index=-1,this._keys=c,this._values=c),{value:p,done:!0}},I}(),f=function(){function I(){this._keys=[],this._values=[],this._cacheKey=a,this._cacheIndex=-2}return Object.defineProperty(I.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),I.prototype.has=function(p){return this._find(p,!1)>=0},I.prototype.get=function(p){var g=this._find(p,!1);return g>=0?this._values[g]:void 0},I.prototype.set=function(p,g){var v=this._find(p,!0);return this._values[v]=g,this},I.prototype.delete=function(p){var g=this._find(p,!1);if(g>=0){for(var v=this._keys.length,y=g+1;y<v;y++)this._keys[y-1]=this._keys[y],this._values[y-1]=this._values[y];return this._keys.length--,this._values.length--,vt(p,this._cacheKey)&&(this._cacheKey=a,this._cacheIndex=-2),!0}return!1},I.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=a,this._cacheIndex=-2},I.prototype.keys=function(){return new u(this._keys,this._values,w)},I.prototype.values=function(){return new u(this._keys,this._values,C)},I.prototype.entries=function(){return new u(this._keys,this._values,B)},I.prototype["@@iterator"]=function(){return this.entries()},I.prototype[l]=function(){return this.entries()},I.prototype._find=function(p,g){if(!vt(this._cacheKey,p)){this._cacheIndex=-1;for(var v=0;v<this._keys.length;v++)if(vt(this._keys[v],p)){this._cacheIndex=v;break}}return this._cacheIndex<0&&g&&(this._cacheIndex=this._keys.length,this._keys.push(p),this._values.push(void 0)),this._cacheIndex},I}();return f;function w(I,p){return I}function C(I,p){return p}function B(I,p){return[I,p]}}function _i(){var a=function(){function c(){this._map=new _}return Object.defineProperty(c.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),c.prototype.has=function(u){return this._map.has(u)},c.prototype.add=function(u){return this._map.set(u,u),this},c.prototype.delete=function(u){return this._map.delete(u)},c.prototype.clear=function(){this._map.clear()},c.prototype.keys=function(){return this._map.keys()},c.prototype.values=function(){return this._map.keys()},c.prototype.entries=function(){return this._map.entries()},c.prototype["@@iterator"]=function(){return this.keys()},c.prototype[l]=function(){return this.keys()},c}();return a}function Ci(){var a=16,c=A.create(),u=f();return function(){function p(){this._key=f()}return p.prototype.has=function(g){var v=w(g,!1);return v!==void 0?A.has(v,this._key):!1},p.prototype.get=function(g){var v=w(g,!1);return v!==void 0?A.get(v,this._key):void 0},p.prototype.set=function(g,v){var y=w(g,!0);return y[this._key]=v,this},p.prototype.delete=function(g){var v=w(g,!1);return v!==void 0?delete v[this._key]:!1},p.prototype.clear=function(){this._key=f()},p}();function f(){var p;do p="@@WeakMap@@"+I();while(A.has(c,p));return c[p]=!0,p}function w(p,g){if(!i.call(p,u)){if(!g)return;Object.defineProperty(p,u,{value:A.create()})}return p[u]}function C(p,g){for(var v=0;v<g;++v)p[v]=Math.random()*255|0;return p}function B(p){if(typeof Uint8Array=="function"){var g=new Uint8Array(p);return typeof crypto<"u"?crypto.getRandomValues(g):typeof msCrypto<"u"?msCrypto.getRandomValues(g):C(g,p),g}return C(new Array(p),p)}function I(){var p=B(a);p[6]=p[6]&79|64,p[8]=p[8]&191|128;for(var g="",v=0;v<a;++v){var y=p[v];(v===4||v===6||v===8)&&(g+="-"),y<16&&(g+="0"),g+=y.toString(16).toLowerCase()}return g}}function bt(a){return a.__=void 0,delete a.__,a}})}(t||(t={})),St}Rr();function $(t){return(typeof t=="object"&&t!==null||typeof t=="function")&&typeof t.then=="function"}function j(t){switch(typeof t){case"string":case"symbol":return t.toString();case"function":return t.name;default:throw new Error(`Unexpected ${typeof t} service id type`)}}const He=Symbol.for("@inversifyjs/common/islazyServiceIdentifier");class Le{[He];#e;constructor(e){this.#e=e,this[He]=!0}static is(e){return typeof e=="object"&&e!==null&&e[He]===!0}unwrap(){return this.#e()}}function ee(t,e){return Reflect.getOwnMetadata(e,t)}function It(t,e,r){Reflect.defineMetadata(e,r,t)}function te(t,e,r,n){const i=n(ee(t,e)??r());Reflect.defineMetadata(e,i,t)}const H={Request:"Request",Singleton:"Singleton",Transient:"Transient"},V={ConstantValue:"ConstantValue",DynamicValue:"DynamicValue",Factory:"Factory",Instance:"Instance",Provider:"Provider",ResolvedValue:"ResolvedValue",ServiceRedirection:"ServiceRedirection"};function*Rt(...t){for(const e of t)yield*e}class ae{#e;#t;#r;constructor(e){this.#e=new Map,this.#t={};for(const r of Reflect.ownKeys(e))this.#t[r]=new Map;this.#r=e}add(e,r){this.#n(e).push(r);for(const n of Reflect.ownKeys(r))this.#a(n,r[n]).push(e)}clone(){const e=Reflect.ownKeys(this.#r),r=new ae(this.#r);this.#s(this.#e,r.#e);for(const n of e)this.#s(this.#t[n],r.#t[n]);return r}get(e,r){return this.#t[e].get(r)}getAllKeys(e){return this.#t[e].keys()}removeByRelation(e,r){const n=this.get(e,r);if(n===void 0)return;const i=new Set(n);for(const o of i){const s=this.#e.get(o);if(s===void 0)throw new Error("Expecting model relation, none found");for(const l of s)l[e]===r&&this.#i(o,l);this.#e.delete(o)}}#n(e){let r=this.#e.get(e);return r===void 0&&(r=[],this.#e.set(e,r)),r}#a(e,r){let n=this.#t[e].get(r);return n===void 0&&(n=[],this.#t[e].set(r,n)),n}#s(e,r){for(const[n,i]of e)r.set(n,[...i])}#i(e,r){for(const n of Reflect.ownKeys(r))this.#o(e,n,r[n])}#o(e,r,n){const i=this.#t[r].get(n);if(i!==void 0){const o=i.indexOf(e);o!==-1&&i.splice(o,1),i.length===0&&this.#t[r].delete(n)}}}var ce,U,le;(function(t){t.moduleId="moduleId",t.serviceId="serviceId"})(ce||(ce={}));class ue{#e;#t;constructor(e,r){this.#e=r??new ae({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#t=e}static build(e){return new ue(e)}add(e,r){this.#e.add(e,r)}clone(){return new ue(this.#t,this.#e.clone())}get(e){const r=[],n=this.#e.get(ce.serviceId,e);n!==void 0&&r.push(n);const i=this.#t?.get(e);if(i!==void 0&&r.push(i),r.length!==0)return Rt(...r)}removeAllByModuleId(e){this.#e.removeByRelation(ce.moduleId,e)}removeAllByServiceId(e){this.#e.removeByRelation(ce.serviceId,e)}}(function(t){t.moduleId="moduleId",t.serviceId="serviceId"})(U||(U={}));class de{#e;#t;constructor(e,r){this.#e=r??new ae({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#t=e}static build(e){return new de(e)}clone(){return new de(this.#t,this.#e.clone())}get(e){return this.getNonParentBindings(e)??this.#t?.get(e)}getNonParentBindings(e){return this.#e.get(U.serviceId,e)}getNonParentBoundServices(){return this.#e.getAllKeys(U.serviceId)}getByModuleId(e){return this.#e.get(U.moduleId,e)??this.#t?.getByModuleId(e)}removeAllByModuleId(e){this.#e.removeByRelation(U.moduleId,e)}removeAllByServiceId(e){this.#e.removeByRelation(U.serviceId,e)}set(e){const r={[U.serviceId]:e.serviceIdentifier};e.moduleId!==void 0&&(r[U.moduleId]=e.moduleId),this.#e.add(e,r)}}(function(t){t.moduleId="moduleId",t.serviceId="serviceId"})(le||(le={}));class fe{#e;#t;constructor(e,r){this.#e=r??new ae({moduleId:{isOptional:!0},serviceId:{isOptional:!1}}),this.#t=e}static build(e){return new fe(e)}add(e,r){this.#e.add(e,r)}clone(){return new fe(this.#t,this.#e.clone())}get(e){const r=[],n=this.#e.get(le.serviceId,e);n!==void 0&&r.push(n);const i=this.#t?.get(e);if(i!==void 0&&r.push(i),r.length!==0)return Rt(...r)}removeAllByModuleId(e){this.#e.removeByRelation(le.moduleId,e)}removeAllByServiceId(e){this.#e.removeByRelation(le.serviceId,e)}}const he="@inversifyjs/core/classMetadataReflectKey";function pe(){return{constructorArguments:[],lifecycle:{postConstructMethodName:void 0,preDestroyMethodName:void 0},properties:new Map,scope:void 0}}const At="@inversifyjs/core/pendingClassMetadataCountReflectKey",qe=Symbol.for("@inversifyjs/core/InversifyCoreError");class T extends Error{[qe];kind;constructor(e,r,n){super(r,n),this[qe]=!0,this.kind=e}static is(e){return typeof e=="object"&&e!==null&&e[qe]===!0}static isErrorOfKind(e,r){return T.is(e)&&e.kind===r}}var F,re,K;function Ne(t){const e=ee(t,he)??pe();if(!function(r){const n=ee(r,At);return n!==void 0&&n!==0}(t))return function(r,n){const i=[];if(n.length<r.length)throw new T(F.missingInjectionDecorator,`Found unexpected missing metadata on type "${r.name}". "${r.name}" constructor requires at least ${r.length.toString()} arguments, found ${n.length.toString()} instead.
Are you using @inject, @multiInject or @unmanaged decorators in every non optional constructor argument?

If you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`);for(let o=0;o<n.length;++o)n[o]===void 0&&i.push(o);if(i.length>0)throw new T(F.missingInjectionDecorator,`Found unexpected missing metadata on type "${r.name}" at constructor indexes "${i.join('", "')}".

Are you using @inject, @multiInject or @unmanaged decorators at those indexes?

If you're using typescript and want to rely on auto injection, set "emitDecoratorMetadata" compiler option to true`)}(t,e.constructorArguments),e;(function(r,n){const i=[];for(let o=0;o<n.constructorArguments.length;++o){const s=n.constructorArguments[o];s!==void 0&&s.kind!==re.unknown||i.push(`  - Missing or incomplete metadata for type "${r.name}" at constructor argument with index ${o.toString()}.
Every constructor parameter must be decorated either with @inject, @multiInject or @unmanaged decorator.`)}for(const[o,s]of n.properties)s.kind===re.unknown&&i.push(`  - Missing or incomplete metadata for type "${r.name}" at property "${o.toString()}".
This property must be decorated either with @inject or @multiInject decorator.`);throw i.length===0?new T(F.unknown,`Unexpected class metadata for type "${r.name}" with uncompletion traces.
This might be caused by one of the following reasons:

1. A third party library is targeting inversify reflection metadata.
2. A bug is causing the issue. Consider submiting an issue to fix it.`):new T(F.missingInjectionDecorator,`Invalid class metadata at type ${r.name}:

${i.join(`

`)}`)})(t,e)}function Ar(){return 0}function Ot(t){return e=>{e!==void 0&&e.kind===re.unknown&&te(t,At,Ar,r=>r-1)}}function Et(t,e){return(...r)=>n=>{if(n===void 0)return t(...r);if(n.kind===K.unmanaged)throw new T(F.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found");return e(n,...r)}}function Tt(t){if(t.kind!==re.unknown&&t.isFromTypescriptParamType!==!0)throw new T(F.injectionDecoratorConflict,"Unexpected injection found. Multiple @inject, @multiInject or @unmanaged decorators found")}(function(t){t[t.injectionDecoratorConflict=0]="injectionDecoratorConflict",t[t.missingInjectionDecorator=1]="missingInjectionDecorator",t[t.planning=2]="planning",t[t.resolution=3]="resolution",t[t.unknown=4]="unknown"})(F||(F={})),function(t){t[t.unknown=32]="unknown"}(re||(re={})),function(t){t[t.multipleInjection=0]="multipleInjection",t[t.singleInjection=1]="singleInjection",t[t.unmanaged=2]="unmanaged"}(K||(K={}));const Or=Et(function(t,e){return{kind:t,name:void 0,optional:!1,tags:new Map,value:e}},function(t,e,r){return Tt(t),{...t,kind:e,value:r}});function Ft(t,e){return r=>{const n=r.properties.get(e);return r.properties.set(e,t(n)),r}}var G;function Er(t,e,r,n){if(T.isErrorOfKind(n,F.injectionDecoratorConflict)){const i=function(o,s,l){if(l===void 0){if(s===void 0)throw new T(F.unknown,"Unexpected undefined property and index values");return{kind:G.property,property:s,targetClass:o.constructor}}return typeof l=="number"?{index:l,kind:G.parameter,targetClass:o}:{kind:G.method,method:s,targetClass:o}}(t,e,r);throw new T(F.injectionDecoratorConflict,`Unexpected injection error.

Cause:

${n.message}

Details

${function(o){switch(o.kind){case G.method:return`[class: "${o.targetClass.name}", method: "${o.method.toString()}"]`;case G.parameter:return`[class: "${o.targetClass.name}", index: "${o.index.toString()}"]`;case G.property:return`[class: "${o.targetClass.name}", property: "${o.property.toString()}"]`}}(i)}`,{cause:n})}throw n}function Vt(t,e){return(r,n,i)=>{try{i===void 0?function(o,s){const l=Ue(o,s);return(d,h)=>{te(d.constructor,he,pe,Ft(l(d),h))}}(t,e)(r,n):typeof i=="number"?function(o,s){const l=Ue(o,s);return(d,h,m)=>{if(!function(A,O){return typeof A=="function"&&O===void 0}(d,h))throw new T(F.injectionDecoratorConflict,`Found an @inject decorator in a non constructor parameter.
Found @inject decorator at method "${h?.toString()??""}" at class "${d.constructor.name}"`);te(d,he,pe,function(A,O){return _=>{const Se=_.constructorArguments[O];return _.constructorArguments[O]=A(Se),_}}(l(d),m))}}(t,e)(r,n,i):function(o,s){const l=Ue(o,s);return(d,h,m)=>{if(!function(A){return A.set!==void 0}(m))throw new T(F.injectionDecoratorConflict,`Found an @inject decorator in a non setter property method.
Found @inject decorator at method "${h.toString()}" at class "${d.constructor.name}"`);te(d.constructor,he,pe,Ft(l(d),h))}}(t,e)(r,n,i)}catch(o){Er(r,n,i,o)}}}function Ue(t,e){return r=>{const n=e(r);return i=>(n(i),t(i))}}function W(t){return Vt(Or(K.singleInjection,t),Ot)}(function(t){t[t.method=0]="method",t[t.parameter=1]="parameter",t[t.property=2]="property"})(G||(G={}));const _t="@inversifyjs/core/classIsInjectableFlagReflectKey",Tr=[Array,BigInt,Boolean,Function,Number,Object,String];function Fr(t){const e=ee(t,"design:paramtypes");e!==void 0&&te(t,he,pe,function(r){return n=>(r.forEach((i,o)=>{var s;n.constructorArguments[o]!==void 0||(s=i,Tr.includes(s))||(n.constructorArguments[o]=function(l){return{isFromTypescriptParamType:!0,kind:K.singleInjection,name:void 0,optional:!1,tags:new Map,value:l}}(i))}),n)}(e))}function x(t){return e=>{(function(r){if(ee(r,_t)!==void 0)throw new T(F.injectionDecoratorConflict,`Cannot apply @injectable decorator multiple times at class "${r.name}"`);It(r,_t,!0)})(e),Fr(e)}}function Ct(){return{kind:K.unmanaged}}const Vr=Et(Ct,function(t){if(Tt(t),function(e){return e.name!==void 0||e.optional||e.tags.size>0}(t))throw new T(F.injectionDecoratorConflict,"Unexpected injection found. Found @unmanaged injection with additional @named, @optional, @tagged or @targetName injections");return Ct()});function ge(){return Vt(Vr(),Ot)}var ne;(function(t){t[t.multipleInjection=0]="multipleInjection",t[t.singleInjection=1]="singleInjection"})(ne||(ne={}));class ie{#e;constructor(e){this.#e=e}get name(){return this.#e.elem.name}get serviceIdentifier(){return this.#e.elem.serviceIdentifier}get tags(){return this.#e.elem.tags}getAncestor(){if(this.#e.previous!==void 0)return new ie(this.#e.previous)}}class Ke{last;constructor(e){this.last=e}concat(e){return new Ke({elem:e,previous:this.last})}[Symbol.iterator](){let e=this.last;return{next:()=>{if(e===void 0)return{done:!0,value:void 0};const r=e.elem;return e=e.previous,{done:!1,value:r}}}}}function _r(t,e){t.servicesBranch.has(e)&&function(r,n){const i=(o=[...r.servicesBranch,n],[...o].map(j).join(" -> "));var o;throw new T(F.planning,`Circular dependency found: ${i}`)}(t,e),t.servicesBranch.add(e)}function Re(t,e,r){const n=r?.customServiceIdentifier??e.serviceIdentifier,i=[...t.getBindings(n)??[]].filter(o=>o.isSatisfiedBy(e));if(i.length===0&&t.autobindOptions!==void 0&&typeof n=="function"){const o=function(s,l){return{cache:{isRight:!1,value:void 0},id:0,implementationType:l,isSatisfiedBy:()=>!0,moduleId:void 0,onActivation:void 0,onDeactivation:void 0,scope:s.scope,serviceIdentifier:l,type:V.Instance}}(t.autobindOptions,n);t.setBinding(o),i.push(o)}return i}function z(t){return t.redirections!==void 0}function Pt(t,e,r,n){let i,o;z(r)?(i=r.binding.targetServiceIdentifier,o=r.binding.serviceIdentifier):(i=r.serviceIdentifier,o=r.parent?.binding.serviceIdentifier),Array.isArray(t)?function(s,l,d,h,m){if(s.length!==0){const A=`Ambiguous bindings found for service: "${j(d)}".

Registered bindings:

${s.map(O=>function(_){switch(_.type){case V.Instance:return`[ type: "${_.type}", serviceIdentifier: "${j(_.serviceIdentifier)}", scope: "${_.scope}", implementationType: "${_.implementationType.name}" ]`;case V.ServiceRedirection:return`[ type: "${_.type}", serviceIdentifier: "${j(_.serviceIdentifier)}", redirection: "${j(_.targetServiceIdentifier)}" ]`;default:return`[ type: "${_.type}", serviceIdentifier: "${j(_.serviceIdentifier)}", scope: "${_.scope}" ]`}}(O.binding)).join(`
`)}

Trying to resolve bindings for "${Dt(d,h)}".

${Bt(m)}`;throw new T(F.planning,A)}l||$t(d,h,m)}(t,e,i,o,n):function(s,l,d,h,m){s!==void 0||l||$t(d,h,m)}(t,e,i,o,n)}function $t(t,e,r){const n=`No bindings found for service: "${j(t)}".

Trying to resolve bindings for "${Dt(t,e)}".

${Bt(r)}`;throw new T(F.planning,n)}function Dt(t,e){return e===void 0?`${j(t)} (Root service)`:j(e)}function Bt(t){const e=t.tags.size===0?"":`
- tags:
  - ${[...t.tags.keys()].map(r=>r.toString()).join(`
  - `)}`;return`Binding constraints:
- service identifier: ${j(t.serviceIdentifier)}
- name: ${t.name?.toString()??"-"}${e}`}function xt(t,e,r){if(t.redirections.length!==1)Pt(t.redirections,e,t,r);else{const[n]=t.redirections;z(n)&&xt(n,e,r)}}function We(t,e,r){if(Array.isArray(t.bindings)&&t.bindings.length===1){const[n]=t.bindings;z(n)&&xt(n,e,r)}else Pt(t.bindings,e,t,r)}function Cr(t){const e=new Map;t.rootConstraints.tag!==void 0&&e.set(t.rootConstraints.tag.key,t.rootConstraints.tag.value);const r=new Ke({elem:{name:t.rootConstraints.name,serviceIdentifier:t.rootConstraints.serviceIdentifier,tags:e},previous:void 0}),n=new ie(r.last),i=Re(t,n),o=[],s={bindings:o,parent:void 0,serviceIdentifier:t.rootConstraints.serviceIdentifier};if(o.push(...Ae(t,r,i,s)),!t.rootConstraints.isMultiple){We(s,t.rootConstraints.isOptional??!1,n);const[l]=o;s.bindings=l}return{tree:{root:s}}}function Pr(t,e,r,n){const i={binding:e,classMetadata:t.getClassMetadata(e.implementationType),constructorParams:[],parent:n,propertyParams:new Map};return jt({autobindOptions:t.autobindOptions,getBindings:t.getBindings,getClassMetadata:t.getClassMetadata,node:i,servicesBranch:t.servicesBranch,setBinding:t.setBinding},r)}function kt(t,e,r){if(r.kind===K.unmanaged)return;const n=Le.is(r.value)?r.value.unwrap():r.value,i=e.concat({name:r.name,serviceIdentifier:n,tags:r.tags}),o=new ie(i.last),s=Re(t,o),l=[],d={bindings:l,parent:t.node,serviceIdentifier:n};if(l.push(...Ae(t,i,s,d)),r.kind===K.singleInjection){We(d,r.optional,o);const[h]=l;d.bindings=h}return d}function $r(t,e,r){const n=Le.is(r.value)?r.value.unwrap():r.value,i=e.concat({name:r.name,serviceIdentifier:n,tags:r.tags}),o=new ie(i.last),s=Re(t,o),l=[],d={bindings:l,parent:t.node,serviceIdentifier:n};if(l.push(...Ae(t,i,s,d)),r.kind===ne.singleInjection){We(d,r.optional,o);const[h]=l;d.bindings=h}return d}function Dr(t,e,r,n){const i={binding:e,params:[],parent:n};return jt({autobindOptions:t.autobindOptions,getBindings:t.getBindings,getClassMetadata:t.getClassMetadata,node:i,servicesBranch:t.servicesBranch,setBinding:t.setBinding},r)}function Ae(t,e,r,n){const i=z(n)?n.binding.targetServiceIdentifier:n.serviceIdentifier;_r(t,i);const o=[];for(const s of r)switch(s.type){case V.Instance:o.push(Pr(t,s,e,n));break;case V.ResolvedValue:o.push(Dr(t,s,e,n));break;case V.ServiceRedirection:{const l=Br(t,e,s,n);o.push(l);break}default:o.push({binding:s,parent:n})}return t.servicesBranch.delete(i),o}function Br(t,e,r,n){const i={binding:r,parent:n,redirections:[]},o=Re(t,new ie(e.last),{customServiceIdentifier:r.targetServiceIdentifier});return i.redirections.push(...Ae(t,e,o,i)),i}function jt(t,e){return t.node.binding.type===V.Instance?function(r,n,i){const o=n.classMetadata;for(const[s,l]of o.constructorArguments.entries())n.constructorParams[s]=kt(r,i,l);for(const[s,l]of o.properties){const d=kt(r,i,l);d!==void 0&&n.propertyParams.set(s,d)}return r.node}(t,t.node,e):function(r,n,i){const o=n.binding.metadata;for(const[s,l]of o.arguments.entries())n.params[s]=$r(r,i,l);return r.node}(t,t.node,e)}var Z;(function(t){t[t.singleMandatory=0]="singleMandatory",t[t.singleOptional=1]="singleOptional",t[t.multipleMandatory=2]="multipleMandatory",t[t.multipleOptional=3]="multipleOptional",t[t.length=4]="length"})(Z||(Z={}));class xr{#e;#t;#r;#n;#a;constructor(){this.#e=this.#s(),this.#t=this.#s(),this.#n=this.#s(),this.#r=this.#s(),this.#a=[]}clearCache(){for(const e of this.#c())e.clear();for(const e of this.#a)e.clearCache()}get(e){return e.name===void 0?e.tag===void 0?this.#o(this.#e,e).get(e.serviceIdentifier):this.#o(this.#r,e).get(e.serviceIdentifier)?.get(e.tag.key)?.get(e.tag.value):e.tag===void 0?this.#o(this.#t,e).get(e.serviceIdentifier)?.get(e.name):this.#o(this.#n,e).get(e.serviceIdentifier)?.get(e.name)?.get(e.tag.key)?.get(e.tag.value)}set(e,r){e.name===void 0?e.tag===void 0?this.#o(this.#e,e).set(e.serviceIdentifier,r):this.#i(this.#i(this.#o(this.#r,e),e.serviceIdentifier),e.tag.key).set(e.tag.value,r):e.tag===void 0?this.#i(this.#o(this.#t,e),e.serviceIdentifier).set(e.name,r):this.#i(this.#i(this.#i(this.#o(this.#n,e),e.serviceIdentifier),e.name),e.tag.key).set(e.tag.value,r)}subscribe(e){this.#a.push(e)}#s(){const e=new Array(Z.length);for(let r=0;r<e.length;++r)e[r]=new Map;return e}#i(e,r){let n=e.get(r);return n===void 0&&(n=new Map,e.set(r,n)),n}#o(e,r){return e[this.#l(r)]}#c(){return[...this.#e,...this.#t,...this.#n,...this.#r]}#l(e){return e.isMultiple?e.optional===!0?Z.multipleOptional:Z.multipleMandatory:e.optional===!0?Z.singleOptional:Z.singleMandatory}}function Ht(t,e){return $(e)?e.then(r=>Lt(t,r)):Lt(t,e)}function Lt(t,e){return t.cache={isRight:!0,value:e},e}function kr(t,e,r){const n=t.getActivations(e);return n===void 0?r:$(r)?qt(t,r,n[Symbol.iterator]()):function(i,o,s){let l=o,d=s.next();for(;d.done!==!0;){const h=d.value(i.context,l);if($(h))return qt(i,h,s);l=h,d=s.next()}return l}(t,r,n[Symbol.iterator]())}async function qt(t,e,r){let n=await e,i=r.next();for(;i.done!==!0;)n=await i.value(t.context,n),i=r.next();return n}function Oe(t,e,r){let n=r;if(e.onActivation!==void 0){const i=e.onActivation;n=$(n)?n.then(o=>i(t.context,o)):i(t.context,n)}return kr(t,e.serviceIdentifier,n)}function Ge(t){return(e,r)=>r.cache.isRight?r.cache.value:Ht(r,Oe(e,r,t(e,r)))}const jr=Ge(function(t,e){return e.value});function Hr(t){return t}function ze(t,e){return(r,n)=>{const i=t(n);switch(i.scope){case H.Singleton:return i.cache.isRight?i.cache.value:Ht(i,Oe(r,i,e(r,n)));case H.Request:{if(r.requestScopeCache.has(i.id))return r.requestScopeCache.get(i.id);const o=Oe(r,i,e(r,n));return r.requestScopeCache.set(i.id,o),o}case H.Transient:return Oe(r,i,e(r,n))}}}const Lr=(t=>ze(Hr,t))(function(t,e){return e.value(t.context)}),qr=Ge(function(t,e){return e.factory(t.context)});function Nt(t,e,r){const n=function(i,o,s){if(s!==void 0){if(!(s in i))throw new T(F.resolution,`Expecting a "${s.toString()}" property when resolving "${o.implementationType.name}" class @postConstruct decorated method, none found.`);if(typeof i[s]!="function")throw new T(F.resolution,`Expecting a "${s.toString()}" method when resolving "${o.implementationType.name}" class @postConstruct decorated method, a non function property was found instead.`);{let l;try{l=i[s]()}catch(d){throw new T(F.resolution,`Unexpected error found when calling "${s.toString()}" @postConstruct decorated method on class "${o.implementationType.name}"`,{cause:d})}if($(l))return async function(d,h,m){try{await m}catch(A){throw new T(F.resolution,`Unexpected error found when calling "${h.toString()}" @postConstruct decorated method on class "${d.implementationType.name}"`,{cause:A})}}(o,s,l)}}}(t,e,r);return $(n)?n.then(()=>t):t}function Ut(t){return(e,r,n)=>{const i=new n.binding.implementationType(...e),o=t(r,i,n);return $(o)?o.then(()=>Nt(i,n.binding,n.classMetadata.lifecycle.postConstructMethodName)):Nt(i,n.binding,n.classMetadata.lifecycle.postConstructMethodName)}}const Nr=Ge(function(t,e){return e.provider(t.context)});function Ur(t){return t.binding}function Kr(t){return t.binding}const Kt=function(t){return(e,r,n)=>{const i=[];for(const[o,s]of n.propertyParams){const l=n.classMetadata.properties.get(o);if(l===void 0)throw new T(F.resolution,`Expecting metadata at property "${o.toString()}", none found`);l.kind!==K.unmanaged&&s.bindings!==void 0&&(r[o]=t(e,s),$(r[o])&&i.push((async()=>{r[o]=await r[o]})()))}if(i.length>0)return Promise.all(i).then(()=>{})}}(Ee),Wt=function(t){return function e(r,n){const i=[];for(const o of n.redirections)z(o)?i.push(...e(r,o)):i.push(t(r,o));return i}}(Ze),Wr=function(t,e,r){return(n,i)=>{const o=t(n,i);return $(o)?e(o,n,i):r(o,n,i)}}(function(t){return(e,r)=>{const n=[];for(const i of r.constructorParams)i===void 0?n.push(void 0):n.push(t(e,i));return n.some($)?Promise.all(n):n}}(Ee),function(t){return async(e,r,n)=>{const i=await e;return t(i,r,n)}}(Ut(Kt)),Ut(Kt)),Gr=function(t){return(e,r)=>{const n=t(e,r);return $(n)?n.then(i=>r.binding.factory(...i)):r.binding.factory(...n)}}(function(t){return(e,r)=>{const n=[];for(const i of r.params)n.push(t(e,i));return n.some($)?Promise.all(n):n}}(Ee)),zr=(t=>ze(Ur,t))(Wr),Zr=(t=>ze(Kr,t))(Gr);function Jr(t){return Ee(t,t.planResult.tree.root)}function Ze(t,e){switch(e.binding.type){case V.ConstantValue:return jr(t,e.binding);case V.DynamicValue:return Lr(t,e.binding);case V.Factory:return qr(t,e.binding);case V.Instance:return zr(t,e);case V.Provider:return Nr(t,e.binding);case V.ResolvedValue:return Zr(t,e)}}function Ee(t,e){if(e.bindings!==void 0)return Array.isArray(e.bindings)?function(r,n){const i=[];for(const o of n)z(o)?i.push(...Wt(r,o)):i.push(Ze(r,o));return i.some($)?Promise.all(i):i}(t,e.bindings):function(r,n){if(z(n)){const i=Wt(r,n);if(i.length===1)return i[0];throw new T(F.resolution,"Unexpected multiple resolved values on single injection")}return Ze(r,n)}(t,e.bindings)}function Qr(t){return t.scope!==void 0}function Gt(t,e){if(t.lifecycle.preDestroyMethodName!==void 0&&typeof e[t.lifecycle.preDestroyMethodName]=="function")return e[t.lifecycle.preDestroyMethodName]()}function zt(t,e,r){const n=t.getDeactivations(e);if(n!==void 0)return $(r)?Zt(r,n[Symbol.iterator]()):function(i,o){let s=o.next();for(;s.done!==!0;){const l=s.value(i);if($(l))return Zt(i,o);s=o.next()}}(r,n[Symbol.iterator]())}async function Zt(t,e){const r=await t;let n=e.next();for(;n.done!==!0;)await n.value(r),n=e.next()}function Xr(t,e){const r=function(n,i){if(i.type===V.Instance){const o=n.getClassMetadata(i.implementationType),s=i.cache.value;return $(s)?s.then(l=>Gt(o,l)):Gt(o,s)}}(t,e);return r===void 0?Jt(t,e):r.then(()=>Jt(t,e))}function Jt(t,e){const r=e.cache;return $(r.value)?r.value.then(n=>Qt(t,e,n)):Qt(t,e,r.value)}function Qt(t,e,r){let n;return e.onDeactivation!==void 0&&(n=(0,e.onDeactivation)(r)),n===void 0?zt(t,e.serviceIdentifier,r):n.then(()=>zt(t,e.serviceIdentifier,r))}function Xt(t,e){if(e===void 0)return;const r=function(i){const o=[];for(const s of i)Qr(s)&&s.scope===H.Singleton&&s.cache.isRight&&o.push(s);return o}(e),n=[];for(const i of r){const o=Xr(t,i);o!==void 0&&n.push(o)}return n.length>0?Promise.all(n).then(()=>{}):void 0}function Yr(t,e){const r=t.getBindingsFromModule(e);return Xt(t,r)}function Yt(t,e){const r=t.getBindings(e);return Xt(t,r)}class J{static always=e=>!0}const Je="@inversifyjs/container/bindingId";function Q(){const t=ee(Object,Je)??0;return t===Number.MAX_SAFE_INTEGER?It(Object,Je,Number.MIN_SAFE_INTEGER):te(Object,Je,()=>t,e=>e+1),t}function me(t){return e=>{for(let r=e.getAncestor();r!==void 0;r=r.getAncestor())if(t(r))return!0;return!1}}function ve(t){return e=>e.name===t}function Te(t){return e=>e.serviceIdentifier===t}function ye(t,e){return r=>r.tags.has(t)&&r.tags.get(t)===e}function en(t){return t.name===void 0&&t.tags.size===0}function Fe(t){const e=me(t);return r=>!e(r)}function Ve(t){return e=>{const r=e.getAncestor();return r===void 0||!t(r)}}function _e(t){return e=>{const r=e.getAncestor();return r!==void 0&&t(r)}}class tn{#e;constructor(e){this.#e=e}inRequestScope(){return this.#e.scope=H.Request,new X(this.#e)}inSingletonScope(){return this.#e.scope=H.Singleton,new X(this.#e)}inTransientScope(){return this.#e.scope=H.Transient,new X(this.#e)}}class er{#e;#t;#r;#n;constructor(e,r,n,i){this.#e=e,this.#t=r,this.#r=n,this.#n=i}to(e){const r=Ne(e),n={cache:{isRight:!1,value:void 0},id:Q(),implementationType:e,isSatisfiedBy:J.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:r.scope??this.#r,serviceIdentifier:this.#n,type:V.Instance};return this.#e(n),new Xe(n)}toSelf(){if(typeof this.#n!="function")throw new Error('"toSelf" function can only be applied when a newable function is used as service identifier');return this.to(this.#n)}toConstantValue(e){const r={cache:{isRight:!1,value:void 0},id:Q(),isSatisfiedBy:J.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:H.Singleton,serviceIdentifier:this.#n,type:V.ConstantValue,value:e};return this.#e(r),new X(r)}toDynamicValue(e){const r={cache:{isRight:!1,value:void 0},id:Q(),isSatisfiedBy:J.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:this.#r,serviceIdentifier:this.#n,type:V.DynamicValue,value:e};return this.#e(r),new Xe(r)}toResolvedValue(e,r){const n={cache:{isRight:!1,value:void 0},factory:e,id:Q(),isSatisfiedBy:J.always,metadata:this.#a(r),moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:this.#r,serviceIdentifier:this.#n,type:V.ResolvedValue};return this.#e(n),new Xe(n)}toFactory(e){const r={cache:{isRight:!1,value:void 0},factory:e,id:Q(),isSatisfiedBy:J.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,scope:H.Singleton,serviceIdentifier:this.#n,type:V.Factory};return this.#e(r),new X(r)}toProvider(e){const r={cache:{isRight:!1,value:void 0},id:Q(),isSatisfiedBy:J.always,moduleId:this.#t,onActivation:void 0,onDeactivation:void 0,provider:e,scope:H.Singleton,serviceIdentifier:this.#n,type:V.Provider};return this.#e(r),new X(r)}toService(e){const r={id:Q(),isSatisfiedBy:J.always,moduleId:this.#t,serviceIdentifier:this.#n,targetServiceIdentifier:e,type:V.ServiceRedirection};this.#e(r)}#a(e){return{arguments:(e??[]).map(r=>function(n){return typeof n=="object"&&!Le.is(n)}(r)?{kind:r.isMultiple===!0?ne.multipleInjection:ne.singleInjection,name:r.name,optional:r.optional??!1,tags:new Map((r.tags??[]).map(n=>[n.key,n.value])),value:r.serviceIdentifier}:{kind:ne.singleInjection,name:void 0,optional:!1,tags:new Map,value:r})}}}class tr{#e;constructor(e){this.#e=e}onActivation(e){return this.#e.onActivation=e,new Qe(this.#e)}onDeactivation(e){return this.#e.onDeactivation=e,new Qe(this.#e)}}class Qe{#e;constructor(e){this.#e=e}when(e){return this.#e.isSatisfiedBy=e,new tr(this.#e)}whenAnyAncestor(e){return this.when(me(e))}whenAnyAncestorIs(e){return this.when(me(Te(e)))}whenAnyAncestorNamed(e){return this.when(function(r){return me(ve(r))}(e))}whenAnyAncestorTagged(e,r){return this.when(function(n,i){return me(ye(n,i))}(e,r))}whenDefault(){return this.when(en)}whenNamed(e){return this.when(ve(e))}whenNoParent(e){return this.when(Ve(e))}whenNoParentIs(e){return this.when(Ve(Te(e)))}whenNoParentNamed(e){return this.when(function(r){return Ve(ve(r))}(e))}whenNoParentTagged(e,r){return this.when(function(n,i){return Ve(ye(n,i))}(e,r))}whenParent(e){return this.when(_e(e))}whenParentIs(e){return this.when(_e(Te(e)))}whenParentNamed(e){return this.when(function(r){return _e(ve(r))}(e))}whenParentTagged(e,r){return this.when(function(n,i){return _e(ye(n,i))}(e,r))}whenTagged(e,r){return this.when(ye(e,r))}whenNoAncestor(e){return this.when(Fe(e))}whenNoAncestorIs(e){return this.when(Fe(Te(e)))}whenNoAncestorNamed(e){return this.when(function(r){return Fe(ve(r))}(e))}whenNoAncestorTagged(e,r){return this.when(function(n,i){return Fe(ye(n,i))}(e,r))}}class X extends Qe{#e;constructor(e){super(e),this.#e=new tr(e)}onActivation(e){return this.#e.onActivation(e)}onDeactivation(e){return this.#e.onDeactivation(e)}}class Xe extends X{#e;constructor(e){super(e),this.#e=new tn(e)}inRequestScope(){return this.#e.inRequestScope()}inSingletonScope(){return this.#e.inSingletonScope()}inTransientScope(){return this.#e.inTransientScope()}}const Ye=Symbol.for("@inversifyjs/container/InversifyContainerError");class be extends Error{[Ye];kind;constructor(e,r,n){super(r,n),this[Ye]=!0,this.kind=e}static is(e){return typeof e=="object"&&e!==null&&e[Ye]===!0}static isErrorOfKind(e,r){return be.is(e)&&e.kind===r}}var we;(function(t){t[t.invalidOperation=0]="invalidOperation"})(we||(we={}));const rn=H.Transient;class nn{#e;#t;#r;#n;#a;#s;#i;#o;#c;#l;constructor(e){this.#n=r=>this.#e.get(r),this.#i=new xr,this.#o=this.#p(),e?.parent===void 0?(this.#e=ue.build(void 0),this.#t=de.build(void 0),this.#r=fe.build(void 0)):(this.#e=ue.build(e.parent.#e),this.#t=de.build(e.parent.#t),this.#r=fe.build(e.parent.#r),e.parent.#i.subscribe(this.#i)),this.#a=this.#t.get.bind(this.#t),this.#c=this.#f.bind(this),this.#s={autobind:e?.autobind??!1,defaultScope:e?.defaultScope??rn},this.#l=[]}bind(e){return new er(r=>{this.#f(r)},void 0,this.#s.defaultScope,e)}get(e,r){const n=this.#u(!1,e,r),i=this.#d(n);if($(i))throw new be(we.invalidOperation,`Unexpected asyncronous service when resolving service "${j(e)}"`);return i}getAll(e,r){const n=this.#u(!0,e,r),i=this.#d(n);if($(i))throw new be(we.invalidOperation,`Unexpected asyncronous service when resolving service "${j(e)}"`);return i}async getAllAsync(e,r){const n=this.#u(!0,e,r);return this.#d(n)}async getAsync(e,r){const n=this.#u(!1,e,r);return this.#d(n)}isBound(e,r){const n=this.#t.get(e);return this.#g(e,n,r)}isCurrentBound(e,r){const n=this.#t.getNonParentBindings(e);return this.#g(e,n,r)}async load(...e){await Promise.all(e.map(async r=>r.load(this.#m(r.id))))}onActivation(e,r){this.#e.add(r,{serviceId:e})}onDeactivation(e,r){this.#r.add(r,{serviceId:e})}restore(){const e=this.#l.pop();if(e===void 0)throw new be(we.invalidOperation,"No snapshot available to restore");this.#e=e.activationService,this.#t=e.bindingService,this.#r=e.deactivationService,this.#w()}snapshot(){this.#l.push({activationService:this.#e.clone(),bindingService:this.#t.clone(),deactivationService:this.#r.clone()})}async unbind(e){await Yt(this.#h(),e),this.#e.removeAllByServiceId(e),this.#t.removeAllByServiceId(e),this.#r.removeAllByServiceId(e),this.#i.clearCache()}async unbindAll(){const e=this.#h(),r=[...this.#t.getNonParentBoundServices()];await Promise.all(r.map(async n=>Yt(e,n)));for(const n of r)this.#e.removeAllByServiceId(n),this.#t.removeAllByServiceId(n),this.#r.removeAllByServiceId(n);this.#i.clearCache()}async unload(...e){const r=this.#h();await Promise.all(e.map(n=>Yr(r,n.id)));for(const n of e)this.#e.removeAllByModuleId(n.id),this.#t.removeAllByModuleId(n.id),this.#r.removeAllByModuleId(n.id);this.#i.clearCache()}#m(e){return{bind:r=>new er(n=>{this.#f(n)},e,this.#s.defaultScope,r),isBound:this.isBound.bind(this),onActivation:(r,n)=>{this.#e.add(n,{moduleId:e,serviceId:r})},onDeactivation:(r,n)=>{this.#r.add(n,{moduleId:e,serviceId:r})},unbind:this.unbind.bind(this)}}#h(){return{getBindings:e=>this.#t.get(e),getBindingsFromModule:e=>this.#t.getByModuleId(e),getClassMetadata:Ne,getDeactivations:e=>this.#r.get(e)}}#v(e,r,n){return{isMultiple:e,name:n?.name,optional:n?.optional,serviceIdentifier:r,tag:n?.tag}}#y(e,r,n){const i={autobindOptions:n?.autobind??this.#s.autobind?{scope:this.#s.defaultScope}:void 0,getBindings:this.#a,getClassMetadata:Ne,rootConstraints:{isMultiple:e,serviceIdentifier:r},servicesBranch:new Set,setBinding:this.#c};return this.#b(i,n),i}#u(e,r,n){const i=this.#v(e,r,n),o=this.#i.get(i);if(o!==void 0)return o;const s=Cr(this.#y(e,r,n));return this.#i.set(i,s),s}#p(){return{get:this.get.bind(this),getAll:this.getAll.bind(this),getAllAsync:this.getAllAsync.bind(this),getAsync:this.getAsync.bind(this)}}#d(e){return Jr({context:this.#o,getActivations:this.#n,planResult:e,requestScopeCache:new Map})}#b(e,r){r!==void 0&&(r.name!==void 0&&(e.rootConstraints.name=r.name),r.optional===!0&&(e.rootConstraints.isOptional=!0),r.tag!==void 0&&(e.rootConstraints.tag={key:r.tag.key,value:r.tag.value}))}#g(e,r,n){if(r===void 0)return!1;const i={getAncestor:()=>{},name:n?.name,serviceIdentifier:e,tags:new Map};n?.tag!==void 0&&i.tags.set(n.tag.key,n.tag.value);for(const o of r)if(o.isSatisfiedBy(i))return!0;return!1}#w(){this.#i.clearCache(),this.#n=e=>this.#e.get(e),this.#a=this.#t.get.bind(this.#t),this.#o=this.#p(),this.#c=this.#f.bind(this)}#f(e){this.#t.set(e),this.#i.clearCache()}}const b={MessageBroker:Symbol.for("MessageBroker"),Subscriber:Symbol.for("Subscriber"),MessageFilterRegistry:Symbol.for("MessageFilterRegistry"),TransportProviderRegistry:Symbol.for("TransportProviderRegistry"),HttpTransportProvider:Symbol.for("HttpTransportProvider"),InMemoryTransportProvider:Symbol.for("InMemoryTransportProvider"),HttpClientFactory:Symbol.for("HttpClientFactory"),FormValidationMiddleware:Symbol.for("FormValidationMiddleware"),FormEventBinder:Symbol.for("FormEventBinder"),UIBinder:Symbol.for("UIBinder"),RuleParser:Symbol.for("RuleParser"),FormParsingService:Symbol.for("FormParsingService"),ConfigurationService:Symbol.for("ConfigurationService"),ValidatorRegistry:Symbol.for("ValidatorRegistry"),ValidatorDispatcher:Symbol.for("ValidatorDispatcher"),RemoteValidator:Symbol.for("RemoteValidator"),RequiredValidator:Symbol.for("RequiredValidator"),EmailValidator:Symbol.for("EmailValidator"),MinLengthValidator:Symbol.for("MinLengthValidator"),MaxLengthValidator:Symbol.for("MaxLengthValidator"),PatternValidator:Symbol.for("PatternValidator"),MatchValidator:Symbol.for("MatchValidator"),MinCheckedValidator:Symbol.for("MinCheckedValidator"),MaxCheckedValidator:Symbol.for("MaxCheckedValidator"),MinSelectedValidator:Symbol.for("MinSelectedValidator"),MaxSelectedValidator:Symbol.for("MaxSelectedValidator")};var on=Object.getOwnPropertyDescriptor,sn=(t,e,r,n)=>{for(var i=n>1?void 0:n?on(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i},et=(t,e)=>(r,n)=>e(r,n,t);let Ce=class{constructor(t,e,r){this.handler=t,this.filter=e,this.owner=r}};Ce=sn([x(),et(0,ge()),et(1,ge()),et(2,ge())],Ce);var an=Object.getOwnPropertyDescriptor,cn=(t,e,r,n)=>{for(var i=n>1?void 0:n?an(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i};let tt=class{constructor(){this.subscribers=new Set,this.handlerTimeoutMs=8e3,this.middlewares=[],this.lastMessages=new Map,this.metrics={published:0,delivered:0,errors:0,lastError:null,lastPublishTime:0}}getSubscribersByType(t){return Array.from(this.subscribers).filter(e=>{if(typeof e.filter=="function")try{return e.filter({type:t})}catch{return!1}return!0})}getSubscribersByTopic(t){return Array.from(this.subscribers).filter(e=>{if(typeof e.filter=="function")try{return e.filter({topic:t})}catch{return!1}return!0})}get connectionId(){return this.provider&&"connectionId"in this.provider?this.provider.connectionId:void 0}setProvider(t){this.provider=t}async start(){if(!this.provider){console.warn("[BROKER] No transport provider set. Broker will only dispatch locally.");return}await this.provider.connect?.(),this.provider.onMessage?.(this.handleTransportMessage.bind(this)),console.log(`[BROKER] Started with transport '${this.provider.name}' at '${this.provider.endpoint}'`)}async stop(){this.unsubscribeAll(),this.provider?.disconnect&&await this.provider.disconnect(),console.log("[BROKER] Shutdown complete.")}async request(t,e=8e3){if(!this.provider||typeof this.provider.sendRequest!="function")throw new Error("Transport provider does not support request/reply");return await this.provider.sendRequest(t,e)}setErrorHandler(t){this.errorHandler=t}getSubscribers(){return Array.from(this.subscribers)}subscribe(t,e,r){for(const i of this.subscribers)if(i.handler===t&&i.filter===e&&i.owner===r)return console.warn("[BROKER] Duplicate subscription prevented.",{handler:t,filter:e,owner:r}),i;if(!t||typeof t!="function")throw console.warn("[BROKER] Tried to subscribe with missing handler"),new Error("Handler is required for subscription");const n=new Ce(t,e,r);return this.subscribers.add(n),console.log("[BROKER] Subscribed:",{handler:t,filter:e,owner:r}),n}unsubscribe(t){this.subscribers.delete(t)&&console.log("[BROKER] Unsubscribed:",t)}unsubscribeByOwner(t){for(const e of Array.from(this.subscribers))e.owner===t&&(this.subscribers.delete(e),console.log("[BROKER] Unsubscribed by owner:",t))}unsubscribeAll(){this.subscribers.clear(),console.log("[BROKER] All subscribers cleared")}use(t){this.middlewares.push(t)}subscribeOnce(t,e,r){let n;const i=o=>{t(o),this.unsubscribe(n)};return n=this.subscribe(i,e,r),n}replayLast(t,e){const r=this.lastMessages.get(t);r?e(r):console.log(`[BROKER] No message found for topic '${t}' to replay.`)}timeoutPromise(t,e,r){return Promise.race([t,new Promise((n,i)=>setTimeout(()=>i(new Error(r)),e))])}async publish(t){if(!t)throw new Error("Cannot publish undefined/null message!");this.metrics.published++,this.metrics.lastPublishTime=Date.now(),t.type&&this.lastMessages.set(t.type,t);let e=0;const r=n=>{if(e<this.middlewares.length){const i=this.middlewares[e++];try{i(n,r)}catch(o){console.error("[BROKER] Middleware error:",o),r(n)}}else this._publishCore(n)};r(t)}async _publishCore(t){t.from||(t.from=this.connectionId||this.clientId);let e=0;const r=[];for(const n of this.subscribers){let i=!0;if(typeof n.filter=="function")try{i=await this.timeoutPromise(Promise.resolve(n.filter(t)),this.handlerTimeoutMs,"Filter timed out")}catch(o){i=!1,this.metrics.errors++,this.metrics.lastError=o,console.error("[BROKER] Filter error for subscriber:",n,o)}if(i)try{const o=this.timeoutPromise(Promise.resolve(n.handler(t)),this.handlerTimeoutMs,"Handler timed out").catch(s=>{this.metrics.errors++,this.metrics.lastError=s,console.error("[BROKER] Handler error:",s,n);try{this.errorHandler&&this.errorHandler(s,t,n)}catch(l){console.error("[BROKER] Error handler threw:",l)}});r.push(o),e++}catch(o){this.metrics.errors++,this.metrics.lastError=o,console.error("[BROKER] Handler threw:",o,n);try{this.errorHandler&&this.errorHandler(o,t,n)}catch(s){console.error("[BROKER] Error handler threw:",s)}}}if(this.metrics.delivered+=e,this.provider)try{if(typeof this.provider.readyState=="number"&&this.provider.readyState!==1){console.warn("[BROKER] Transport not open, not sending:",this.provider.name);return}typeof this.provider.sendBroadcast=="function"?await this.provider.sendBroadcast(t):typeof this.provider.send=="function"?await this.provider.send(t.type,t):console.warn("[BROKER] Transport provider missing send method")}catch(n){this.metrics.errors++,this.metrics.lastError=n,console.error("[BROKER] Transport send error:",n);try{this.errorHandler&&this.errorHandler(n,t,void 0)}catch(i){console.error("[BROKER] Error handler threw:",i)}}await Promise.all(r),console.log(`[BROKER] Delivered to ${e} local subscriber(s)`)}handleTransportMessage(t){let e;try{if(typeof t=="string"?e=JSON.parse(t):e=t,e.from&&(e.from===this.connectionId||e.from===this.clientId))return;this.fireToSubscribers(e)}catch(r){console.error("[BROKER] Failed to handle transport message:",t,r)}}fireToSubscribers(t){for(const e of this.subscribers){let r=!0;if(typeof e.filter=="function")try{r=e.filter(t)}catch(n){r=!1,console.error("[BROKER] Filter error for subscriber:",e,n)}if(r)try{Promise.resolve(e.handler(t)).catch(n=>{if(this.errorHandler)try{this.errorHandler(n,t,e)}catch(i){console.error("[BROKER] Error handler threw:",i)}else console.error("[BROKER] Handler error:",n,e)})}catch(n){if(this.errorHandler)try{this.errorHandler(n,t,e)}catch(i){console.error("[BROKER] Error handler threw:",i)}else console.error("[BROKER] Handler threw:",n,e)}}}get endpoint(){return this.provider?.endpoint}get transportName(){return this.provider?.name}};tt=cn([x()],tt);var ln=Object.getOwnPropertyDescriptor,un=(t,e,r,n)=>{for(var i=n>1?void 0:n?ln(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i};let rt=class{constructor(){this.filters=new Map}register(t,e){if(!t||typeof t!="string"||!t.trim())throw new Error("Filter name must be a non-empty string");if(typeof e!="function")throw new Error("Filter must be a function");this.filters.set(t,e)}get(t){return this.filters.get(t)}unregister(t){this.filters.delete(t)}has(t){return this.filters.has(t)}list(){return Array.from(this.filters.keys())}clear(){this.filters.clear()}};rt=un([x()],rt);var dn=Object.getOwnPropertyDescriptor,fn=(t,e,r,n)=>{for(var i=n>1?void 0:n?dn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i};let nt=class{constructor(){this.providers=new Map}register(t,e){if(!t||typeof t!="string"||!t.trim())throw new Error("Provider name must be a non-empty string");if(!e)throw new Error("Provider instance is required");this.providers.set(t,e)}get(t){return this.providers.get(t)}unregister(t){this.providers.delete(t)}has(t){return this.providers.has(t)}list(){return Array.from(this.providers.keys())}clear(){this.providers.clear()}};nt=fn([x()],nt);var hn=Object.getOwnPropertyDescriptor,pn=(t,e,r,n)=>{for(var i=n>1?void 0:n?hn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i},gn=(t,e)=>(r,n)=>e(r,n,t);let it=class{constructor(t){this.name="HttpTransport",this.readyState=1,this.endpoint=t||"/api/message"}async sendBroadcast(t){await this.send(this.endpoint,t)}async send(t,e){let r,n;typeof t=="string"?(r=t||this.endpoint,n=e):(r=this.endpoint,n=t);const i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)throw new Error(`HTTP error: ${i.status}`);try{return await i.json()}catch{return}}async sendRequest(t,e=8e3){const r=new AbortController,n=setTimeout(()=>r.abort(),e);try{const i=await fetch(this.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:r.signal});if(clearTimeout(n),!i.ok)throw new Error(`HTTP error: ${i.status}`);return await i.json()}catch(i){throw clearTimeout(n),i}}async connect(){}async disconnect(){}onMessage(t){}};it=pn([x(),gn(0,ge())],it);function mn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}const L=class L{constructor(){this.name="InMemoryTransport",this.endpoint="local",this.readyState=1}onMessage(e){this.onMessageHandler=e,L.globalListeners.add(e)}async disconnect(){this.onMessageHandler&&(L.globalListeners.delete(this.onMessageHandler),this.onMessageHandler=void 0)}async connect(){}async sendBroadcast(e){L.globalListeners.forEach(r=>{try{r(e)}catch{}})}async send(e,r){await this.sendBroadcast(r)}async sendRequest(e,r=8e3){return e.id||(e.id=mn()),e._isRequest=!0,new Promise((n,i)=>{const o=setTimeout(()=>{L.pendingReplies.delete(e.id),i(new Error("Request timed out: "+e.id))},r);L.pendingReplies.set(e.id,s=>{clearTimeout(o),L.pendingReplies.delete(e.id),n(s)}),this.sendBroadcast(e)})}static replyToRequest(e,r){const n={...r,id:e.id,_isReply:!0},i=L.pendingReplies.get(e.id);i&&i(n)}};L.globalListeners=new Set,L.pendingReplies=new Map;let ot=L;var vn=Object.getOwnPropertyDescriptor,yn=(t,e,r,n)=>{for(var i=n>1?void 0:n?vn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i};let Pe=class{constructor(t={}){this.config=t}async applyInterceptors(t,e={}){let r=[t,e];if(this.config.interceptors)for(const n of this.config.interceptors)r=await n(r[0],r[1]);return r}async handleResponse(t){let e=t;if(this.config.responseInterceptors)for(const r of this.config.responseInterceptors)e=await r(e);return e}async request(t,e,r,n){let i=e,o={...this.config.defaultHeaders,...n?.headers||{}},s={method:t,...n,headers:o};this.config.baseUrl&&!/^https?:\/\//.test(e)&&(i=this.config.baseUrl.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,"")),r!==void 0&&t!=="GET"&&t!=="HEAD"&&(s.body=typeof r=="string"?r:JSON.stringify(r),o["Content-Type"]||(o["Content-Type"]="application/json"));const[l,d]=await this.applyInterceptors(i,s);let h;typeof l=="string"?h=await fetch(l,d):h=await fetch(l);const m=await this.handleResponse(h);if(!m.ok)throw new Error(`[HttpClient] Request failed: ${m.status} ${m.statusText}`);const A=m.headers.get("content-type");return A&&A.includes("application/json")?m.json():m.text()}get(t,e){return this.request("GET",t,void 0,e)}post(t,e,r){return this.request("POST",t,e,r)}put(t,e,r){return this.request("PUT",t,e,r)}delete(t,e){return this.request("DELETE",t,void 0,e)}async send(t,e){return this.post(t,e)}};Pe=yn([x()],Pe);var bn=Object.getOwnPropertyDescriptor,wn=(t,e,r,n)=>{for(var i=n>1?void 0:n?bn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i};let st=class{create(t,e){return e||(e=new Pe(t||{})),new Pe({baseUrl:t?.baseUrl,defaultHeaders:t?.defaultHeaders,interceptors:t?.interceptors,responseInterceptors:t?.responseInterceptors})}};st=wn([x()],st);var Sn=Object.getOwnPropertyDescriptor,Mn=(t,e,r,n)=>{for(var i=n>1?void 0:n?Sn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i};let at=class{constructor(){this.validators=new Map}register(t,e){this.validators.set(t,e)}getValidator(t){const e=this.validators.get(t);return console.log(`[ValidatorRegistry] getValidator('${t}') =>`,e?"FOUND":"NOT FOUND"),e}unregister(t){this.validators.delete(t)}listValidators(){return Array.from(this.validators.keys())}clear(){this.validators.clear()}};at=Mn([x()],at);var In=Object.getOwnPropertyDescriptor,Rn=(t,e,r,n)=>{for(var i=n>1?void 0:n?In(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i},rr=(t,e)=>(r,n)=>e(r,n,t);let ct=class{constructor(t,e){this.broker=t,this.validatorRegistry=e,this.parsedSchema=null,this.handleMessage=async r=>{const{name:n,value:i,fieldType:o,remoteType:s,provider:l,endpoint:d,formId:h,allValues:m}=r.payload||{};let A=null;try{if(r.type==="FieldRemoteValidate")A=this.runRemoteValidation?await this.runRemoteValidation(s,i,{type:s,provider:l,endpoint:d,fieldType:o,formId:h,value:i,allValues:m}):null;else if(r.type==="FieldChanged"||r.type==="FieldBlurred"){const O=h?document.getElementById(h):void 0;A=await this.runLocalValidation(n,i,o,h,m,O)}else return;A&&this.broker.publish({_remote:!1,type:"FieldValidationResult",topic:"form",from:"ValidatorDispatcher",payload:{formId:h,name:n,result:A},timestamp:new Date().toISOString()})}catch(O){this.broker.publish({_remote:!1,type:"FieldValidationResult",topic:"form",from:"ValidatorDispatcher",payload:{formId:h,name:n,result:{valid:!1,message:O?.message||"Validation error"}},timestamp:new Date().toISOString()})}},this.runLocalValidation=async(r,n,i,o,s,l)=>{let d=null;if(this.parsedSchema?.fields){const m=this.parsedSchema.fields.find(A=>A.field===r);m&&m.rules&&(d=m.rules)}if(!d&&l){const m=l.querySelector(`[name="${r}"]`);m&&(d=this.parseRulesFromDOM(m))}if(!d)return{valid:!0};const h=[];for(const m of d){const A=this.validatorRegistry.getValidator(m.type);if(A)try{const O=await Promise.resolve(A.validate(n,m,s));if(O&&typeof O=="object"&&O.valid===!1){if(m.stopOnFail!==!1)return O;h.push(O.message||"Validation failed")}}catch(O){h.push(O?.message||`Error in ${m.type} validator`)}}return h.length?{valid:!1,message:h.join("; ")}:{valid:!0}},this.runRemoteValidation=async(r,n,i)=>{let o=this.validatorRegistry.getValidator("remote")||this.validatorRegistry.getValidator("Remote");if(!o)return{valid:!1,message:"Remote validation not available"};const s={endpoint:i.endpoint,provider:i.provider,remoteType:r,fieldName:i.fieldName,...i};try{const l=await o.validate(n,s);return typeof l=="boolean"?{valid:l}:l}catch(l){return{valid:!1,message:l?.message||"Remote validation error"}}},this.broker.subscribe(this.handleMessage,r=>r.topic==="form"&&(r.type==="FieldChanged"||r.type==="FieldBlurred"||r.type==="FieldRemoteValidate"))}setSchema(t){this.parsedSchema=t,this.broker&&t&&t.formName&&this.broker.publish({type:"ValidationReady",topic:"form",from:"ValidatorDispatcher",payload:{formId:t.formName},_remote:!1})}parseRulesFromDOM(t){const e=[];for(const r of Array.from(t.attributes))if(r.name.startsWith("data-rule-")){const n=r.name.replace("data-rule-","");let i=r.value;i==="true"&&(i=!0),i==="false"&&(i=!1),!isNaN(Number(i))&&i!==""&&(i=Number(i));const o=`data-msg-${n.toLowerCase()}`,s=t.getAttribute(o)||void 0;if(n==="remote"){const l=t.getAttribute("data-rule-remote-provider"),d=t.getAttribute("data-rule-remote-endpoint"),h=t.getAttribute("data-rule-remote-type");e.push({type:n,value:i,provider:l,endpoint:d,remoteType:h,fieldName:t.getAttribute("name")||void 0,message:s})}else e.push({type:n,value:i,fieldName:t.getAttribute("name")||void 0,message:s})}if(t.hasAttribute("required")){const r=t.getAttribute("data-msg-required")||"This field is required.";e.push({type:"required",value:!0,message:r})}if(t.hasAttribute("minlength")){const r=t.getAttribute("minlength");if(r){const n=t.getAttribute("data-msg-minlength")||`Minimum length is ${r} characters.`;e.push({type:"minlength",value:parseInt(r),message:n})}}if(t.hasAttribute("maxlength")){const r=t.getAttribute("maxlength");if(r){const n=t.getAttribute("data-msg-maxlength")||`Maximum length is ${r} characters.`;e.push({type:"maxlength",value:parseInt(r),message:n})}}if(t.hasAttribute("pattern")){const r=t.getAttribute("pattern");if(r){const n=t.getAttribute("data-msg-pattern")||"Value does not match required pattern.";e.push({type:"pattern",value:r,message:n})}}if(t instanceof HTMLInputElement&&t.type==="email"){const r=t.getAttribute("data-msg-email")||"Please enter a valid email address.";e.push({type:"email",value:!0,message:r})}return console.log(`[ValidatorDispatcher] Parsed rules for field ${t.getAttribute("name")}:`,e),e}async validateAllFields(t,e,r){const n=[];if(this.parsedSchema?.fields)for(const i of this.parsedSchema.fields){const o=i.field;let s={valid:!0};for(const l of i.rules){const d=this.validatorRegistry.getValidator(l.type);if(d){let h;if("validate"in d){const m=await Promise.resolve(d.validate(e[o],l,e));h=typeof m=="boolean"?{valid:m}:m}else continue;if(h&&typeof h=="object"&&h.valid===!1){s=h;break}}}n.push({name:o,result:s})}else if(r){console.log(`[ValidatorDispatcher] No schema found, parsing rules from DOM for form: ${t}`);const i=Array.from(r.elements).filter(o=>o instanceof HTMLInputElement||o instanceof HTMLSelectElement||o instanceof HTMLTextAreaElement);for(const o of i){if(!o.name)continue;const s=this.parseRulesFromDOM(o);if(s.length===0)continue;let l={valid:!0};for(const d of s){const h=this.validatorRegistry.getValidator(d.type);if(h)try{const m={...d,fieldName:o.name},A=await Promise.resolve(h.validate(e[o.name],m,e)),O=typeof A=="boolean"?{valid:A}:A;if(O&&typeof O=="object"&&O.valid===!1){l=O;break}}catch(m){console.error(`[ValidatorDispatcher] Error validating field ${o.name}:`,m),l={valid:!1,message:m?.message||`Error in ${d.type} validator`};break}else console.warn(`[ValidatorDispatcher] Validator not found for type: ${d.type}`)}n.push({name:o.name,result:l})}}else console.warn("[ValidatorDispatcher] No schema or form element provided for validation");return console.log(`[ValidatorDispatcher] Validation results for form ${t}:`,n),n}};ct=Rn([x(),rr(0,W(b.MessageBroker)),rr(1,W(b.ValidatorRegistry))],ct);var An=Object.getOwnPropertyDescriptor,On=(t,e,r,n)=>{for(var i=n>1?void 0:n?An(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i},En=(t,e)=>(r,n)=>e(r,n,t);let lt=class{constructor(t){this.formEventBinder=t,this.label="FormValidation"}attachToForms(){const t=Array.from(document.querySelectorAll("form[validate]"));if(console.log(`[${this.label}] Attaching to ${t.length} forms for validation.`),t.length===0){console.warn(`[${this.label}] No forms found with 'validate' attribute.`);return}t.forEach(e=>this.formEventBinder.bind(e))}middleware(){return(t,e)=>{["FormSubmit","FieldChanged","FieldBlurred","FieldRemoteValidate","FormSubmitted","FieldValidationResult"].includes(t.type)&&console.log(`[${this.label} Middleware] Intercepted:`,t),e(t)}}};lt=On([x(),En(0,W(b.FormEventBinder))],lt);var Tn=Object.getOwnPropertyDescriptor,Fn=(t,e,r,n)=>{for(var i=n>1?void 0:n?Tn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i};let ut=class{constructor(t){this.delayMs=t,this.timer=null}run(t){this.timer&&clearTimeout(this.timer),this.timer=window.setTimeout(t,this.delayMs)}clear(){this.timer&&clearTimeout(this.timer),this.timer=null}};ut=Fn([x()],ut);var Vn=Object.getOwnPropertyDescriptor,_n=(t,e,r,n)=>{for(var i=n>1?void 0:n?Vn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i},nr=(t,e)=>(r,n)=>e(r,n,t);let dt=class{constructor(t,e){this.broker=t,this.dispatcher=e,this.fieldDebouncers=new Map,this.fieldHandlerRefs=new WeakMap,this.mutationObservers=new WeakMap,this.boundForms=new Set,this.onFormSubmit=async r=>{r.preventDefault(),console.log("FormEventBinder: onFormSubmit called");const n=r.target,i=n.id||"",o=this.extractFormValues(n);this.broker.publish({type:"FormSubmit",topic:"form",from:"FormEventBinder",payload:{formId:i,values:o},_remote:!1});const s=await this.dispatcher.validateAllFields(i,o,n);let l=!0;for(const{name:d,result:h}of s)this.broker.publish({type:"FieldValidationResult",topic:"form",from:"FormEventBinder",payload:{formId:i,name:d,result:h},_remote:!1}),h.valid||(l=!1);if(l)this.broker.publish({type:"FormSubmitted",topic:"form",from:"FormEventBinder",payload:{formId:i,values:o},_remote:!1});else{const d=s.find(h=>!h.result.valid);if(d){const h=n.querySelector(`[name="${d.name}"]`);h&&h.focus()}}}}bind(t){this.bindFields(t),this.observeForm(t),t.addEventListener("submit",this.onFormSubmit),this.boundForms.add(t),this.broker.publish({type:"KeepAliveRequest",topic:"transport",payload:{formId:t.id},_remote:!1})}unbind(t){const e=this.mutationObservers.get(t);e&&e.disconnect(),this.mutationObservers.delete(t),Array.from(t.elements).filter(this.isBindableField).forEach(r=>{const n=this.fieldHandlerRefs.get(r)||[];["change","blur"].forEach((i,o)=>{n[o]&&r.removeEventListener(i,n[o])}),this.fieldHandlerRefs.delete(r)}),t.removeEventListener("submit",this.onFormSubmit),this.fieldDebouncers.forEach(r=>r.clear()),this.fieldDebouncers.clear(),this.boundForms.delete(t)}unbindAll(){for(const t of this.boundForms){const e=this.mutationObservers.get(t);e&&e.disconnect(),this.unbind(t)}this.boundForms.clear(),this.mutationObservers=new WeakMap,this.fieldDebouncers.clear(),this.fieldHandlerRefs=new WeakMap}observeForm(t){const e=new MutationObserver(()=>this.bindFields(t));e.observe(t,{childList:!0,subtree:!0}),this.mutationObservers.set(t,e)}bindFields(t){Array.from(t.elements).filter(this.isBindableField).forEach(r=>{if(this.fieldHandlerRefs.has(r))return;r.name;const n=this.hasRemoteRule(r),i=o=>{this.handleEvent(o,n)};r.addEventListener("change",i),r.addEventListener("blur",i),this.fieldHandlerRefs.set(r,[i,i])})}handleEvent(t,e){const r=t.target;if(!(!r||!r.name))if(e){let n=this.fieldDebouncers.get(r.name);n||(n=new ut(350),this.fieldDebouncers.set(r.name,n)),n.run(()=>this.onRemoteEvent(t,r))}else this.onLocalEvent(t,r)}onRemoteEvent(t,e){const r=e.form,n=r?.id||void 0,i=this.extractFormValues(r),o={type:"FieldRemoteValidate",topic:"form",payload:{formId:n,name:e.name,value:this.getFieldValue(e),fieldType:e.type,remoteType:e.getAttribute("data-rule-remote"),provider:e.getAttribute("data-rule-remote-provider"),endpoint:e.getAttribute("data-rule-remote-endpoint"),fieldName:e.name,allValues:i},_remote:!1};this.broker.publish(o)}onLocalEvent(t,e){const r=e.form,n=r?.id||void 0,i=this.extractFormValues(r),o={type:t.type==="blur"?"FieldBlurred":"FieldChanged",topic:"form",payload:{formId:n,name:e.name,value:this.getFieldValue(e),fieldType:e.type,allValues:i},_remote:!1};this.broker.publish(o)}extractFormValues(t){if(!t)return{};const e={};return Array.from(t.elements).filter(this.isBindableField).forEach(r=>{const n=this.getFieldValue(r);r.name&&(e[r.name]=n),r.id&&r.id!==r.name&&(e[r.id]=n)}),e}getFieldValue(t){if(t instanceof HTMLInputElement)switch(t.type){case"checkbox":if(t.form){const e=t.form.querySelectorAll(`input[type="checkbox"][name="${t.name}"]`);if(e.length>1)return Array.from(e).filter(r=>r.checked).map(r=>r.value)}return t.checked;case"radio":if(t.form){const e=t.form.querySelector(`input[type="radio"][name="${t.name}"]:checked`);return e?e.value:null}return t.checked?t.value:null;case"file":return t.files?Array.from(t.files):null;default:return t.value}else{if(t instanceof HTMLSelectElement)return t.multiple?Array.from(t.selectedOptions).map(e=>e.value):t.value;if(t instanceof HTMLTextAreaElement)return t.value}}hasRemoteRule(t){return!!(t instanceof HTMLElement&&t.hasAttribute("data-rule-remote")&&t.getAttribute("data-rule-remote-provider"))}isBindableField(t){return!(!(t instanceof HTMLInputElement||t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement)||!t.name||t.type==="hidden"||t.name.startsWith("__")||t.hasAttribute("data-ignore-validation")||t.disabled)}};dt=_n([x(),nr(0,W(b.MessageBroker)),nr(1,W(b.ValidatorDispatcher))],dt);var Cn=Object.getOwnPropertyDescriptor,Pn=(t,e,r,n)=>{for(var i=n>1?void 0:n?Cn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i},$n=(t,e)=>(r,n)=>e(r,n,t);let $e=class{constructor(t){this.broker=t,t.subscribe(e=>this.handleMessage(e),e=>e.type==="FieldValidationResult"||e.type==="StatusMessage"||e.type==="ErrorMessage")}handleMessage(t){if(!t?.payload)return;const e=t.payload.name??t.payload.field,{formId:r,formName:n}=t.payload;if(!e)return;const i=this.findMsgEl(r,n,e);if(i){if(t.type==="FieldValidationResult"&&t.payload.result){const o=t.payload.result;typeof o.valid=="boolean"&&(o.valid?this.clearField(i):this.showFieldMessage(i,o.message||"Invalid value","error"))}else if((t.type==="StatusMessage"||t.type==="ErrorMessage")&&t.payload.message){const o=t.type==="ErrorMessage"?"error":t.payload.level||"info";this.showFieldMessage(i,t.payload.message,o)}}}findMsgEl(t,e,r){const n=r.replace(/\[\]$/,"");if(t){const s=document.getElementById(t);if(s){const l=s.querySelector(`[data-valmsg-for="${n}"]`);if(l)return l}}if(e){const s=document.querySelector(`form[name="${e}"]`);if(s){const l=s.querySelector(`[data-valmsg-for="${n}"]`);if(l)return l}}const i=document.getElementById(`${n}-error`),o=document.getElementById(`${n}-success`);return i||o}showFieldMessage(t,e,r){const n=t.id?.replace(/-error$|-success$/,"");if(!n){t.innerHTML=`<span class="toast toast-${r}" aria-live="polite">${e}</span>`,t.setAttribute("role","alert"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.setAttribute("data-valmsg-active",r);return}const i=document.getElementById(`${n}-error`),o=document.getElementById(`${n}-success`),s=document.querySelector(`[name="${n}"]`);i&&(i.innerHTML="",i.style.display="none"),o&&(o.innerHTML="",o.style.display="none"),r==="error"&&i?(i.innerHTML=e,i.style.display="block",i.setAttribute("role","alert"),i.setAttribute("aria-live","polite"),s&&(s.classList.add("validation-error"),s.classList.remove("validation-success"))):r==="success"&&o&&(o.innerHTML=e,o.style.display="block",o.setAttribute("role","alert"),o.setAttribute("aria-live","polite"),s&&(s.classList.add("validation-success"),s.classList.remove("validation-error")))}clearField(t){const e=t.id?.replace(/-error$|-success$/,"");if(!e){t.innerHTML="",t.removeAttribute("role"),t.removeAttribute("aria-live"),t.removeAttribute("aria-atomic"),t.removeAttribute("data-valmsg-active"),t.classList.remove("fade-out-toast");return}const r=document.getElementById(`${e}-error`),n=document.getElementById(`${e}-success`),i=document.querySelector(`[name="${e}"]`);r&&(r.innerHTML="",r.style.display="none",r.removeAttribute("role"),r.removeAttribute("aria-live")),n&&(n.innerHTML="",n.style.display="none",n.removeAttribute("role"),n.removeAttribute("aria-live")),i&&i.classList.remove("validation-error","validation-success")}};$e=Pn([x(),$n(0,W(b.MessageBroker))],$e);var Dn=Object.getOwnPropertyDescriptor,Bn=(t,e,r,n)=>{for(var i=n>1?void 0:n?Dn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i},xn=(t,e)=>(r,n)=>e(r,n,t);let ft=class{constructor(t){this.ruleParser=t}parse(t){const e=this.ruleParser.parseForm(t),r=t.getAttribute("name")||t.getAttribute("id")||"",n={};for(const i of Array.from(t.elements))i.name&&(i.type==="checkbox"?n[i.name]=i.checked:i.type==="radio"?i.checked&&(n[i.name]=i.value):n[i.name]=i.value);return{formName:r,fields:e,initialValues:n}}};ft=Bn([x(),xn(0,W(b.RuleParser))],ft);const kn={validateOnBlur:!0,validateOnChange:!1,validateOnSubmit:!0,debounceDelay:350,showErrorsImmediately:!0,enableRemoteValidation:!0,http:{baseUrl:"",timeout:5e3,headers:{"Content-Type":"application/json"}},ui:{errorClass:"validation-error",successClass:"validation-success",errorContainerClass:"validation-error-container",showValidationIcons:!0},fieldOverrides:{}};var jn=Object.getOwnPropertyDescriptor,Hn=(t,e,r,n)=>{for(var i=n>1?void 0:n?jn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i},Ln=(t,e)=>(r,n)=>e(r,n,t);let ht=class{constructor(t){this.config=this.mergeConfig(kn,t||{})}updateConfig(t){this.config=this.mergeConfig(this.config,t)}getConfig(){return{...this.config}}getHttpConfig(t){const e=this.config.http||{};if(!t)return e;const r=this.config.fieldOverrides?.[t]?.http;return r?{...e,...r}:e}getValidationConfig(t){const e={debounceDelay:this.config.debounceDelay||350,validateOnChange:this.config.validateOnChange||!1,validateOnBlur:this.config.validateOnBlur||!0,validateOnSubmit:this.config.validateOnSubmit||!0};if(!t)return e;const r=this.config.fieldOverrides?.[t]?.validation;return r?{...e,...r}:e}getUIConfig(){return this.config.ui||{}}buildHttpUrl(t,e){const n=this.getHttpConfig(t)?.baseUrl||"",i=e||"";if(!n)return console.warn(`No HTTP base URL configured for field: ${t}`),"";const o=n.endsWith("/")?n.slice(0,-1):n,s=i.startsWith("/")?i:`/${i}`;return`${o}${s}`}isRemoteValidationEnabled(){return this.config.enableRemoteValidation!==!1}getRetryConfig(){const t=this.config.http||{};return{attempts:t.retryAttempts||3,delay:t.retryDelay||1e3}}mergeConfig(t,e){const r={...t};for(const n in e)e[n]&&typeof e[n]=="object"&&!Array.isArray(e[n])?r[n]=this.mergeConfig(t[n]||{},e[n]):r[n]=e[n];return r}};ht=Hn([x(),Ln(0,ge())],ht);var qn=Object.getOwnPropertyDescriptor,Nn=(t,e,r,n)=>{for(var i=n>1?void 0:n?qn(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i};let pt=class{parseForm(t){const e=[],r=Array.from(t.elements),n=new Set,i={};r.forEach(o=>{o.name&&(i[o.name]||(i[o.name]=[]),i[o.name].push(o))});for(const[o,s]of Object.entries(i)){if(n.has(o))continue;const l=s[0];let d=[];if(l instanceof HTMLInputElement&&(l.type==="checkbox"||l.type==="radio")){s.forEach(m=>{d=d.concat(this.parseField(m))});const h=new Set;d=d.filter(m=>h.has(m.type)?!1:(h.add(m.type),!0))}else d=this.parseField(l);console.log(`[RuleParser] Field: ${o}, Rules:`,d),d.length>0&&e.push({field:o,rules:d}),n.add(o)}return e}parseField(t){const e=[],r=t;if("required"in r&&r.required){const s=t.getAttribute("data-msg-required");e.push({type:"required",message:s||void 0})}if("minLength"in r&&r.minLength>0){const s=t.getAttribute("data-msg-minlength");e.push({type:"minLength",value:r.minLength,message:s||void 0})}if("maxLength"in r&&r.maxLength>0){const s=t.getAttribute("data-msg-maxlength");e.push({type:"maxLength",value:r.maxLength,message:s||void 0})}if("pattern"in r&&r.pattern){const s=t.getAttribute("data-msg-pattern");e.push({type:"pattern",value:r.pattern,message:s||void 0})}if("type"in r&&r.type==="email"){const s=t.getAttribute("data-msg-email");e.push({type:"email",message:s||void 0})}Array.from(t.attributes).forEach(s=>{if(!s.name.startsWith("data-rule-"))return;const l=s.name.slice(10).toLowerCase();if(["remote","remote-provider","remote-endpoint"].includes(l))return;const d=`data-msg-${l}`,h=t.getAttribute(d);if(l==="minchecked")e.push({type:"minChecked",value:+s.value,message:h||void 0});else if(l==="minselected")e.push({type:"minSelected",value:+s.value,message:h||void 0});else if(l==="match"){const m=t.getAttribute("data-match-field");e.push({type:"match",value:s.value,...m?{matchField:m}:{},message:h||void 0})}else e.push({type:l,value:s.value,message:h||void 0})});const n=t.getAttribute("data-rule-remote"),i=t.getAttribute("data-rule-remote-provider"),o=t.getAttribute("data-rule-remote-endpoint");if(n&&(i||o)){const s=t.getAttribute("data-msg-remote");e.push({type:"remote",remoteType:n,provider:i||void 0,endpoint:o||void 0,message:s||void 0})}return e}};pt=Nn([x()],pt);class Un{constructor(){this.name="required"}validate(e,r){let n;return Array.isArray(e)?n=e.length>0:typeof e=="boolean"?n=e:e==null?n=!1:n=e!=="",{valid:n,message:n?void 0:r.message||"This field is required."}}}class Kn{constructor(){this.name="email",this.emailRegex=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/}validate(e,r){const n=typeof e=="string"&&this.emailRegex.test(e);return{valid:n,message:n?void 0:r.message||"Invalid email address."}}}class Wn{constructor(){this.name="minlength"}validate(e,r){const n=r.value||0,i=typeof e=="string"&&e.length>=n;return{valid:i,message:i?void 0:r.message||`Minimum length is ${n}.`}}}class Gn{constructor(){this.name="maxlength"}validate(e,r){const n=r.value||0,i=typeof e=="string"&&e.length<=n;return{valid:i,message:i?void 0:r.message||`Maximum length is ${n}.`}}}class zn{constructor(){this.name="pattern"}validate(e,r){const n=r.value instanceof RegExp?r.value:new RegExp(r.value),i=typeof e=="string"&&n.test(e);return{valid:i,message:i?void 0:r.message||"Invalid format."}}}class Zn{constructor(){this.name="match"}validate(e,r,n){let i=r.matchField||r.value;if(typeof i=="string"&&i.trim()===""&&(i=void 0),!i)return console.warn("[MatchValidator] No field to match specified in rule:",r),{valid:!1,message:r.message||"No field to match specified."};if(!n||!(i in n))return console.warn(`[MatchValidator] Field to match (${i}) not found in allValues:`,n),{valid:!1,message:r.message||`Field to match (${i}) not found.`};const o=e===n[i];return{valid:o,message:o?void 0:r.message||"Values do not match."}}}class Jn{constructor(){this.name="minchecked"}validate(e,r){const n=r.value||0;let i=0;Array.isArray(e)?i=e.length:typeof e=="boolean"&&(i=e?1:0);const o=i>=n;return{valid:o,message:o?void 0:r.message||`Select at least ${n}.`}}}class Qn{constructor(){this.name="maxchecked"}validate(e,r){const n=r.value||0;let i=0;Array.isArray(e)?i=e.length:typeof e=="boolean"&&(i=e?1:0);const o=i<=n;return{valid:o,message:o?void 0:r.message||`Select no more than ${n}.`}}}class Xn{constructor(){this.name="minselected"}validate(e,r){const n=r.value||0;let i=0;Array.isArray(e)?i=e.length:e!=null&&e!==""&&(i=1);const o=i>=n;return{valid:o,message:o?void 0:r.message||`Select at least ${n} options.`}}}class Yn{constructor(){this.name="maxselected"}validate(e,r){const n=r.value||0;let i=0;Array.isArray(e)?i=e.length:e!=null&&e!==""&&(i=1);const o=i<=n;return{valid:o,message:o?void 0:r.message||`Select no more than ${n} options.`}}}let De;const ei=new Uint8Array(16);function ti(){if(!De&&(De=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!De))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return De(ei)}const k=[];for(let t=0;t<256;++t)k.push((t+256).toString(16).slice(1));function ri(t,e=0){return k[t[e+0]]+k[t[e+1]]+k[t[e+2]]+k[t[e+3]]+"-"+k[t[e+4]]+k[t[e+5]]+"-"+k[t[e+6]]+k[t[e+7]]+"-"+k[t[e+8]]+k[t[e+9]]+"-"+k[t[e+10]]+k[t[e+11]]+k[t[e+12]]+k[t[e+13]]+k[t[e+14]]+k[t[e+15]]}const ir={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ni(t,e,r){if(ir.randomUUID&&!t)return ir.randomUUID();t=t||{};const n=t.random||(t.rng||ti)();return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ri(n)}var ii=Object.getOwnPropertyDescriptor,oi=(t,e,r,n)=>{for(var i=n>1?void 0:n?ii(e,r):e,o=t.length-1,s;o>=0;o--)(s=t[o])&&(i=s(i)||i);return i},or=(t,e)=>(r,n)=>e(r,n,t);let Be=class{constructor(t,e){this.httpTransportProvider=t,this.configService=e,this.name="remote"}async validate(t,e,r){const n=e.fieldName||"",i=this.configService.buildHttpUrl(n,e.endpoint);if(!i)return{valid:!1,isValid:!1,errorMessage:"No HTTP endpoint configured for remote validation."};if(!this.httpTransportProvider||typeof this.httpTransportProvider.sendRequest!="function")return{valid:!1,isValid:!1,errorMessage:"HTTP transport provider not available."};const o={type:"RemoteValidationRequest",id:ni(),payload:{endpoint:i,data:{value:t,fieldName:n,allValues:r,rule:{type:e.type,provider:e.provider,endpoint:e.endpoint}}},_remote:!1};try{const s=await this.httpTransportProvider.sendRequest(o);return!s||typeof s.valid!="boolean"?{valid:!1,isValid:!1,errorMessage:"Invalid response from remote validator."}:{valid:!!s.valid,isValid:!!s.valid,errorMessage:s.message||(s.valid?"":"Remote validation failed.")}}catch(s){return console.error("Remote validation error:",s),{valid:!1,isValid:!1,errorMessage:s?.message||"HTTP error during remote validation."}}}};Be=oi([x(),or(0,W(b.HttpTransportProvider)),or(1,W(b.ConfigurationService))],Be);const M=new nn;M.bind(b.MessageBroker).to(tt).inSingletonScope(),M.bind(b.Subscriber).to(Ce).inSingletonScope(),M.bind(b.MessageFilterRegistry).to(rt).inSingletonScope(),M.bind(b.TransportProviderRegistry).to(nt).inSingletonScope(),M.bind(b.HttpTransportProvider).to(it).inSingletonScope(),M.bind(b.InMemoryTransportProvider).to(ot).inSingletonScope(),M.bind(b.HttpClientFactory).to(st).inSingletonScope(),M.bind(b.ValidatorRegistry).to(at).inSingletonScope(),M.bind(b.ValidatorDispatcher).to(ct).inSingletonScope(),M.bind(b.FormValidationMiddleware).to(lt).inSingletonScope(),M.bind(b.FormEventBinder).to(dt).inSingletonScope(),M.bind(b.UIBinder).to($e).inSingletonScope(),M.bind(b.FormParsingService).to(ft).inSingletonScope(),M.bind(b.ConfigurationService).to(ht).inSingletonScope(),M.bind(b.RuleParser).to(pt).inSingletonScope(),M.bind(b.RequiredValidator).to(Un).inSingletonScope(),M.bind(b.EmailValidator).to(Kn).inSingletonScope(),M.bind(b.MinLengthValidator).to(Wn).inSingletonScope(),M.bind(b.MaxLengthValidator).to(Gn).inSingletonScope(),M.bind(b.PatternValidator).to(zn).inSingletonScope(),M.bind(b.MatchValidator).to(Zn).inSingletonScope(),M.bind(b.MinCheckedValidator).to(Jn).inSingletonScope(),M.bind(b.MaxCheckedValidator).to(Qn).inSingletonScope(),M.bind(b.MinSelectedValidator).to(Xn).inSingletonScope(),M.bind(b.MaxSelectedValidator).to(Yn).inSingletonScope(),M.bind(b.RemoteValidator).to(Be).inSingletonScope();class Y{constructor(){}static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance}debugFormDetection(){console.log("🔍 [FormDebugger] Starting form detection debug...");const e=Array.from(document.querySelectorAll("form"));console.log(`📋 [FormDebugger] Total forms found: ${e.length}`);const r=Array.from(document.querySelectorAll("form[validate]"));console.log(`📋 [FormDebugger] Found ${r.length} forms with validate attribute:`,r.map(i=>({id:i.id,name:i.name})));const n=e.filter(i=>Array.from(i.elements).filter(s=>s instanceof HTMLElement&&Array.from(s.attributes).some(l=>l.name.startsWith("data-rule-"))).length>0);console.log(`📋 [FormDebugger] Found ${n.length} forms with validation rules:`,n.map(i=>({id:i.id,name:i.name}))),e.forEach((i,o)=>{console.log(`
📝 [FormDebugger] Form ${o+1}:`,{id:i.id,name:i.name,action:i.action,method:i.method,hasValidateAttr:i.hasAttribute("validate"),validateValue:i.getAttribute("validate"),attributes:Array.from(i.attributes).map(s=>`${s.name}="${s.value}"`).join(", "),fields:this.getFormFieldsInfo(i)})})}debugFormFields(e){(e?[document.getElementById(e)].filter(Boolean):Array.from(document.querySelectorAll("form"))).forEach(n=>{console.log(`
🔍 [FormDebugger] Debugging form: ${n.id||"unnamed"}`),Array.from(n.elements).filter(o=>o instanceof HTMLInputElement||o instanceof HTMLSelectElement||o instanceof HTMLTextAreaElement).forEach(o=>{const s=this.extractFieldRules(o);console.log(`  📄 Field: ${o.name} (${o.type})`,{value:o.value,rules:s,hasRules:s.length>0,required:o.hasAttribute("required"),disabled:o.disabled,hidden:o.type==="hidden"})})})}debugValidationRegistry(e){if(console.log("🔧 [FormDebugger] Validation Registry Debug:"),e&&typeof e.listValidators=="function"){const r=e.listValidators();console.log(`  📋 Registered validators: ${r.join(", ")}`),r.forEach(n=>{const i=e.getValidator(n);console.log(`  ✅ ${n}:`,{name:i?.name,hasValidate:typeof i?.validate=="function",type:typeof i})})}else console.log("  ❌ Registry not available or invalid")}debugMessageBroker(e){if(console.log("📡 [FormDebugger] Message Broker Debug:"),e&&typeof e.publish=="function"){console.log("  ✅ Message broker is available");try{e.publish({type:"DebugTest",topic:"debug",payload:{test:!0},_remote:!1}),console.log("  ✅ Message publishing works")}catch(r){console.log("  ❌ Message publishing failed:",r)}}else console.log("  ❌ Message broker not available or invalid")}testFormSubmission(e){const r=document.getElementById(e);if(!r){console.log(`❌ [FormDebugger] Form with id "${e}" not found`);return}console.log(`🧪 [FormDebugger] Testing form submission for: ${e}`);const n=new Event("submit",{bubbles:!0,cancelable:!0}),i=r.addEventListener;r.addEventListener=function(o,s,l){return o==="submit"&&console.log("  📡 [FormDebugger] Submit event listener added"),i.call(this,o,s,l)},console.log("  🚀 [FormDebugger] Dispatching submit event..."),r.dispatchEvent(n),r.addEventListener=i}getFormInfo(e){const r=document.getElementById(e);return r?{id:r.id,name:r.name,action:r.action,method:r.method,hasValidateAttr:r.hasAttribute("validate"),validateValue:r.getAttribute("validate"),fields:this.getFormFieldsInfo(r),eventListeners:this.getEventListenersInfo(r)}:null}getFormFieldsInfo(e){return Array.from(e.elements).filter(n=>n instanceof HTMLInputElement||n instanceof HTMLSelectElement||n instanceof HTMLTextAreaElement).map(n=>({name:n.name,type:n.type,value:n.value,rules:this.extractFieldRules(n),required:n.hasAttribute("required"),disabled:n.disabled,hidden:n.type==="hidden"}))}extractFieldRules(e){const r=[];for(const n of Array.from(e.attributes))if(n.name.startsWith("data-rule-")){const i=n.name.replace("data-rule-","");r.push({type:i,value:n.value,attribute:n.name})}return e.hasAttribute("required")&&r.push({type:"required",value:!0,attribute:"required"}),e.hasAttribute("minlength")&&r.push({type:"minlength",value:e.getAttribute("minlength"),attribute:"minlength"}),e.hasAttribute("maxlength")&&r.push({type:"maxlength",value:e.getAttribute("maxlength"),attribute:"maxlength"}),e.hasAttribute("pattern")&&r.push({type:"pattern",value:e.getAttribute("pattern"),attribute:"pattern"}),r}getEventListenersInfo(e){return{hasSubmitListener:"Cannot determine without browser dev tools",note:"Check browser dev tools > Elements > Event Listeners tab"}}}const xe=Y.getInstance(),si={debugForm:t=>{console.log("🔍 [DebugHelper] Quick form debug:",t);const e=xe.getFormInfo(t);console.log(e)},testSubmit:t=>{xe.testFormSubmission(t)},debugAll:()=>{xe.debugFormDetection(),xe.debugFormFields()}};typeof window<"u"&&(window.formValidationDebug=si,console.log("🔧 [FormDebugger] Debug helpers available at window.formValidationDebug"),console.log('  Usage: formValidationDebug.debugForm("formId")'),console.log('  Usage: formValidationDebug.testSubmit("formId")'),console.log("  Usage: formValidationDebug.debugAll()"));function ai(t,e=""){return(r,n)=>{const i=t.getSubscribers();console.log(`[LiveSubscribers] ${e} Subscribers: ${i.length}`);let o=1;for(const s of i){let l=s.handler.name||"(anonymous)";console.log(`  ${o++}. Handler: ${l}`,s)}n(r)}}const sr=(t,e)=>{console.log("🚀 Initializing FormValidation system...");const r=M.get(b.MessageBroker),n=M.get(b.ConfigurationService),i=M.get(b.TransportProviderRegistry),o=M.get(b.FormValidationMiddleware);M.get(b.MessageFilterRegistry);const s=M.get(b.ValidatorRegistry),l=Y.getInstance();t&&(n.updateConfig(t),console.log("✅ Configuration applied"));const d=M.get(b.HttpTransportProvider);if(i.register("HTTP",d),console.log("✅ HTTP transport registered"),[M.get(b.RequiredValidator),M.get(b.EmailValidator),M.get(b.MinLengthValidator),M.get(b.MaxLengthValidator),M.get(b.PatternValidator),M.get(b.MatchValidator),M.get(b.MinCheckedValidator),M.get(b.MaxCheckedValidator),M.get(b.MinSelectedValidator),M.get(b.MaxSelectedValidator)].forEach(m=>{s.register(m.name,m)}),s.register("remote",new Be(M.get(b.HttpTransportProvider),M.get(b.ConfigurationService))),console.log("✅ Validators registered"),r.use(ai(r,"Form Events")),r.use(o.middleware()),console.log("✅ Middleware configured"),e?.autoAttachToForms!==!1&&(o.attachToForms(),new $e(r),console.log("✅ Auto-attached to forms")),e?.enableDebug){console.log("🔍 Debug mode enabled"),l.debugFormDetection(),l.debugValidationRegistry(s),l.debugMessageBroker(r);const m=n.getConfig();console.log("📋 Configuration Summary:"),console.log("  Global HTTP:",m.http?.baseUrl),console.log("  Field overrides:",Object.keys(m.fieldOverrides||{})),console.log("  Validation settings:",{validateOnBlur:m.validateOnBlur,validateOnChange:m.validateOnChange,debounceDelay:m.debounceDelay,enableRemoteValidation:m.enableRemoteValidation})}return console.log("🎉 FormValidation system initialized successfully!"),{broker:r,configService:n,validatorRegistry:s,formValidationMiddleware:o}},ci=t=>sr(t,{enableDebug:!0});return Ie.initializeFormValidation=sr,Ie.setupFormValidationWithDebug=ci,Object.defineProperty(Ie,Symbol.toStringTag,{value:"Module"}),Ie}({});
